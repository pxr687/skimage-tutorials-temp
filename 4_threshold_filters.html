
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Threshold filtering &#8212; Scikit-image via NumPy and SciPy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4_threshold_filters';</script>
    <link rel="canonical" href="https://pxr687.github.io/skimage-tutorials-temp/4_threshold_filters.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Convolutional filtering I - the mean filter" href="5_mean_filter.html" />
    <link rel="prev" title="(Sci-kit) Image processing, via NumPy and SciPy" href="3_skimage_processing_from_numpy_and_scipy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/colourwheel.png" class="logo__image only-light" alt="Scikit-image via NumPy and SciPy - Home"/>
    <script>document.write(`<img src="_static/colourwheel.png" class="logo__image only-dark" alt="Scikit-image via NumPy and SciPy - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Scikit-image via NumPy and SciPy</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_images_as_numpy_arrays.html">What is an image? - Images as NumPy arrays</a></li>







<li class="toctree-l1"><a class="reference internal" href="1_colour_images_as_numpy_arrays.html">What about colour?</a></li>





<li class="toctree-l1"><a class="reference internal" href="2_skimage_intro.html">Introducing Scikit-image</a></li>










<li class="toctree-l1"><a class="reference internal" href="3_skimage_processing_from_numpy_and_scipy.html">(Sci-kit) Image processing, via NumPy and SciPy</a></li>













<li class="toctree-l1 current active"><a class="current reference internal" href="#">Threshold filtering</a></li>






<li class="toctree-l1"><a class="reference internal" href="5_mean_filter.html">Convolutional filtering I - the mean filter</a></li>





<li class="toctree-l1"><a class="reference internal" href="6_gaussian_sharpening_edge.html">Convolutional filtering II - Gaussian blur, sharpening and edge detection</a></li>








<li class="toctree-l1"><a class="reference internal" href="8_morphology.html">Morphology</a></li>







</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp/edit/main/4_threshold_filters.Rmd" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp/issues/new?title=Issue%20on%20page%20%2F4_threshold_filters.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4_threshold_filters.Rmd" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.Rmd</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Threshold filtering</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Threshold filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-signal-what-is-noise">What is signal? What is noise?</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Threshold Filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-segmentation-via-threshold-filtering">Image segmentation via threshold filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold-filters-in-skimage">Threshold filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="threshold-filtering">
<h1>Threshold filtering<a class="headerlink" href="#threshold-filtering" title="Link to this heading">#</a></h1>
<p>A common operation we will want to perform on images is <em>filtering</em>. This is where we modify all of the pixels in an image according to a certain rule or algorithm, often based on a specific pixel intensity value, or the pixel intensity values of other pixels within the “local neighbourhood” of a given pixel. Filtering techniques can be used to remove noise from an image, or to achieve specific visual effects, amongst other purposes.</p>
<p>Here we will look at <em>threshold filtering</em> where we filter an image based on specific pixel intensity values. We will show how threshold filtering works at the pixel-level, using <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy</span></code>, and then we will show how to implement it in <code class="docutils literal notranslate"><span class="pre">skimage</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Library imports.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ndi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ski</span>

<span class="c1"># Set &#39;gray&#39; as the default colormap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>

<span class="c1"># Set NumPy precision to 2 decimal places</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#  Custom functions for illustrations, hints, and to quickly report image attributes.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">noise_illustration</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_image</span><span class="p">,</span> <span class="n">original_image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">show_attributes</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_attributes</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="what-is-signal-what-is-noise">
<h1>What is signal? What is noise?<a class="headerlink" href="#what-is-signal-what-is-noise" title="Link to this heading">#</a></h1>
<p>Imagine that I want to send you a picture message. Let’s use “the signal” as the name for the message before I send it to you. Before transmission, the signal has a clear meaning which I am confident you will be able to interpret. However, imagine that I am sending you the message via an unreliable medium; a messaging system that is prone to corrupting messages when transmitting them.</p>
<p>When I send you the message, there is a decent chance that unwanted randomness will be added to the image file, because of technical problems with the transmission medium. This might result in an image which contains so much randomness that it is hard to discern the original signal.</p>
<p>Imagine that the cell below attempts to send my picture message - can you see what the signal is?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a noisy image array.</span>
<span class="n">noisy</span> <span class="o">=</span> <span class="n">generate_image</span><span class="p">()</span>  
<span class="n">show_attributes</span><span class="p">(</span><span class="n">noisy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: float64
Shape: (7, 7)
Max Pixel Value: 1.0
Min Pixel Value: -0.95
</pre></div>
</div>
<img alt="_images/94117ae07f12ab142ff9d3b341c60a7d760349f3f5cf956527683cfe33ae6afb.png" src="_images/94117ae07f12ab142ff9d3b341c60a7d760349f3f5cf956527683cfe33ae6afb.png" />
</div>
</div>
<p>Any ideas? Maybe you can determine what signal is in there, but we trust that it is at least somewhat ambiguous, to most readers.</p>
<p>We saw simple threshold filtering on an <a class="reference internal" href="3_skimage_processing_from_numpy_and_scipy.html"><span class="doc std std-doc">earlier page</span></a>. This is where we select a threshold value, and binarize the image using that value. So a given pixel becomes <code class="docutils literal notranslate"><span class="pre">True</span></code> if a pixel is more intense than the threshold, and <code class="docutils literal notranslate"><span class="pre">False</span></code> if it is lower (or vice versa, depending on the comparison operator).</p>
<p>The aim here is typically to split the pixels into distinct classes, based on their intensity values. We can use the <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code> method to view a historgram of the pixel intensities, in order to find a threshold that might be useful to use in a filter. The <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code> method “flattens” the image array to 1-D, so that it can be displayed as a histogram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The `shape` of the original `noisy` image.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">noisy</span><span class="p">)</span>
<span class="n">noisy</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-0.29 -0.9   0.05 -0.01  0.06 -0.84  0.15]
 [-0.55  0.8  -0.93  0.44 -0.67  0.3  -0.02]
 [-0.02  0.7   0.16  0.3   0.08 -0.05  0.05]
 [-0.68  0.63  0.2   0.78 -0.07  0.6  -0.88]
 [-0.05  0.93 -0.05  0.6  -0.95  1.    0.02]
 [-0.86  0.59 -0.19  0.75 -0.25  0.6  -0.17]
 [-0.94 -0.33 -0.64 -0.42 -0.06 -0.1   0.03]]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7, 7)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flatten to 1-D with the `.ravel()` method.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">noisy</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">noisy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.29 -0.9   0.05 -0.01  0.06 -0.84  0.15 -0.55  0.8  -0.93  0.44 -0.67
  0.3  -0.02 -0.02  0.7   0.16  0.3   0.08 -0.05  0.05 -0.68  0.63  0.2
  0.78 -0.07  0.6  -0.88 -0.05  0.93 -0.05  0.6  -0.95  1.    0.02 -0.86
  0.59 -0.19  0.75 -0.25  0.6  -0.17 -0.94 -0.33 -0.64 -0.42 -0.06 -0.1
  0.03]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(49,)
</pre></div>
</div>
</div>
</div>
<p>When we plot a histogram of the flattened image array, what we are doing is dividing the <span class="math notranslate nohighlight">\(x\)</span>-axis into intervals (e.g. 0 to 0.25), and then getting a count of how many pixel intensity values fall within each <span class="math notranslate nohighlight">\(x\)</span>-axis interval:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show a histogram of the pixel intensity values, from the &quot;flattened&quot; `noisy` array.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">noisy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> 
         <span class="n">bins</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span> <span class="c1"># Set a reasonable number of x-axis intervals.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/74c309b118b5c9004cfc78ad9024f67f3b8694f5cb468a039a4f399744f7de49.png" src="_images/74c309b118b5c9004cfc78ad9024f67f3b8694f5cb468a039a4f399744f7de49.png" />
</div>
</div>
<p>Ok, so it looks like the distribution is trimodal. The message image is in the <code class="docutils literal notranslate"><span class="pre">float64</span></code> <code class="docutils literal notranslate"><span class="pre">dtype</span></code>, using intensities ranging from -1 to 1. Let’s set a threshold filter for each dip, in between the three peaks. So, we’ll try once with a threshold of -0.50, and once with a threshold of 0.25. These threshold values are shown as vertical lines on the plot below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show a histogram of the pixel intensity values, with some thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">noisy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Threshold 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Threshold 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/764b4617c7b37a8045a056f6f259d122d439555b843b75af5b05826a95e6f4d3.png" src="_images/764b4617c7b37a8045a056f6f259d122d439555b843b75af5b05826a95e6f4d3.png" />
</div>
</div>
<p>The filters are created, using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> comparison operator, in the next two cells:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The first simple, Boolean threshold filter.</span>
<span class="n">simple_threshold_filter_1</span> <span class="o">=</span> <span class="n">noisy</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.50</span>
<span class="n">simple_threshold_filter_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ True, False,  True,  True,  True, False,  True],
       [False,  True, False,  True, False,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True],
       [False,  True,  True,  True,  True,  True, False],
       [ True,  True,  True,  True, False,  True,  True],
       [False,  True,  True,  True,  True,  True,  True],
       [False,  True, False,  True,  True,  True,  True]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second simple, Boolean threshold filter.</span>
<span class="n">simple_threshold_filter_2</span> <span class="o">=</span> <span class="n">noisy</span> <span class="o">&gt;</span> <span class="mf">0.25</span>
<span class="n">simple_threshold_filter_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[False, False, False, False, False, False, False],
       [False,  True, False,  True, False,  True, False],
       [False,  True, False,  True, False, False, False],
       [False,  True, False,  True, False,  True, False],
       [False,  True, False,  True, False,  True, False],
       [False,  True, False,  True, False,  True, False],
       [False, False, False, False, False, False, False]])
</pre></div>
</div>
</div>
</div>
<p>Each threshold filter is just a Boolean array, with the same <code class="docutils literal notranslate"><span class="pre">.shape</span></code> as the image. When we render these arrays with Matplotlib, we will see a binary image, where <code class="docutils literal notranslate"><span class="pre">True</span></code> values are mapped to white and <code class="docutils literal notranslate"><span class="pre">False</span></code> values are mapped to 0.</p>
<p>Because we used the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> comparison operator, only pixels larger than the threshold values will be <code class="docutils literal notranslate"><span class="pre">True</span></code>. Let’s see if this clears up any of the noise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Threshold filters.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Threshold = -0.5&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simple_threshold_filter_1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Threshold = 0.25&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simple_threshold_filter_2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a48183f99d0dcc8f34c1e9544952377ffa0572c0adcb0d5a8098eb2dd44d834f.png" src="_images/a48183f99d0dcc8f34c1e9544952377ffa0572c0adcb0d5a8098eb2dd44d834f.png" />
</div>
</div>
<p>Ok, so the first image still looks very noisy still, but the second looks like we might be getting somewhere. Maybe you can already guess what the original signal was…</p>
<p>Let’s loop through some other threshold values, between just below 0 to just larger than 0.25, to see if the clarity of the signal improves:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through some different threshold values, and plot the results.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">n_plots</span><span class="o">=</span><span class="mi">6</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> 
                                    <span class="n">stop</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> 
                                    <span class="n">num</span><span class="o">=</span><span class="n">n_plots</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_plots</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Threshold =</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy</span> <span class="o">&gt;</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a574f15e1f25629184173e9596a9239654723022d16b8851972374c4e9a0a2fe.png" src="_images/a574f15e1f25629184173e9596a9239654723022d16b8851972374c4e9a0a2fe.png" />
</div>
</div>
<p>We hope you feel suitably greeted! The threshold of 0.18 seems to reveal what signal was originally in this image, before the unwanted random noise was added, by the faulty transmission system.</p>
<p>Here we have recovered a signal from a noisy image, and made the features in the image easier to discern. You’ll notice that we had to try numerous threshold values to find the “sweet spot” with the best results. Other values “overshoot” and “undershoot” the optimum value.</p>
<p>Here was the original image, before the noise was added:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">original_image</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c3bdc4fe3f57a35ca0b41dc98ec0729ffe1ae1cf3eae4e5f2e8da778a4358e0a.png" src="_images/c3bdc4fe3f57a35ca0b41dc98ec0729ffe1ae1cf3eae4e5f2e8da778a4358e0a.png" />
</div>
</div>
<p>Reducing noise and enhancing image features are both common aims in image filtering. Both processes often require some trial and error with different values for optional arguments that go into the filtering operation, as it did here. We will now turn to some other common methods for threshold filtering, using a variety of other images.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Threshold Filtering<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<p>As we have seen, threshold filtering invovles modifying pixel values based on a threshold value. Let’s investigate other thresholding methods using a greyscale image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a greyscale image array.</span>
<span class="n">random_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">random_i</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0 0 0 0 0 0 0 0]
 [0 0 0 4 8 0 0 0]
 [0 0 0 3 8 0 0 0]
 [0 0 0 0 0 0 0 0]
 [0 0 0 4 5 0 0 0]
 [0 0 0 3 4 0 0 0]
 [0 0 0 3 5 0 0 0]
 [0 0 0 3 9 0 0 0]
 [0 0 0 7 6 0 0 0]
 [0 0 0 0 0 0 0 0]]
</pre></div>
</div>
<img alt="_images/1152ca9ff91544f0e95d3a57714c45c188bc7a30e93201c9188eb5d12e49343e.png" src="_images/1152ca9ff91544f0e95d3a57714c45c188bc7a30e93201c9188eb5d12e49343e.png" />
</div>
</div>
<p>As we saw above, it is simple to create a Boolean filter, using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> comparison operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a Boolean array using a comparison operator.</span>
<span class="n">random_i_thresholded</span> <span class="o">=</span> <span class="n">random_i</span> <span class="o">&gt;</span> <span class="mi">5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_i_thresholded</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">random_i_thresholded</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[False False False False False False False False]
 [False False False False  True False False False]
 [False False False False  True False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False  True False False False]
 [False False False  True  True False False False]
 [False False False False False False False False]]
</pre></div>
</div>
<img alt="_images/b42b2e6772ed014a2096fe13aae7b9053b350d44ed68430d912219e276a230b6.png" src="_images/b42b2e6772ed014a2096fe13aae7b9053b350d44ed68430d912219e276a230b6.png" />
</div>
</div>
<p>This filters <em>out</em> pixels <em>below</em> the threshold value (5), by setting them to 0/<code class="docutils literal notranslate"><span class="pre">False</span></code>. Different threshold values will allow more or less pixels to “survive” the filtering operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A sole survivor!</span>
<span class="n">random_i_filtered_9</span> <span class="o">=</span> <span class="n">random_i</span> <span class="o">&gt;=</span> <span class="mi">9</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_i_filtered_9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">random_i_filtered_9</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False  True False False False]
 [False False False False False False False False]
 [False False False False False False False False]]
</pre></div>
</div>
<img alt="_images/eb6f6a50eb12333909ba5459a97a3b60683a73d7027b7972a0ed80448e903ea5.png" src="_images/eb6f6a50eb12333909ba5459a97a3b60683a73d7027b7972a0ed80448e903ea5.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="image-segmentation-via-threshold-filtering">
<h1>Image segmentation via threshold filtering<a class="headerlink" href="#image-segmentation-via-threshold-filtering" title="Link to this heading">#</a></h1>
<p>This threshold filtering technique can be useful for segregating the foreground from the background of real images, like <code class="docutils literal notranslate"><span class="pre">camera</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the `camera` image from `ski.data`.</span>
<span class="n">camera</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span>
<span class="c1"># Show the &quot;raw&quot; `camera` array.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="c1"># Show `camera` graphically.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[200 200 200 ... 189 190 190]
 [200 199 199 ... 190 190 190]
 [199 199 199 ... 190 190 190]
 ...
 [ 25  25  27 ... 139 122 147]
 [ 25  25  26 ... 158 141 168]
 [ 25  25  27 ... 151 152 149]]
</pre></div>
</div>
<img alt="_images/e53f3a3c5fc0ef4d094fb066bd80afdff2b0805a193caae078567661d17d0c3d.png" src="_images/e53f3a3c5fc0ef4d094fb066bd80afdff2b0805a193caae078567661d17d0c3d.png" />
</div>
</div>
<p>We can again use the NumPy <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">camera</span></code> array to allow us to view a histogram of the pixel intensities. We set the number of bins (<span class="math notranslate nohighlight">\(x\)</span>-axis intervals) for the histogram to be 128, to keep the plot looking smooth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot a histogram of the `camera` pixel intensities, with 128 bins.</span>
<span class="n">n_bins</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a4ac39ae9ac022a15e82a08d868278a23a6f5379180d69bec0c2acfa9a097a83.png" src="_images/a4ac39ae9ac022a15e82a08d868278a23a6f5379180d69bec0c2acfa9a097a83.png" />
</div>
</div>
<p>The “bins” are the intervals along the <span class="math notranslate nohighlight">\(x\)</span>-axis in which pixel intensity values are counted to determine the height of the blue “hills” in the histogram above, within a given interval. It is important, when thresholding, to choose a sensible number of bins. Too few bins we miss important information, because we are cramming many disparate pixel intensity values into one bin. Too many bins and we clutter our histogram with lots of spikes which occlude the general pattern.</p>
<p>To illustrate this, the plot below shows the <code class="docutils literal notranslate"><span class="pre">camera</span></code> pixel intensity histograms, with too few and too many bins. The bin interval starts and ends are indicated with vertical red lines. The height on the histogram, for a given bin, is determined by the <code class="docutils literal notranslate"><span class="pre">Pixel</span> <span class="pre">Count</span></code> falling with the range of intensities for that bin:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some plot formatting parameters (to show the bins).</span>
<span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
<span class="n">markersize</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># Too few bins...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">n_bins_few</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins_few</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_bins_few</span><span class="si">}</span><span class="s2"> bins. Too few!&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">colours</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
            <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Too many bins...</span>
<span class="n">n_bins_many</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_bins_many</span><span class="si">}</span><span class="s2"> bins. Too many!&quot;</span><span class="p">)</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins_many</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/af99a57f3aeb547f6e2d9efba408455017829e0c57f848de60fcbd859d962d26.png" src="_images/af99a57f3aeb547f6e2d9efba408455017829e0c57f848de60fcbd859d962d26.png" />
</div>
</div>
<p>128 bins gives us a good middle ground, where we can see patterns in the distribution easily, without losing information or overemphasising unrepresentative values. Using the sensible number of bins, the distribution is clearly trimodal, with a clear dip/separation around between 50 and 100-ish, and another just before 200-ish. This locations are indicated on the plot with vertical lines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show some &quot;by eye&quot; thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/901ac070e617a78fee681a2f5d14c8511086f9e62c5d176eb675fec453253e45.png" src="_images/901ac070e617a78fee681a2f5d14c8511086f9e62c5d176eb675fec453253e45.png" />
</div>
</div>
<p>Let’s use these “by eye” crude threshold values and apply a threshold filter using them. Remember, our aim here is to separate the pixels into distinct classes; these two distinct pixel classes will hopefully correspond to the foreground and background of the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a threshold, &quot;by eye&quot;.</span>
<span class="n">crude_threshold</span> <span class="o">=</span> <span class="mi">80</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the filter.</span>
<span class="n">camera_threshold_filtered</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">camera_threshold_filtered</span> <span class="o">=</span> <span class="n">camera_threshold_filtered</span> <span class="o">&lt;</span> <span class="n">crude_threshold</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_threshold_filtered</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b835ff6c75a5548764d8b7f8c8f87d4ae96c7b9f7d84a89de061773978ca3fc3.png" src="_images/b835ff6c75a5548764d8b7f8c8f87d4ae96c7b9f7d84a89de061773978ca3fc3.png" />
</div>
</div>
<p>That has worked fairly well, as far as it goes, for segmenting the foreground (the cameraman) away from the background (the field and buildings behind the cameraman).</p>
<p>We can show the “opposite” binary image, by reversing the comparison operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using the &quot;opposite&quot; comparison operator.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span> <span class="o">&gt;</span> <span class="n">crude_threshold</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3129b852b6217c30661f5c58874cb8672c9824e40f7a6614330c83e7d3977703.png" src="_images/3129b852b6217c30661f5c58874cb8672c9824e40f7a6614330c83e7d3977703.png" />
</div>
</div>
<p>Stylish! Someone should put that on a t-shirt…</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="threshold-filters-in-skimage">
<h1>Threshold filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code><a class="headerlink" href="#threshold-filters-in-skimage" title="Link to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">skimage</span></code> contains many threshold filters, the cell below uses the <code class="docutils literal notranslate"><span class="pre">dir()</span></code> function to show the available selection:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the `skimage` threshold filters.</span>
<span class="p">[</span><span class="n">fil</span> <span class="k">for</span> <span class="n">fil</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span> <span class="k">if</span> <span class="n">fil</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;threshold_isodata&#39;,
 &#39;threshold_li&#39;,
 &#39;threshold_local&#39;,
 &#39;threshold_mean&#39;,
 &#39;threshold_minimum&#39;,
 &#39;threshold_multiotsu&#39;,
 &#39;threshold_niblack&#39;,
 &#39;threshold_otsu&#39;,
 &#39;threshold_sauvola&#39;,
 &#39;threshold_triangle&#39;,
 &#39;threshold_yen&#39;]
</pre></div>
</div>
</div>
</div>
<p>These filters typically, when passed an image array, find a threshold value automatically - e.g. at value at which to binarize the image to split the pixels into distinct classes. These distinct pixel classes often correspond to distinct <em>features</em> or <em>regions</em> in the image (cameraman vs field, foreground vs background etc.). The threshold value search performed by the <code class="docutils literal notranslate"><span class="pre">ski.filter.threshold*</span></code> functions aims to maximize the separation between pixel classes, and the different available functions use different algorithms to identify the “best” threshold value(s).</p>
<p>One simple method, similar to the “look at the histogram” method we just used above, is the <a class="reference external" href="https://en.wikipedia.org/wiki/Otsu%27s_method">Otsu method</a>. This aims to divide pixels into <em>two</em> distinct classes, by mathematically analysing a histogram of the pixel intensities. Below we use the <code class="docutils literal notranslate"><span class="pre">ski.filters.threshold_otsu()</span></code> function to recommend a threshold value, to segment our image into two separate pixel classes.</p>
<p>By specifying the <code class="docutils literal notranslate"><span class="pre">nbins</span></code> argument, we instruct the <code class="docutils literal notranslate"><span class="pre">.threshold_otsu()</span></code> function to analyse a histogram which has the same number of bins as the one we were using above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pass our `camera` array to the `threshold_otsu()` function.</span>
<span class="n">otsu_thresh</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">threshold_otsu</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> 
                                         <span class="n">nbins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>

<span class="c1"># Show the Otsu threshold</span>
<span class="n">otsu_thresh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(102)
</pre></div>
</div>
</div>
</div>
<p>We show the Otsu threshold (<code class="docutils literal notranslate"><span class="pre">otsu_thesh</span></code>) as a vertical line on the histogram below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the pixel intensities, and the Otsu threshold.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_thresh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Otsu Threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1fd47f0e97f5dee4a6a23dd5439b30742ea79b981fee44b8f3e8b41cc5080afa.png" src="_images/1fd47f0e97f5dee4a6a23dd5439b30742ea79b981fee44b8f3e8b41cc5080afa.png" />
</div>
</div>
<p>You can see that the method finds a threshold is pretty close to the one we chose “by eye” earlier on the page. Let’s apply the Otsu filter, simply by using <code class="docutils literal notranslate"><span class="pre">camera</span> <span class="pre">&lt;</span> <span class="pre">otsu_thresh</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter in the image using the Otsu threshold.</span>
<span class="n">camera_otsu_filtered</span> <span class="o">=</span> <span class="n">camera</span> <span class="o">&lt;</span> <span class="n">otsu_thresh</span>

<span class="c1"># Show a plot of the whole Otsu filtering process.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_thresh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Otsu threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_otsu_filtered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Otsu filtered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/837a5b2ff1bb4f02d397f7bfdf9079eb04b0e6d0f6f63f27100c82dedb31ac08.png" src="_images/837a5b2ff1bb4f02d397f7bfdf9079eb04b0e6d0f6f63f27100c82dedb31ac08.png" />
</div>
</div>
<p>If you look at the filtered image (on the right hand side of the plot), it seems to have achieved pretty good foreground/background segmentation…</p>
<p>How does the Otsu threshold filter work? Conceptually, the Otsu method involves splitting the histogram into two parts, lots of times, and comparing different splits for how well they separate pixels into two classes, based on a specific numeric metric. The histogram, for each threshold, is split at the center one of the bin intervals.</p>
<p>The aim is to find which bin interval center gives a split that yields two classes of pixels which are maximally different from one another, by the aforementioned numeric metric. Hopefully this corresponds to pixels forming the background of the image vs pixels forming the forground of the image.</p>
<p>Since the Otsu method relies on some the “mechanics” of histograms, let’s “deconstruct” the histogram in the center of the plot above, to see how the method works. To perform this deconstruction, we can use the <code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code> function. We give it a flattened 1-D image array (e.g. flattened with the <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code> method), and we tell it a number of bins to use. Again, we will use the sensible value of 128 bins. (<em>Note</em>: you could also use <code class="docutils literal notranslate"><span class="pre">ski.exposure.histogram()</span></code> here, for similar results).</p>
<p><code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code> will return two arrays. The first is the pixel count within each bin, so in this case we will get 128 individual numbers, because there are 128 bins. We will call this array <code class="docutils literal notranslate"><span class="pre">counts</span></code>. These <code class="docutils literal notranslate"><span class="pre">counts</span></code> determine the height of the histogram over each bin. The first <code class="docutils literal notranslate"><span class="pre">count</span></code> is for the first bin, the second <code class="docutils literal notranslate"><span class="pre">count</span></code> is for the second bin, and so on, as we move along the <span class="math notranslate nohighlight">\(x\)</span>-axis from left to right.</p>
<p>The second array returned by <code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code> contains the start point of each bin (e.g. each <span class="math notranslate nohighlight">\(x\)</span>-axis interval within which we get the <code class="docutils literal notranslate"><span class="pre">Pixel</span> <span class="pre">Count</span></code>). We will call this array <code class="docutils literal notranslate"><span class="pre">edges</span></code>.</p>
<p>The size of each array will vary, based on the number of bins we ask NumPy to use to make the histogram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get `counts` and `edges`.</span>
<span class="n">counts</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> 
                             <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show counts.</span>
<span class="n">counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   2,  628, 5624, 3516, 1844, 1479, 1427, 1464, 1605, 2272, 3101,
       4955, 7451, 9584, 9191, 6119, 3754, 2452, 1677, 1288,  988,  885,
        901,  837,  796,  640,  602,  566,  582,  480,  456,  404,  382,
        398,  352,  316,  343,  350,  314,  312,  289,  324,  308,  314,
        296,  320,  304,  315,  343,  399,  410,  424,  414,  412,  484,
        495,  573,  632,  777,  861,  940, 1033, 1213, 1368, 1492, 1783,
       1951, 2164, 2392, 2610, 3001, 3338, 3911, 4233, 4340, 4759, 5196,
       5341, 5398, 5428, 5104, 4808, 4051, 3360, 2588, 2067, 1582, 1352,
       1186,  997,  860,  773,  706,  566,  569, 1877, 2709, 3980, 6792,
       6318, 7477, 6217, 5413, 8153, 7025, 6540, 5459, 3523, 1825, 1074,
       1713,  710,  316,  330,  472,  412,  324,  275,  157,  135,  201,
         66,   73,   95,  102,  128,  198,  564])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show `edges`.</span>
<span class="n">edges</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  0.  ,   1.99,   3.98,   5.98,   7.97,   9.96,  11.95,  13.95,
        15.94,  17.93,  19.92,  21.91,  23.91,  25.9 ,  27.89,  29.88,
        31.88,  33.87,  35.86,  37.85,  39.84,  41.84,  43.83,  45.82,
        47.81,  49.8 ,  51.8 ,  53.79,  55.78,  57.77,  59.77,  61.76,
        63.75,  65.74,  67.73,  69.73,  71.72,  73.71,  75.7 ,  77.7 ,
        79.69,  81.68,  83.67,  85.66,  87.66,  89.65,  91.64,  93.63,
        95.62,  97.62,  99.61, 101.6 , 103.59, 105.59, 107.58, 109.57,
       111.56, 113.55, 115.55, 117.54, 119.53, 121.52, 123.52, 125.51,
       127.5 , 129.49, 131.48, 133.48, 135.47, 137.46, 139.45, 141.45,
       143.44, 145.43, 147.42, 149.41, 151.41, 153.4 , 155.39, 157.38,
       159.38, 161.37, 163.36, 165.35, 167.34, 169.34, 171.33, 173.32,
       175.31, 177.3 , 179.3 , 181.29, 183.28, 185.27, 187.27, 189.26,
       191.25, 193.24, 195.23, 197.23, 199.22, 201.21, 203.2 , 205.2 ,
       207.19, 209.18, 211.17, 213.16, 215.16, 217.15, 219.14, 221.13,
       223.12, 225.12, 227.11, 229.1 , 231.09, 233.09, 235.08, 237.07,
       239.06, 241.05, 243.05, 245.04, 247.03, 249.02, 251.02, 253.01,
       255.  ])
</pre></div>
</div>
</div>
</div>
<p>Look at the first two values in the <code class="docutils literal notranslate"><span class="pre">edges</span></code> array, they form the interval for the first bin. So the first bin interval runs between 0 and 1.99, the second interval runs between the next two values of 1.99 and 3.98 and so on.</p>
<p>Each value in <code class="docutils literal notranslate"><span class="pre">counts</span></code> is the count of pixel intensity values in <code class="docutils literal notranslate"><span class="pre">camera</span></code> which fall within the corresponding interval. Let’s check this is correct by Boolean indexing <code class="docutils literal notranslate"><span class="pre">camera</span></code> to see how many pixels fall within the first interval (0 to 1.99):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For the first bin interval.</span>
<span class="n">camera</span><span class="p">[(</span><span class="n">camera</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera</span> <span class="o">&lt;=</span> <span class="mf">1.99</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>Sure enough there are two pixels in the interval, which corresponds to the first value in the <code class="docutils literal notranslate"><span class="pre">counts</span></code> array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The first value in the `counts` array.</span>
<span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(2)
</pre></div>
</div>
</div>
</div>
<p>The second interval (e.g. the next two <code class="docutils literal notranslate"><span class="pre">edges</span></code> values) runs between 1.99 and 3.98. The second value of the <code class="docutils literal notranslate"><span class="pre">counts</span></code> array is 628, so there should be 628 pixels within this interval:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second value in `counts`.</span>
<span class="n">counts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(628)
</pre></div>
</div>
</div>
</div>
<p>Let’s manually get the pixels in <code class="docutils literal notranslate"><span class="pre">camera</span></code> which fall in this second bin interval:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For the second bin interval.</span>
<span class="n">camera</span><span class="p">[(</span><span class="n">camera</span> <span class="o">&gt;</span> <span class="mf">1.99</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera</span> <span class="o">&lt;=</span> <span class="mf">3.98</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 2, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 2,
       2, 3, 2, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>It certainly looks like there could be 600+ values in there! We don’t feel like counting, so let’s verify how many pixels there are in this bin interval using <code class="docutils literal notranslate"><span class="pre">len()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count the pixels in the second bin interval.</span>
<span class="nb">len</span><span class="p">(</span><span class="n">camera</span><span class="p">[(</span><span class="n">camera</span> <span class="o">&gt;</span> <span class="mf">1.99</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera</span> <span class="o">&lt;=</span> <span class="mf">3.98</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>628
</pre></div>
</div>
</div>
</div>
<p>So, each adjacent pair of numbers in <code class="docutils literal notranslate"><span class="pre">edges</span></code> tells us the range of each bin interval, and the corresponding value in <code class="docutils literal notranslate"><span class="pre">counts</span></code> tells us the height on the histogram within that interval. The image below shows the first, second, third and final (128th) interval in the <code class="docutils literal notranslate"><span class="pre">edges</span></code> array:</p>
<p><img alt="" src="_images/hist_bins.png" /></p>
<p>Ok, so we now have our deconstructed histogram. To implement the Otsu method, we next need to find the center of each bin interval (e.g. the middle point between the lower and higher number in each pair). Once we have the bin centers, we can use those to start splitting the histogram in two, to find the split that gives us the two most distinct groupings of pixels, on either side of the split. This is a simple calculation, we can get the start value of each bin interval with the following slicing operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The first value of each bin interval.</span>
<span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  0.  ,   1.99,   3.98,   5.98,   7.97,   9.96,  11.95,  13.95,
        15.94,  17.93,  19.92,  21.91,  23.91,  25.9 ,  27.89,  29.88,
        31.88,  33.87,  35.86,  37.85,  39.84,  41.84,  43.83,  45.82,
        47.81,  49.8 ,  51.8 ,  53.79,  55.78,  57.77,  59.77,  61.76,
        63.75,  65.74,  67.73,  69.73,  71.72,  73.71,  75.7 ,  77.7 ,
        79.69,  81.68,  83.67,  85.66,  87.66,  89.65,  91.64,  93.63,
        95.62,  97.62,  99.61, 101.6 , 103.59, 105.59, 107.58, 109.57,
       111.56, 113.55, 115.55, 117.54, 119.53, 121.52, 123.52, 125.51,
       127.5 , 129.49, 131.48, 133.48, 135.47, 137.46, 139.45, 141.45,
       143.44, 145.43, 147.42, 149.41, 151.41, 153.4 , 155.39, 157.38,
       159.38, 161.37, 163.36, 165.35, 167.34, 169.34, 171.33, 173.32,
       175.31, 177.3 , 179.3 , 181.29, 183.28, 185.27, 187.27, 189.26,
       191.25, 193.24, 195.23, 197.23, 199.22, 201.21, 203.2 , 205.2 ,
       207.19, 209.18, 211.17, 213.16, 215.16, 217.15, 219.14, 221.13,
       223.12, 225.12, 227.11, 229.1 , 231.09, 233.09, 235.08, 237.07,
       239.06, 241.05, 243.05, 245.04, 247.03, 249.02, 251.02, 253.01])
</pre></div>
</div>
</div>
</div>
<p>…and we can get the second value of each bin interval with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second value of each interval.</span>
<span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  1.99,   3.98,   5.98,   7.97,   9.96,  11.95,  13.95,  15.94,
        17.93,  19.92,  21.91,  23.91,  25.9 ,  27.89,  29.88,  31.88,
        33.87,  35.86,  37.85,  39.84,  41.84,  43.83,  45.82,  47.81,
        49.8 ,  51.8 ,  53.79,  55.78,  57.77,  59.77,  61.76,  63.75,
        65.74,  67.73,  69.73,  71.72,  73.71,  75.7 ,  77.7 ,  79.69,
        81.68,  83.67,  85.66,  87.66,  89.65,  91.64,  93.63,  95.62,
        97.62,  99.61, 101.6 , 103.59, 105.59, 107.58, 109.57, 111.56,
       113.55, 115.55, 117.54, 119.53, 121.52, 123.52, 125.51, 127.5 ,
       129.49, 131.48, 133.48, 135.47, 137.46, 139.45, 141.45, 143.44,
       145.43, 147.42, 149.41, 151.41, 153.4 , 155.39, 157.38, 159.38,
       161.37, 163.36, 165.35, 167.34, 169.34, 171.33, 173.32, 175.31,
       177.3 , 179.3 , 181.29, 183.28, 185.27, 187.27, 189.26, 191.25,
       193.24, 195.23, 197.23, 199.22, 201.21, 203.2 , 205.2 , 207.19,
       209.18, 211.17, 213.16, 215.16, 217.15, 219.14, 221.13, 223.12,
       225.12, 227.11, 229.1 , 231.09, 233.09, 235.08, 237.07, 239.06,
       241.05, 243.05, 245.04, 247.03, 249.02, 251.02, 253.01, 255.  ])
</pre></div>
</div>
</div>
</div>
<p>Check the numbers in these two arrays against the image above (of the bin intervals) to verify they are correct. To get the bin center points, we just take the average of each pair:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the center of each bin.</span>
<span class="n">bin_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">bin_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  1.  ,   2.99,   4.98,   6.97,   8.96,  10.96,  12.95,  14.94,
        16.93,  18.93,  20.92,  22.91,  24.9 ,  26.89,  28.89,  30.88,
        32.87,  34.86,  36.86,  38.85,  40.84,  42.83,  44.82,  46.82,
        48.81,  50.8 ,  52.79,  54.79,  56.78,  58.77,  60.76,  62.75,
        64.75,  66.74,  68.73,  70.72,  72.71,  74.71,  76.7 ,  78.69,
        80.68,  82.68,  84.67,  86.66,  88.65,  90.64,  92.64,  94.63,
        96.62,  98.61, 100.61, 102.6 , 104.59, 106.58, 108.57, 110.57,
       112.56, 114.55, 116.54, 118.54, 120.53, 122.52, 124.51, 126.5 ,
       128.5 , 130.49, 132.48, 134.47, 136.46, 138.46, 140.45, 142.44,
       144.43, 146.43, 148.42, 150.41, 152.4 , 154.39, 156.39, 158.38,
       160.37, 162.36, 164.36, 166.35, 168.34, 170.33, 172.32, 174.32,
       176.31, 178.3 , 180.29, 182.29, 184.28, 186.27, 188.26, 190.25,
       192.25, 194.24, 196.23, 198.22, 200.21, 202.21, 204.2 , 206.19,
       208.18, 210.18, 212.17, 214.16, 216.15, 218.14, 220.14, 222.13,
       224.12, 226.11, 228.11, 230.1 , 232.09, 234.08, 236.07, 238.07,
       240.06, 242.05, 244.04, 246.04, 248.03, 250.02, 252.01, 254.  ])
</pre></div>
</div>
</div>
</div>
<p>You’ll see that if we plot our <code class="docutils literal notranslate"><span class="pre">bin_centers</span></code> (<span class="math notranslate nohighlight">\(x\)</span>-axis) and our pixel <code class="docutils literal notranslate"><span class="pre">counts</span></code> (<span class="math notranslate nohighlight">\(y\)</span>-axis) we get something very much resembling the <code class="docutils literal notranslate"><span class="pre">camera</span></code> histogram, with 128 bins. Below the original <code class="docutils literal notranslate"><span class="pre">camera</span></code> histogram is shown on the left, and the plot of the <code class="docutils literal notranslate"><span class="pre">bin_centers</span></code> and <code class="docutils literal notranslate"><span class="pre">counts</span></code> arrays is shown on the right:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original `camera` histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bin Centers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Bin centers vs pixel counts&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/722783152dc9ef887b1aa7c68f82cc6cc4fe1b31bdce7f09d83c5db84be6d2a3.png" src="_images/722783152dc9ef887b1aa7c68f82cc6cc4fe1b31bdce7f09d83c5db84be6d2a3.png" />
</div>
</div>
<p>To implement the Otsu filter, we “split” the histogram into two sides, at a given bin center. We can think of this as creating two separate histograms. Here is a visualisation of splitting at the 50th bin center (which is centered on the pixel intensity value of 98.6). The location of the “split” is shown as a thick, dashed line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The 50th bin center value.</span>
<span class="n">bin_centers</span><span class="p">[</span><span class="mi">49</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(98.61328125)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A function to visualise different threshold values.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_bins_with_threshold</span><span class="p">(</span><span class="n">threshold_bin_number</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">[:</span><span class="n">threshold_bin_number</span><span class="p">],</span> <span class="n">counts</span><span class="p">[:</span><span class="n">threshold_bin_number</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Left Side Histogram&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">:],</span> <span class="n">counts</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Right Side Histogram&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Threshold&#39;</span><span class="p">,</span> 
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bin Centers&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Threshold Pixel Intensity = </span><span class="si">{</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([]);</span>

<span class="c1"># Generate the plot.</span>
<span class="n">plot_bins_with_threshold</span><span class="p">(</span><span class="mi">49</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0aac73c648b8a8bdb323143d006a5798accbe7fe2ab912ff6f128e7557d45f45.png" src="_images/0aac73c648b8a8bdb323143d006a5798accbe7fe2ab912ff6f128e7557d45f45.png" />
</div>
</div>
<p>We now effectively have two histograms, the red one (below the 50th bin center; below a pixel intensity value of 98.6), and the green one (above the 50th bin center; above a pixel intensity value of 98.6).</p>
<p>We can choose any bin center for the threshold, in fact, the Otsu filtering process will compare all possible thresholds/splits, comparing all of the bin centers. Multiple different splits are visualised below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise multiple thresholds.</span>
<span class="n">n_threshold_plots</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold_bin_num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_threshold_plots</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plot_bins_with_threshold</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e73079da443465039f109a19e8012c7f4571208cd793a56c9e2f0494a9a5b147.png" src="_images/e73079da443465039f109a19e8012c7f4571208cd793a56c9e2f0494a9a5b147.png" />
</div>
</div>
<p>Once we have “split” the histogram, we calculate the mean of the pixel intensity values in the left-hand histogram, and the mean of the pixel intensity values in the right-hand histogram (e.g. either side of the split).</p>
<p>Then we calculate the sum of squared deviations (<code class="docutils literal notranslate"><span class="pre">ssd</span></code>) for each side of the histogram, each around its respective mean. This gives a metric of how “spread out” the values in each histogram are, around each mean.</p>
<p><em>It is this <code class="docutils literal notranslate"><span class="pre">ssd</span></code> metric which can allow us to select the “best” threshold; for giving distinct pixel classes…</em></p>
<p>The cell below defines a function which calculates the sum of the squared deviations, for a given histogram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">centers</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Sum of squared deviations from mean &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">centers</span> <span class="o">*</span> <span class="n">counts</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">ssd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts</span> <span class="o">*</span> <span class="p">((</span><span class="n">centers</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">ssd</span><span class="p">,</span> <span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use this function to calculate the mean and <code class="docutils literal notranslate"><span class="pre">ssd</span></code> of each histogram, when using the 50th bin center as the threshold:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The mean and SSD for the left hand histogram.</span>
<span class="n">mean_below_50th_bin</span><span class="p">,</span> <span class="n">ssd_below_50th_bin</span><span class="p">,</span> <span class="n">n_below_50th_bin</span>  <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[:</span><span class="mi">49</span><span class="p">],</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="mi">49</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of histogram below the 50th bin:&quot;</span><span class="p">,</span> <span class="n">mean_below_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SSD of histogram  below the 50th bin:&quot;</span><span class="p">,</span> <span class="n">ssd_below_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean of histogram below the 50th bin: 29.44
SSD of histogram  below the 50th bin: 27737445.29
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The mean and SSD for the right hand histogram.</span>
<span class="n">mean_above_50th_bin</span><span class="p">,</span> <span class="n">ssd_above_50th_bin</span><span class="p">,</span> <span class="n">n_above_50th_bin</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="mi">49</span><span class="p">:],</span> <span class="n">bin_centers</span><span class="p">[</span><span class="mi">49</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of histogram above the 50th bin:&quot;</span><span class="p">,</span> <span class="n">mean_above_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SSD of histogram above the 50th bin:&quot;</span><span class="p">,</span> <span class="n">ssd_above_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean of histogram above the 50th bin: 175.33
SSD of histogram above the 50th bin: 174551091.73
</pre></div>
</div>
</div>
</div>
<p>The cell below defines a convenience plotting function, the mean of each histogram is shown on the plot, as a vertical line in the same colour as the histogram that it corresponds to (left or right). A horizontal line around each mean indicates the spread around that mean (FYI this spread has been converted back to the original scale of the plot, rather than the squared value of the <code class="docutils literal notranslate"><span class="pre">ssd</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A convenience plotting function.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">plot_bins_with_threshold</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">)</span>
    
    <span class="c1"># Histogram 1</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span>
    <span class="n">mean_1</span><span class="p">,</span> <span class="n">ssd_1</span><span class="p">,</span> <span class="n">n_1</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[:</span><span class="n">threshold_bin_num</span><span class="p">],</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="n">threshold_bin_num</span><span class="p">])</span>
    <span class="n">std_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ssd_1</span><span class="o">/</span><span class="n">n_1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean and Spread (Left Histogram)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">mean_1</span> <span class="o">-</span> <span class="n">std_1</span><span class="p">,</span> <span class="n">mean_1</span> <span class="o">+</span> <span class="n">std_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">)</span>
    
    <span class="c1"># Histogram 2</span>
    <span class="n">hist_number</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span>
    <span class="n">mean_2</span><span class="p">,</span> <span class="n">ssd_2</span><span class="p">,</span> <span class="n">n_2</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">threshold_bin_num</span><span class="p">:],</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_num</span><span class="p">:])</span>
    <span class="n">std_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ssd_2</span><span class="o">/</span><span class="n">n_2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean and Spread (Right Histogram)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">mean_2</span> <span class="o">-</span> <span class="n">std_2</span><span class="p">,</span> <span class="n">mean_2</span> <span class="o">+</span> <span class="n">std_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_total_SSD</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">total_SSD</span> <span class="o">=</span> <span class="n">ssd_1</span> <span class="o">+</span> <span class="n">ssd_2</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Threshold Pixel Intensity = </span><span class="si">{</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_num</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">Total SSD: </span><span class="si">{</span><span class="n">total_SSD</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="c1"># Add both means to the plot.</span>
<span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="mi">49</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/21d1baf4c3bd0b0ecf710f3fbc272c1d89b1541ba69c7f282b12a51bcfed8eaf.png" src="_images/21d1baf4c3bd0b0ecf710f3fbc272c1d89b1541ba69c7f282b12a51bcfed8eaf.png" />
</div>
</div>
<p>Different threshold values change the mean and the spread (<code class="docutils literal notranslate"><span class="pre">ssd</span></code>) of each histogram. For each different split visualised below, pay attention to the width of the spread around each mean (e.g. the horizontal lines coming off the vertical line for each mean). This will let you see how the different splits influence the mean and the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> of each histogram, when we compare the left histogram vs right histogram, for a given split:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise multiple thresholds.</span>
<span class="n">n_threshold_plots</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold_bin_num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_threshold_plots</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Add both means to the plot.</span>
    <span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">2</span> != 0:
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7e9e43b989ad6a031e1205741ce5be07c1bbf1504a1a9ea4dc0a3658a66f94b2.png" src="_images/7e9e43b989ad6a031e1205741ce5be07c1bbf1504a1a9ea4dc0a3658a66f94b2.png" />
</div>
</div>
<p>In Otsu’s method, we want to find the threshold value which gives the <em>minimum total <code class="docutils literal notranslate"><span class="pre">ssd</span></code></em> - e.g. the smallest value of the combined spread when we add together the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> values for each histogram. This value corresponds to the <em>maximum between pixel class variance</em>, when comparing each side of the histogram.</p>
<p>In other words, the threshold value which gives the lowest combined <code class="docutils literal notranslate"><span class="pre">ssd</span></code> identifies two classes of pixels that are most different from each other, compared to other classes/splits we could choose, according the metric that the Otsu method cares about (the <code class="docutils literal notranslate"><span class="pre">ssd</span></code>).</p>
<p>You can think of this as finding a threshold which groups pixels such that the pixel values in each side of the “split” are clustered closely around their respective mean. In fact, it turns out minimizing the total <code class="docutils literal notranslate"><span class="pre">ssd</span></code> also has the effect that the <em>distance</em> between the means will be large as well giving a big separation between the pixels in each class as a result.</p>
<p>The cell below will find the threshold which gives the minimum combined <code class="docutils literal notranslate"><span class="pre">ssd</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An empty list to store all the `ssd` values, for all bin centers.</span>
<span class="n">total_ssds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through the bin centers, compute the `ssd` of both</span>
<span class="c1"># histograms, for each threshold.</span>
<span class="k">for</span> <span class="n">bin_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">):</span>
    <span class="n">left_mean</span><span class="p">,</span> <span class="n">left_ssd</span><span class="p">,</span> <span class="n">left_n</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[:</span><span class="n">bin_no</span><span class="p">],</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="n">bin_no</span><span class="p">])</span>
    <span class="n">right_mean</span><span class="p">,</span> <span class="n">right_ssd</span><span class="p">,</span> <span class="n">right_n</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">bin_no</span><span class="p">:],</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">bin_no</span><span class="p">:])</span>
    
    <span class="c1"># Calculate and store the total `ssd`, for the current threshold.</span>
    <span class="n">total_ssds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_ssd</span> <span class="o">+</span> <span class="n">right_ssd</span><span class="p">)</span>
    
<span class="c1"># Find the threshold which gives the smallest `ssd`. This is the Otsu threshold.</span>
<span class="n">otsu_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">total_ssds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Otsu bin :&#39;</span><span class="p">,</span> <span class="n">otsu_bin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Otsu threshold:&#39;</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">otsu_bin</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Otsu bin : 51
Otsu threshold: 102.59765625
</pre></div>
</div>
</div>
</div>
<p>We can see that this is the same Otsu threshold we get from <code class="docutils literal notranslate"><span class="pre">ski.filters.threshold_otsu()</span></code>, when we use the same number of bins (128).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the number of bins.</span>
<span class="n">n_bins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>128
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the Otsu threshold from `skimage`.</span>
<span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">threshold_otsu</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span>
                           <span class="n">nbins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(102)
</pre></div>
</div>
</div>
</div>
<p>Here is the graph showing the Otsu threshold, the total <code class="docutils literal notranslate"><span class="pre">ssd</span></code> is shown, in <a class="reference external" href="https://sparrow.dev/python-scientific-notation">scientific notation</a>, in the title of the plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">otsu_bin</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/169fb88811beb794d8ceb18316b002db0401066c29b0798e7c8d5e35b4653619.png" src="_images/169fb88811beb794d8ceb18316b002db0401066c29b0798e7c8d5e35b4653619.png" />
</div>
</div>
<p>The total <code class="docutils literal notranslate"><span class="pre">ssd</span></code> for the optimal Otsu threshold is an order of magnitude smaller than for some possible other threshold values. We show a different, much worse threshold below, which has a considerably larger total <code class="docutils literal notranslate"><span class="pre">ssd</span></code> (again, the total <code class="docutils literal notranslate"><span class="pre">ssd</span></code> is shown in the title of the plot):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A much worse split.</span>
<span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/740cdbd3206a3770b16db7478b56d140dc37352e6e7341880633ab3d96f2a488.png" src="_images/740cdbd3206a3770b16db7478b56d140dc37352e6e7341880633ab3d96f2a488.png" />
</div>
</div>
<p>Compare the spreads on each plot by looking at the horizontal lines around the mean of each histogram. You can see that the spreads are much smaller for the Otsu threshold, than for the other, suboptimal threshold. The other threshold, because it has much worse between pixel-class variance than the Otsu threshold, gives much worse image segmentation, in terms of separating foreground from background:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A bad segmentation, from the worse threshold value...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span> <span class="o">&lt;</span> <span class="n">bin_centers</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b73516cee0c7fcafe338bb45e2efa0f670277fde40e6eb029cb089b79a940310.png" src="_images/b73516cee0c7fcafe338bb45e2efa0f670277fde40e6eb029cb089b79a940310.png" />
</div>
</div>
<p>Admittedly that is quite a cool visual effect, but it is poor segmentation performance. The <code class="docutils literal notranslate"><span class="pre">ssd</span></code>s for multiple different thresholds are shown in the title of each plot below; the <code class="docutils literal notranslate"><span class="pre">camera</span></code> image filtered to the same threshold is shown to the right of each histogram plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise multiple thresholds, as well as filtering `camera` using those thresholds.</span>
<span class="n">n_threshold_plots</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span> <span class="o">&lt;</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Threshold Pixel Intensity: </span><span class="si">{</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4f96943928498c57b35fd015c153196d087780e3a455eb0c65b46608eb64e147.png" src="_images/4f96943928498c57b35fd015c153196d087780e3a455eb0c65b46608eb64e147.png" />
</div>
</div>
<p>Remember: Otsu’s method finds the threshold which gives us the smallest <em>sum of the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> values</em>, where we sum together the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> value for each histogram. This identifies the two classes of pixels (one class in each histogram) which have the <em>maximum between pixel-class variance</em>, e.g. pixel classes which are optimally distinct from one another, when assessed with the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> metric.</p>
<p>Compare the segmentation of the “best” Otsu threshold (shown below) to the poorer-performing thresholds shown on the right of the plot above - you will see substantially better foreground/background segmentation, from the optimal threshold:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show a plot of the whole Otsu filtering process.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">otsu_bin</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_otsu_filtered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Otsu filtered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16019c0cf2a13df142800644abc735866d84cd76b4bfe041b39278061feab8e4.png" src="_images/16019c0cf2a13df142800644abc735866d84cd76b4bfe041b39278061feab8e4.png" />
</div>
</div>
<p>To recap, <a class="reference external" href="http://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=4310076">Otsu’s method</a> proceeds like <a class="reference external" href="https://textbook.nipraxis.org/otsu_threshold.html">this</a>:</p>
<ul>
<li><p>create the 1D histogram of image values, where the histogram has <span class="math notranslate nohighlight">\(L\)</span> bins.
The histogram is <span class="math notranslate nohighlight">\(L\)</span> bin counts <span class="math notranslate nohighlight">\(\vec{c} = [c_1, c_2, ... c_L]\)</span>, where <span class="math notranslate nohighlight">\(c_i\)</span>
is the number of values falling in bin <span class="math notranslate nohighlight">\(i\)</span>.  The histogram has bin centers
<span class="math notranslate nohighlight">\(\vec{v} = [v_1, v_2, ..., v_L]\)</span>, where <span class="math notranslate nohighlight">\(v_i\)</span> is the image value
corresponding to the center of bin <span class="math notranslate nohighlight">\(i\)</span>;</p></li>
<li><p>for every bin number <span class="math notranslate nohighlight">\(k \in [1, 2, 3, ..., L-1]\)</span>, divide the histogram at
that bin to form a <em>left histogram</em> and a <em>right histogram</em>, where the left
histogram has counts, centers <span class="math notranslate nohighlight">\([c_1, ... c_k], [v_1, ... v_k]\)</span>, and the
right histogram has counts, centers <span class="math notranslate nohighlight">\([c_{k+1} ... c_L], [v_{k+1} .. v_L]\)</span>;</p></li>
<li><p>calculate the mean corresponding to the values in the left and right
histogram:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \begin{align}
  n_k^{left} = \sum_{i=1}^{k} c_i \\
  \mu_k^{left} = \frac{1}{n_k^{left}} \sum_{i=1}^{k} c_i v_i \\
  n_k^{right} = \sum_{i={k+1}}^{L} c_i \\
  \mu_k^{right} = \frac{1}{n_k^{right}} \sum_{i={k+1}}^{L} c_i v_i
  \end{align}
  \end{split}\]</div>
</li>
<li><p>calculate the sum of squared deviations from the left and right means:</p>
<div class="math notranslate nohighlight">
\[\begin{split}  \begin{align}
  \mathrm{SSD}_k^{left} = \sum_{i=1}^{k} c_i (v_i - \mu_k^{left}) \\
  \mathrm{SSD}_k^{right} = \sum_{i={k+1}}^{L} c_i (v_i - \mu_k^{right}) \\
  \mathrm{SSD}_k^{total} = SSD_k^{left} + SSD_k^{right}
  \end{align}
  \end{split}\]</div>
</li>
<li><p>find the bin number <span class="math notranslate nohighlight">\(k\)</span> that minimizes <span class="math notranslate nohighlight">\(\mathrm{SSD}_k^{total}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  z = \mathrm{argmin}_k \mathrm{SSD}_k^{total}
  \]</div>
</li>
<li><p>the binarizing threshold for the image is the value corresponding to this
bin <span class="math notranslate nohighlight">\(z\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  t = v_z
  \]</div>
</li>
</ul>
<div class="exercise dropdown admonition" id="triple-cam">

<p class="admonition-title"><span class="caption-number">Exercise 19 </span></p>
<section id="exercise-content">
<p>Your task now is to split <code class="docutils literal notranslate"><span class="pre">camera</span></code> into <em>three distinct pixel classes</em>, using threshold filtering. Here is your target image:</p>
<p><img alt="" src="_images/camera_3_regions.png" /></p>
<p>Roughly, in the target image, the sky has white pixels, the ground has grey pixels and the cameraman’s body has black pixels. Your final image should contain only the following <code class="docutils literal notranslate"><span class="pre">np.unique()</span></code> values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>You can use a “by eye” method to decide your thresholds, from inspecting a histogram of <code class="docutils literal notranslate"><span class="pre">camera</span></code>. Or you can investigate using the <code class="docutils literal notranslate"><span class="pre">skimage</span></code> Otsu filter to get thresholds for more than two pixel classes…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="4_threshold_filters-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#triple-cam"> Exercise 19</a></p>
<section id="solution-content">
<p>Inspecting the histogram by eye can get you quite far here. First, we plot the histogram of <code class="docutils literal notranslate"><span class="pre">camera</span></code>. We roughly indentify low frequency regions which separate the modes of the distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram, and estimate, by eye thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;By eye threshold 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;By eye threshold 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0bf83535ec64b1fd0ec9c3ee7da4ebc4fa8f2b6143f3ccfb0c04fdf998bcaf42.png" src="_images/0bf83535ec64b1fd0ec9c3ee7da4ebc4fa8f2b6143f3ccfb0c04fdf998bcaf42.png" />
</div>
</div>
<p>We chose 80 and 190, but you could get similar results with other nearby values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save our estimated thresholds as separate variables.</span>
<span class="n">by_eye_1</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">by_eye_2</span> <span class="o">=</span> <span class="mi">190</span>
</pre></div>
</div>
</div>
</div>
<p>We then use some Boolean indexing to:</p>
<ul class="simple">
<li><p>Set values to the left of the lower threshold to 0.</p></li>
<li><p>Set values in between the thresholds to 1.</p></li>
<li><p>Set values to the right of the higher threshold to 2.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy to avoid overwriting.</span>
<span class="n">camera_region_solution</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Set values to the left of the lower threshold to 0.</span>
<span class="n">camera_region_solution</span><span class="p">[</span><span class="n">camera_region_solution</span> <span class="o">&lt;</span> <span class="n">by_eye_1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Set values in between the thresholds to 1.</span>
<span class="n">camera_region_solution</span><span class="p">[(</span><span class="n">camera_region_solution</span> <span class="o">&gt;=</span> <span class="n">by_eye_1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera_region_solution</span> <span class="o">&lt;=</span> <span class="n">by_eye_2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Set values to the right of the higher threshold to 2.</span>
<span class="n">camera_region_solution</span><span class="p">[</span><span class="n">camera_region_solution</span> <span class="o">&gt;</span> <span class="n">by_eye_2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_region_solution</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3e11416f062c86f48efa6ac02b3e109d4a1d1d19c4bcb9a31addfae1793b0bd7.png" src="_images/3e11416f062c86f48efa6ac02b3e109d4a1d1d19c4bcb9a31addfae1793b0bd7.png" />
</div>
</div>
<p>That gets us pretty close to the target image!</p>
<p>A less “back of the envelope” method is to use <code class="docutils literal notranslate"><span class="pre">ski.filters.threshold_multiotsu()</span></code> which is an adjustment of the Otsu method which, you guessed it, allows us to “split” a histogram into more than two parts.</p>
<p>The syntax is very straightforward, and the function returns a list of the threshold values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multi-Otsu filter.</span>
<span class="n">otsu_cam3_solution</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">threshold_multiotsu</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> 
                                                     <span class="n">classes</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># How many pixel classes?</span>
<span class="c1"># Show the thresholds.</span>
<span class="n">otsu_cam3_solution</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 87, 176])
</pre></div>
</div>
</div>
</div>
<p>We plot the thresholds below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram, and the Multi-Otsu thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multi-Otsu Threshold 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multi-Otsu Threshold 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1c06309ee2feebff082d7df4b35298eb985525731aaf74cc5978dc6dca2c0924.png" src="_images/1c06309ee2feebff082d7df4b35298eb985525731aaf74cc5978dc6dca2c0924.png" />
</div>
</div>
<p>We can use Boolean indexing (as above) to set the pixel values according to the thresholds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy to avoid overwriting.</span>
<span class="n">camera_region_solution_multiotsu</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Set values to the left of the lower threshold to 0.</span>
<span class="n">camera_region_solution_multiotsu</span><span class="p">[</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&lt;</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Set values in between the thresholds to 1.</span>
<span class="n">camera_region_solution_multiotsu</span><span class="p">[(</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&gt;=</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&lt;=</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Set values to the right of the higher threshold to 2.</span>
<span class="n">camera_region_solution_multiotsu</span><span class="p">[</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&gt;</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_region_solution_multiotsu</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/50448f50c25f65a94d5f38e8be050b3fdbdc4d7bf39eb6281f3bbd3e7ba084bf.png" src="_images/50448f50c25f65a94d5f38e8be050b3fdbdc4d7bf39eb6281f3bbd3e7ba084bf.png" />
</div>
</div>
<p>A more elegant, slightly hacky way, suggested in the <code class="docutils literal notranslate"><span class="pre">skimage</span></code> documentation is to use <code class="docutils literal notranslate"><span class="pre">np.digitize()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Another route to the target image.</span>
<span class="n">cam3_regions_hack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> 
                           <span class="n">bins</span><span class="o">=</span><span class="n">otsu_cam3_solution</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cam3_regions_hack</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5d0a0bfd285198bd6b9d3c5498b00ce10597f89b056f857d2b3b23d1f0512365.png" src="_images/5d0a0bfd285198bd6b9d3c5498b00ce10597f89b056f857d2b3b23d1f0512365.png" />
</div>
</div>
</section>
</div>
<p>A useful trick, when thresholding in <code class="docutils literal notranslate"><span class="pre">skimage</span></code> to try to separate foreground and background, is to use the <code class="docutils literal notranslate"><span class="pre">ski.filters.try_all_threshold()</span></code> to test out all of the available thresholding methods, and visually inspect the results.</p>
<p>This function is both a filtering function and a plotting function. Behind the scenes it is using Matplotlib to generate the plots. Such is the utility of <code class="docutils literal notranslate"><span class="pre">skimage</span></code> being highly integrated with the rest of the <a class="reference external" href="https://scientific-python.org">Scientific Python eco-system</a>.</p>
<p>We run the function in the cell below. The name of each thresholding method is shown as the title of each plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Try all thresholding methods, and plot the results.</span>
<span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">try_all_threshold</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># Avoid clutter from printouts.</span>
                              <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0f8d08536e67b7b05fb1300be369c56133357fb1ece1207d689e8a5ebe97cbd8.png" src="_images/0f8d08536e67b7b05fb1300be369c56133357fb1ece1207d689e8a5ebe97cbd8.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h1>
<p>This page has showed how to perform threshold filtering using <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">skimage</span></code>. On the next page we will look at convolutional filtering, where we modify pixel values based on the “local neighbourhood” of surrounding pixels.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h1>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h1>
<p>Based on 3.3.5 onward from: <a class="reference external" href="https://lectures.scientific-python.org/packages/scikit-image/index.html">https://lectures.scientific-python.org/packages/scikit-image/index.html</a></p>
<p>Based on: <a class="reference external" href="https://scikit-image.org/skimage-tutorials/lectures/1_image_filters.html">https://scikit-image.org/skimage-tutorials/lectures/1_image_filters.html</a></p>
<p>Reference: <a class="reference external" href="https://www.kdnuggets.com/numpy-for-image-processing">https://www.kdnuggets.com/numpy-for-image-processing</a></p>
<p>Reference: <a class="reference external" href="https://setosa.io/ev/image-kernels">https://setosa.io/ev/image-kernels</a></p>
<p>Reference: <a class="reference external" href="https://wiki.imindlabs.com.au/ds/aml/4_problem_domains/1-image-processing/3_edge_detectors">https://wiki.imindlabs.com.au/ds/aml/4_problem_domains/1-image-processing/3_edge_detectors</a></p>
<p>Reference: <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels">https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels</a></p>
<p>Reference: skimage tutorials (check versions), scipy lecture notes</p>
<p>Reference: <a class="reference external" href="https://jni.github.io/i2k-skimage-napari/lectures/1_image_filters.html">https://jni.github.io/i2k-skimage-napari/lectures/1_image_filters.html</a></p>
<p>Reference: <a class="reference external" href="https://textbook.nipraxis.org/otsu_threshold.html">https://textbook.nipraxis.org/otsu_threshold.html</a></p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3_skimage_processing_from_numpy_and_scipy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">(Sci-kit) Image processing, via NumPy and SciPy</p>
      </div>
    </a>
    <a class="right-next"
       href="5_mean_filter.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Convolutional filtering I - the mean filter</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Threshold filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-signal-what-is-noise">What is signal? What is noise?</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Threshold Filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-segmentation-via-threshold-filtering">Image segmentation via threshold filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold-filters-in-skimage">Threshold filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Peter Rush, Matthew Brett
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>