
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Filtering with kernels II - Gaussian blur, sharpening and edge detection &#8212; Scikit-image via NumPy and SciPy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '6_gaussian_sharpening_edge';</script>
    <link rel="canonical" href="https://pxr687.github.io/skimage-tutorials-temp/6_gaussian_sharpening_edge.html" />
    <link rel="icon" href="_static/pandas_numpy.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="More filters: the median filter and non-local filters" href="7_median_nonlocal_filters.html" />
    <link rel="prev" title="Filtering with kernels - the mean filter" href="5_mean_filter.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/colorwheel.png" class="logo__image only-light" alt="Scikit-image via NumPy and SciPy - Home"/>
    <script>document.write(`<img src="_static/colorwheel.png" class="logo__image only-dark" alt="Scikit-image via NumPy and SciPy - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Scikit-image via NumPy and SciPy</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_images_as_numpy_arrays.html">Images as NumPy arrays</a></li>

<li class="toctree-l1"><a class="reference internal" href="1_color_images_as_numpy_arrays.html">What about color?</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_skimage_intro.html">Introducing Scikit-image</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_skimage_processing_from_numpy_and_scipy.html">(Scikit-) Image processing, via NumPy and SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_threshold_filters.html">Threshold filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_mean_filter.html">Filtering with kernels - the mean filter</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Filtering with kernels II - Gaussian blur, sharpening and edge detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_median_nonlocal_filters.html">More filters: the median filter and non-local filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_morphology.html">Morphology</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="interact/lab/index.html?path=6_gaussian_sharpening_edge.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch via JupyterLite"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterLite logo" src="_static/images/logo_jupyterlite.svg">
  </span>
<span class="btn__text-container">JupyterLite</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp/edit/main/6_gaussian_sharpening_edge.Rmd" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp/issues/new?title=Issue%20on%20page%20%2F6_gaussian_sharpening_edge.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/6_gaussian_sharpening_edge.Rmd" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.Rmd</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Filtering with kernels II - Gaussian blur, sharpening and edge detection</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-filtering">Gaussian filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-filters-in-skimage">Gaussian filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#image-sharpening">Image sharpening</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-detection-filtering">Edge detection filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sobel-edge-detection-filtering">Sobel edge detection filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-detection-filters-in-skimage">Edge detection filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernels-correlation-and-convolution">Kernels, correlation and convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="filtering-with-kernels-ii-gaussian-blur-sharpening-and-edge-detection">
<h1>Filtering with kernels II - Gaussian blur, sharpening and edge detection<a class="headerlink" href="#filtering-with-kernels-ii-gaussian-blur-sharpening-and-edge-detection" title="Link to this heading">#</a></h1>
<div class="dropdown admonition note" id="adapted-from-6">
<p class="admonition-title">Note</p>
<p>This tutorial is adapted from “Image manipulation and processing using NumPy and SciPy” by Emmanuelle Gouillart and Gaël Varoquaux, and “<code class="docutils literal notranslate"><span class="pre">scikit-image</span></code>: image processing” by Emmanuelle Gouillart. Please see the References section at the end of the page for other sources and resources.</p>
</div>
<p>This page will explore additional foundational filters which use kernels, implementing them first with NumPy and SciPy, and then with Scikit-image. As usual, we begin with some imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Library imports.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ndi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sps</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ski</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">Axes3D</span>

<span class="c1"># Set &#39;gray&#39; as the default colormap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>

<span class="c1"># Set NumPy precision to 2 decimal places</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Custom functions/variables for illustrations, to quickly report image</span>
<span class="c1"># attributes, and for exercises.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">skitut.gaussian_illustration</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_gaussian_kernel</span>
<span class="c1"># Utilities for mathematical display of matrices.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">skitut</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_attributes</span><span class="p">,</span> <span class="n">hints</span><span class="p">,</span> <span class="n">show_mat</span><span class="p">,</span> <span class="n">save_load_show_mat</span>
</pre></div>
</div>
</div>
</div>
<section id="gaussian-filtering">
<h2>Gaussian filtering<a class="headerlink" href="#gaussian-filtering" title="Link to this heading">#</a></h2>
<p>An important kernel-based filter with, let’s be honest, a pretty cool name is the <em>Gaussian filter</em>. You may recognise the name from the famous <a class="reference external" href="https://en.wikipedia.org/wiki/Normal_distribution">Gaussian distribution</a>, which we plot below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot a normal/Gaussian distribution.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aebde3ec89006a5b4b84be2609d94dc3987637c383b4cbc55fb0fe1f67c78366.png" src="_images/aebde3ec89006a5b4b84be2609d94dc3987637c383b4cbc55fb0fe1f67c78366.png" />
</div>
</div>
<p>This is the well-known normal distribution, which is sometimes described as
having a “bell-shape”. We will talk in more detail about this further down the
page. For now, take a look at this fancy <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels">kernel</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A fancy kernel.</span>
<span class="n">gaussian_like_kernel</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">],</span>
                                  <span class="p">[</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">],</span>
                                  <span class="p">[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">]])</span>
<span class="n">gaussian_like_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.06, 0.12, 0.06],
       [0.12, 0.25, 0.12],
       [0.06, 0.12, 0.06]])
</pre></div>
</div>
</div>
</div>
<p>Imagine this kernel plotted in a 3D space. It is in the <code class="docutils literal notranslate"><span class="pre">shape</span></code> of <code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">3)</span></code>,
so imagine that the “floor” of the 3D plot is a 3-by-3 grid, with the integer
index labels shown in the horizontal (<span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>-axis) directions. Imagine
further that we plot the kernel element values in the vertical direction, up
from the floor, on the <span class="math notranslate nohighlight">\(z\)</span>-axis.</p>
<p>So on this plot, in the vertical direction, our graph will be highest where the kernel values are highest (e.g. for the central element of 0.25), and lowest where the kernel elements are lowest (e.g. in the corners for the values of 0.06).</p>
<p>Such a plot is shown below. A red surface connects the kernel values, to make
the pattern between the individual elements clearer. The kernel values
themselves are shown as dark blue text. The axis ticks show the integer index
location of the kernel values, in the <code class="docutils literal notranslate"><span class="pre">gaussian_like_kernel</span></code> NumPy array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the fancy kernel, with a convenience function.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">kernel_plot</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">azim</span><span class="o">=-</span><span class="mi">45</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">kernel</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">plt_func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span> <span class="k">if</span> <span class="n">surface</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span>
    <span class="n">plt_func</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Integer Index (axis = 0)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Integer Index (axis = 1)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Kernel Element Value&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">azim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([])</span> 
    <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kernel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">kernel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">)),</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>

<span class="c1"># Make the plot.</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">gaussian_like_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/be80df8913987772047b30925db02768d9f55c4633c31725fc23264c00140e1e.png" src="_images/be80df8913987772047b30925db02768d9f55c4633c31725fc23264c00140e1e.png" />
</div>
</div>
<p>It may not be immediately apparent to some readers what this plot has to do
with a Gaussian distribution. For now let’s use “Gaussian” very loosely — for
now all we will take from the name is that, like a standard Gaussian
distribution, at the center the kernel has high values, then the values fall
off as we get nearer to the sides. Let’s warmly refer to the graph as the “red
mountain”.</p>
<p>The kernel is shown, via the raw NumPy output, in the cell below. Compare this
to the plot, to make sure you understand the visualisation. Remember that the
numbers on each axis of the “floor” are the integer index locations of the
NumPy array. And the vertical height of the red surface is the value of the
kernel element at each row/column integer index location:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the kernel again, in NumPy, for comparison to the plot.</span>
<span class="n">gaussian_like_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.06, 0.12, 0.06],
       [0.12, 0.25, 0.12],
       [0.06, 0.12, 0.06]])
</pre></div>
</div>
</div>
</div>
<p>If you prefer, you can view the NumPy array kernel with prettier graphics below:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_mat</span><span class="p">(</span><span class="n">gaussian_like_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}0.06 &amp; 0.12 &amp; 0.06\\0.12 &amp; 0.25 &amp; 0.12\\0.06 &amp; 0.12 &amp; 0.06\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>Just as a final comparison between the  NumPy array kernel and the plot, here
is the “red mountain” viewed from directly above, with the NumPy array kernel,
in pretty graphics, shown to the right-hand side of the plot:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">surface_mat_pair</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">mat_fname</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">kernel_plot</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax0</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Our own utility for making matrix display image, loading.</span>
    <span class="n">mat_img</span> <span class="o">=</span> <span class="n">save_load_show_mat</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">mat_fname</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mat_img</span><span class="p">,</span>
               <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span>
               <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Integer index (axis = 1)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Integer index (axis = 0)&#39;</span><span class="p">)</span>
    <span class="c1"># Set tick labels and positions as if for matrix indices.</span>
    <span class="n">pad_factors</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>  <span class="c1"># To account for margins</span>
    <span class="k">for</span> <span class="n">ax_name</span><span class="p">,</span> <span class="n">ax_ind</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">kern_ax_len</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span>
        <span class="n">mat_ax_len</span> <span class="o">=</span> <span class="n">mat_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span>
        <span class="n">p_f</span> <span class="o">=</span> <span class="n">pad_factors</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">mat_ax_len</span> <span class="o">/</span> <span class="p">(</span><span class="n">kern_ax_len</span> <span class="o">+</span> <span class="n">p_f</span><span class="p">)</span>
        <span class="n">tick_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">step</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">p_f</span><span class="p">),</span> <span class="n">mat_ax_len</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;set_</span><span class="si">{</span><span class="n">ax_name</span><span class="si">}</span><span class="s1">ticks&#39;</span><span class="p">)(</span><span class="n">tick_pos</span><span class="p">)</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;set_</span><span class="si">{</span><span class="n">ax_name</span><span class="si">}</span><span class="s1">ticklabels&#39;</span><span class="p">)(</span><span class="nb">range</span><span class="p">(</span><span class="n">kern_ax_len</span><span class="p">))</span>
    <span class="c1"># Turn off spines for matrix display.</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">):</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">position</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">surface_mat_pair</span><span class="p">(</span><span class="n">gaussian_like_kernel</span><span class="p">,</span> <span class="s1">&#39;images/gaussian_kernel_2.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/skimage-tutorials-temp/skimage-tutorials-temp/skitut/displutils.py:23: UserWarning: No LaTeX installation; cannot save. Loading existing file &quot;images/gaussian_kernel_2.png&quot;
  warn(&#39;No LaTeX installation; cannot save. &#39;
</pre></div>
</div>
<img alt="_images/6dae9afa3fb2b6b228fe476a6691262288d80c95c5340b97bf782c37dbc1ad04.png" src="_images/6dae9afa3fb2b6b228fe476a6691262288d80c95c5340b97bf782c37dbc1ad04.png" />
</div>
</div>
<p>Remember that the kernel has only 9 values (shown as blue text on the plot), so there are no values in between the array values. If you prefer, we can visualise the kernel using a wireframe, to make it clearer that there are no values in between the kernel elements (e.g. in between the points where there is blue text):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the fancy kernel.</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">gaussian_like_kernel</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/825dd5d5319e78e3b8eeedbae6b0d0d89de2a29d344028643813eef233d480f3.png" src="_images/825dd5d5319e78e3b8eeedbae6b0d0d89de2a29d344028643813eef233d480f3.png" />
</div>
</div>
<p>Let’s refer to the highest point on this kernel surface as the “crimson
peak”.<a class="footnote-reference brackets" href="#crimson-peak" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.  The crimson peak is the central kernel element of
0.25, at row/column integer index location <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">1]</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The central kernel value, at the crimson peak - check that you can also see</span>
<span class="c1"># this on the graph above.</span>
<span class="n">gaussian_like_kernel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.25)
</pre></div>
</div>
</div>
</div>
<p>Essentially, if we filter using this kernel, we “walk” this kernel through the
image, with the top of the “crimson peak” centered on a given pixel. The
central pixel value is then replaced with an average of the pixels in the
neighborhood, but the contribution of the other pixels in the neighborhood
to the average is <em>weighted by the height of the “red mountain” at that
pixel</em>.</p>
<p>So array pixels which fall under higher points of the kernel’s “red mountain” will exert more influence on the weighted average, and pixels falling under lower points will exert a weaker influence. The central pixel, laying under the crimson peak, will exert the most influence on the weighted average.</p>
<p>Let’s use this kernel to filter the following image array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a small image array.</span>
<span class="n">small_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">small_square</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">small_square</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">small_square</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0f01889c6ec77d687b7b1292e7cee1e74a6ddb5b3552d0e4430392bb7e4e67cc.png" src="_images/0f01889c6ec77d687b7b1292e7cee1e74a6ddb5b3552d0e4430392bb7e4e67cc.png" />
</div>
</div>
<p>We use use <code class="docutils literal notranslate"><span class="pre">scipy.ndimage.correlate()</span></code> to “walk” our kernel over every pixel in the image, multiply each array pixel value under the kernel by the corresponding kernel value, then take the sum of the result to replace the central pixel value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the `gaussian_like_kernel` to filter the image.</span>
<span class="n">gaussian_like_filtered_small_square</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">small_square</span><span class="p">,</span>
                                                    <span class="n">weights</span><span class="o">=</span><span class="n">gaussian_like_kernel</span><span class="p">)</span>

<span class="c1"># Plot comparison images.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">small_square</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian-like Filter </span><span class="se">\n</span><span class="s1">(3, 3) Kernel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gaussian_like_filtered_small_square</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e8a4c836f088a781bda6b2072826ca1afdecba14f301e6310c6cf27f06aaa38a.png" src="_images/e8a4c836f088a781bda6b2072826ca1afdecba14f301e6310c6cf27f06aaa38a.png" />
</div>
</div>
<p>Blurry! So to recap, we have averaged within a 3-by-3 pixel neighborhood, replacing the central pixel value with a weighted average of all the pixel values in the neighborhood. The weights are larger for pixels closer to the central value of the kernel (e.g. closer to the center of the “crimson peak” on the plot above).</p>
<p>Filtering with this type of kernel is called <em>Gaussian filtering</em> because the
kernel element values approximate a <a class="reference external" href="https://en.wikipedia.org/wiki/Normal_distribution">Gaussian (e.g. normal)
distribution</a>. The plot of
the kernel above, with the “red mountain” may not look much like the normal
distribution to you at the moment, but bear with us.</p>
<p>To see the Gaussian nature of this filtering operation, let’s take a look at another, larger kernel below - it has <code class="docutils literal notranslate"><span class="pre">shape</span></code> <code class="docutils literal notranslate"><span class="pre">(9,</span> <span class="pre">9)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Another kernel.</span>
<span class="n">big_gaussian_kernel</span> <span class="o">=</span> <span class="n">make_gaussian_kernel</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  ],
       [0.  , 0.  , 0.  , 0.01, 0.01, 0.01, 0.  , 0.  , 0.  ],
       [0.  , 0.  , 0.01, 0.02, 0.03, 0.02, 0.01, 0.  , 0.  ],
       [0.  , 0.01, 0.02, 0.05, 0.07, 0.05, 0.02, 0.01, 0.  ],
       [0.  , 0.01, 0.03, 0.07, 0.09, 0.07, 0.03, 0.01, 0.  ],
       [0.  , 0.01, 0.02, 0.05, 0.07, 0.05, 0.02, 0.01, 0.  ],
       [0.  , 0.  , 0.01, 0.02, 0.03, 0.02, 0.01, 0.  , 0.  ],
       [0.  , 0.  , 0.  , 0.01, 0.01, 0.01, 0.  , 0.  , 0.  ],
       [0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  ]])
</pre></div>
</div>
</div>
</div>
<p>Can you see any pattern in the arrangement of the numbers? Where are the high
numbers, where are the low numbers? The <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> NumPy array is
shown below, in prettier form, to aid your ruminations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_mat</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.0 &amp; 0.01 &amp; 0.01 &amp; 0.01 &amp; 0.0 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.01 &amp; 0.02 &amp; 0.03 &amp; 0.02 &amp; 0.01 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.01 &amp; 0.02 &amp; 0.05 &amp; 0.07 &amp; 0.05 &amp; 0.02 &amp; 0.01 &amp; 0.0\\0.0 &amp; 0.01 &amp; 0.03 &amp; 0.07 &amp; 0.09 &amp; 0.07 &amp; 0.03 &amp; 0.01 &amp; 0.0\\0.0 &amp; 0.01 &amp; 0.02 &amp; 0.05 &amp; 0.07 &amp; 0.05 &amp; 0.02 &amp; 0.01 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.01 &amp; 0.02 &amp; 0.03 &amp; 0.02 &amp; 0.01 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.0 &amp; 0.01 &amp; 0.01 &amp; 0.01 &amp; 0.0 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>We will also plot this kernel in 3D, as with the last kernel. Again, the integer index locations of the array form the horizontal (<span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>) axis values, and the values within the array are plotted on the vertical (<span class="math notranslate nohighlight">\(z\)</span>) axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the new, bigger Gaussian kernel.</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/48e8632d7b54821fac5a73d15761b4132aeb9b8dedbbbff9d95839098a2483df.png" src="_images/48e8632d7b54821fac5a73d15761b4132aeb9b8dedbbbff9d95839098a2483df.png" />
</div>
</div>
<p>Again, if you prefer, we can view the kernel as a wireframe plot, which we show
in the cell below. We first show the NumPy view of the array again, above the
plot. The plot looks messy when the kernel element values (blue text) are also
shown, but we show them for easy comparison to the <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> NumPy
array. If you are running interactively, you can set <code class="docutils literal notranslate"><span class="pre">text=False</span></code> in the
plotting function and re-run the cell, to switch the blue numbers off, if you
wish:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare the NumPy array to the plot.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">`big_gaussian_kernel` NumPy view:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;`big_gaussian_kernel` </span><span class="se">\n</span><span class="s1">Red Mountain View:&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`big_gaussian_kernel` NumPy view:

 [[0.   0.   0.   0.   0.   0.   0.   0.   0.  ]
 [0.   0.   0.   0.01 0.01 0.01 0.   0.   0.  ]
 [0.   0.   0.01 0.02 0.03 0.02 0.01 0.   0.  ]
 [0.   0.01 0.02 0.05 0.07 0.05 0.02 0.01 0.  ]
 [0.   0.01 0.03 0.07 0.09 0.07 0.03 0.01 0.  ]
 [0.   0.01 0.02 0.05 0.07 0.05 0.02 0.01 0.  ]
 [0.   0.   0.01 0.02 0.03 0.02 0.01 0.   0.  ]
 [0.   0.   0.   0.01 0.01 0.01 0.   0.   0.  ]
 [0.   0.   0.   0.   0.   0.   0.   0.   0.  ]]
</pre></div>
</div>
<img alt="_images/755c736f51e5851b0a977e1214ddcec1361505c030e1e6e154e684dbb4768faf.png" src="_images/755c736f51e5851b0a977e1214ddcec1361505c030e1e6e154e684dbb4768faf.png" />
</div>
</div>
<p>Again, to make the relationship between the NumPy array and the graph as clear
as possible, here is the “red mountain” viewed from directly above, with the
<code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> array shown to its right:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surface_mat_pair</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">,</span> <span class="s1">&#39;images/big_gaussian_kernel.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/skimage-tutorials-temp/skimage-tutorials-temp/skitut/displutils.py:23: UserWarning: No LaTeX installation; cannot save. Loading existing file &quot;images/big_gaussian_kernel.png&quot;
  warn(&#39;No LaTeX installation; cannot save. &#39;
</pre></div>
</div>
<img alt="_images/919a691d3714e454f25c66c23dd7bac27838219b4746ac549f8f7a13c00987f0.png" src="_images/919a691d3714e454f25c66c23dd7bac27838219b4746ac549f8f7a13c00987f0.png" />
</div>
</div>
<p>You may (or may not) recognise the “red mountain” - when we plot the
<code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> - as a multivariate <a class="reference external" href="https://en.wikipedia.org/wiki/Gaussian_function">Gaussian
distribution</a>. Here is <a class="reference external" href="https://www.math.csi.cuny.edu/~mvj/MTH410-S20/lectures/Lecture21.html#6">one way</a>
of writing the formula for a multivariate Gaussian distribution:</p>
<p><span class="math notranslate nohighlight">\(
 \Large p(x, y) = \frac{1}{2 \pi  \sigma_x  \sigma_y}  \
    e^{-\frac{1}{2} (\frac{(x - \mu_x)^2} {\sigma_x^2} + \frac{(y - \mu_y)^2} {\sigma_y^2})}
\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\mu_x\)</span> is the mean of all <span class="math notranslate nohighlight">\(x\)</span> values, and <span class="math notranslate nohighlight">\(\sigma_x\)</span> is the standard deviation of all <span class="math notranslate nohighlight">\(x\)</span> values.</p>
<p>In our case, when we are building kernels, the inputs <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> will be some
function of row and column indices.  Here is a plot of a prototypical
multivariate Gaussian, where both input variables have a mean of 0, a standard
deviation of 1.<a class="footnote-reference brackets" href="#independence" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot multivariate Gaussian; both x and y have a mean of 0 and std of 1.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10_00</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10_00</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">mu_x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mu_y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma_x</span> <span class="o">*</span> <span class="n">sigma_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">X</span> <span class="o">-</span> <span class="n">mu_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigma_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">mu_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigma_y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Generate the plot.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Multivariate Gaussian Distribution&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f4d1a492b0bba3b270e6e2bbe24f2ec119c9eb48c89849bab52ff3e7917ab63e.png" src="_images/f4d1a492b0bba3b270e6e2bbe24f2ec119c9eb48c89849bab52ff3e7917ab63e.png" />
</div>
</div>
<p>Here is the plot of <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> again, for comparison to the perfect
Gaussian shown in the image above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the plot of `big_gaussian_kernel` again.</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/48e8632d7b54821fac5a73d15761b4132aeb9b8dedbbbff9d95839098a2483df.png" src="_images/48e8632d7b54821fac5a73d15761b4132aeb9b8dedbbbff9d95839098a2483df.png" />
</div>
</div>
<p>The “crimson peak” of the <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> is spikier than for the
prototypical Gaussian, simply because it is centered on a single pixel
(creating the spike at the “crimson peak”). For the smaller
<code class="docutils literal notranslate"><span class="pre">gaussian_like_kernel</span></code> the whole 3D plot appeared more “spiky” as it has less
array elements. In the bigger <code class="docutils literal notranslate"><span class="pre">(9,</span> <span class="pre">9)</span></code> <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code>, we can see
a smoother, more obviously Gaussian “mountain”, much more visually similar to
prototypical multivariate Gaussian distribution.</p>
<p>Both our <code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">3)</span></code> kernel above, and the larger kernel we just plotted, are called <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels">gaussian blur kernels</a>. Let’s look at the <code class="docutils literal notranslate"><span class="pre">gaussian_like_kernel</span></code> array again, to compare it to <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> directly:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_mat</span><span class="p">(</span><span class="n">gaussian_like_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}0.06 &amp; 0.12 &amp; 0.06\\0.12 &amp; 0.25 &amp; 0.12\\0.06 &amp; 0.12 &amp; 0.06\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>When comparing to the <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code>, shown below, you can see that the pattern in the numbers is the same. The biggest value occurs in the center of the array, the smallest values are in the corners of the array. For the bigger Gaussian kernel, it is apparent that kernel values <em>closer</em> to the center are larger, the values get smaller the further we get from the central element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_mat</span><span class="p">(</span><span class="n">big_gaussian_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.0 &amp; 0.01 &amp; 0.01 &amp; 0.01 &amp; 0.0 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.01 &amp; 0.02 &amp; 0.03 &amp; 0.02 &amp; 0.01 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.01 &amp; 0.02 &amp; 0.05 &amp; 0.07 &amp; 0.05 &amp; 0.02 &amp; 0.01 &amp; 0.0\\0.0 &amp; 0.01 &amp; 0.03 &amp; 0.07 &amp; 0.09 &amp; 0.07 &amp; 0.03 &amp; 0.01 &amp; 0.0\\0.0 &amp; 0.01 &amp; 0.02 &amp; 0.05 &amp; 0.07 &amp; 0.05 &amp; 0.02 &amp; 0.01 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.01 &amp; 0.02 &amp; 0.03 &amp; 0.02 &amp; 0.01 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.0 &amp; 0.01 &amp; 0.01 &amp; 0.01 &amp; 0.0 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>As we said above, when we filter using these Gaussian kernels, we “walk” the
kernel through the image, with the top of the “mountain”, the crimson peak,
centered on a given pixel at each step. The central pixel value is then
replaced with a <em>weighted average</em> of the pixels in the neighborhood, where
each pixel’s contribution (weight) to the average is given by the corresponding kernel value.  With a Gaussian kernel like this, pixels nearer to the center of the kernel have higher weights — so the weight is related to
its distance to the crimson peak of the Gaussian surfaces we showed above.
Pixels closer to the central pixel, under the crimson peak, will exert more
influence, pixels further away will exert a weaker influence.</p>
<p>Let’s apply the <code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code> with the <code class="docutils literal notranslate"><span class="pre">camera</span></code> image, using
<code class="docutils literal notranslate"><span class="pre">ndi.correlate()</span></code>, as we used for the mean filter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Appl the `big_gaussian_kernel` as a filter.</span>
<span class="n">big_gaussian_filtered_small_square</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">small_square</span><span class="p">,</span>
                                                   <span class="n">weights</span><span class="o">=</span><span class="n">big_gaussian_kernel</span><span class="p">)</span>

<span class="c1"># Plot comparison images.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">small_square</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian filter </span><span class="se">\n</span><span class="s1">(3, 3) kernel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">gaussian_like_filtered_small_square</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian filter </span><span class="se">\n</span><span class="s1">(9, 9) kernel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">big_gaussian_filtered_small_square</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/321212d1fb924da66ca5c0da00ced5a42a424919b274576f467738a79096d9bd.png" src="_images/321212d1fb924da66ca5c0da00ced5a42a424919b274576f467738a79096d9bd.png" />
</div>
</div>
<p>It is apparent that the larger kernel has “spread” the intensity of
higher-valued pixels further than the small kernel. This makes sense, because
it is averaging across bigger pixel neighborhoods.</p>
<p>Both of these kernels are quite small relative to the size of the image. As
such, it is easier to see their effect in lower-resolution images.</p>
<p>Below, we make a pixelated version of <code class="docutils literal notranslate"><span class="pre">camera</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pixelate the `camera` image.</span>
<span class="n">camera</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span>
<span class="c1"># Rescale to 20% of original size, this makes the image appear more pixelated.</span>
<span class="n">pixelated_camera</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pixelated_camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/93a8ab9da985da3feea381a44dfa83b6de2baa4b4d617e55cc6d53985d7e9fb3.png" src="_images/93a8ab9da985da3feea381a44dfa83b6de2baa4b4d617e55cc6d53985d7e9fb3.png" />
</div>
</div>
<p>Below, we filter with separately with <code class="docutils literal notranslate"><span class="pre">gaussian_like_kernel</span></code> and
<code class="docutils literal notranslate"><span class="pre">big_gaussian_kernel</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter with the small Gaussian kernel.</span>
<span class="n">gaussian_like_filtered_pixelated_camera</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">pixelated_camera</span><span class="p">,</span>
                                               <span class="n">weights</span><span class="o">=</span><span class="n">gaussian_like_kernel</span><span class="p">)</span>

<span class="c1"># Filter with the big Gaussian kernel.</span>
<span class="n">big_gaussian_filtered_pixelated_camera</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">pixelated_camera</span><span class="p">,</span>
                                               <span class="n">weights</span><span class="o">=</span><span class="n">big_gaussian_kernel</span><span class="p">)</span>

<span class="c1"># Plot comparison images.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original (Pixelated)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">pixelated_camera</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian filter </span><span class="se">\n</span><span class="s1">(3, 3) Kernel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">gaussian_like_filtered_pixelated_camera</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian filter </span><span class="se">\n</span><span class="s1">(9, 9) Kernel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">big_gaussian_filtered_pixelated_camera</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/93b1a281d7bfffde24fffb0bc3ba8473f17d6cd71f34be857137a96dffbfe8a4.png" src="_images/93b1a281d7bfffde24fffb0bc3ba8473f17d6cd71f34be857137a96dffbfe8a4.png" />
</div>
</div>
<p>The smoothing effect is clear, with the larger kernel creating a more striking
smoothing effect, because we are blurring over more pixels.</p>
</section>
<section id="gaussian-filters-in-skimage">
<h2>Gaussian filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code><a class="headerlink" href="#gaussian-filters-in-skimage" title="Link to this heading">#</a></h2>
<p>Gaussian filters are easy to implement in <code class="docutils literal notranslate"><span class="pre">skimage</span></code>; let’s try it with the
<code class="docutils literal notranslate"><span class="pre">cat</span></code> image from <code class="docutils literal notranslate"><span class="pre">ski.data</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the `cat` image.</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cat</span><span class="p">()</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cat</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: uint8
Shape: (300, 451, 3)
Max Pixel Value: 231
Min Pixel Value: 0
</pre></div>
</div>
<img alt="_images/4ee7477b739aa9fda7066966d5336ad7e5db317659e8f8e26fc7d7318b27b680.png" src="_images/4ee7477b739aa9fda7066966d5336ad7e5db317659e8f8e26fc7d7318b27b680.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ski.filters.gaussian()</span></code> implements the Gaussian filter. We can control the
<code class="docutils literal notranslate"><span class="pre">sigma</span></code> parameter, which controls the spread of the Gaussian “mountain” in the
kernel. Lower values will reduce the weight of pixel values far from the
central pixel, giving high weights only to those close to the peak.
Conversely, higher values will give greater weight to pixels further away from
the central pixel:</p>
<p><img alt="" src="_images/low_sigma_v_high_sigma.png" /></p>
<p>Let’s apply the filter with a <code class="docutils literal notranslate"><span class="pre">sigma</span></code> of 3:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gaussian filter `cat`, with `skimage`.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ad50e1f4cd4313174436034fd3a9d7e3b1bee59e39193d8793af9a4005b2fd25.png" src="_images/ad50e1f4cd4313174436034fd3a9d7e3b1bee59e39193d8793af9a4005b2fd25.png" />
</div>
</div>
<p>Higher sigma values will introduce a blurrier effect, because for higher
<code class="docutils literal notranslate"><span class="pre">sigma</span></code> values, pixels further from the central value within each kernel are
exerting more influence in the averaging calculation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot with different `sigma` values.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sigma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>  <span class="c1"># Turn of tick marks and labels.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sigma = </span><span class="si">{</span><span class="n">sigma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;skimage.filters.gaussian()&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fb62fc275b622da3f888e92ec8cd97f93dad43fd95685508b4430a64dded83ee.png" src="_images/fb62fc275b622da3f888e92ec8cd97f93dad43fd95685508b4430a64dded83ee.png" />
</div>
</div>
<div class="exercise dropdown admonition" id="krazy-kernel">

<p class="admonition-title"><span class="caption-number">Exercise 23 </span></p>
<section id="exercise-content">
<p>Here is another kernel which follows a roughly Gaussian-like pattern - in that
pixels closer to the center are weighted more heavily, pixels towards the
sides have less weight. However, it is only somewhat Gaussian-like, and in
fact is a very strange kernel, as we will soon see when we view it on a 3D
plot.</p>
<p>It is defined as a variable in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the strange kernel.</span>
<span class="n">almost_gaussian_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="n">almost_gaussian_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [2, 2, 2, 4, 4, 4, 2, 2, 2],
       [2, 2, 2, 4, 4, 4, 2, 2, 2],
       [2, 2, 2, 4, 4, 4, 2, 2, 2],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1]])
</pre></div>
</div>
</div>
</div>
<p>Here it is in a nicer mathematical display:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_mat</span><span class="p">(</span><span class="n">almost_gaussian_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\2 &amp; 2 &amp; 2 &amp; 4 &amp; 4 &amp; 4 &amp; 2 &amp; 2 &amp; 2\\2 &amp; 2 &amp; 2 &amp; 4 &amp; 4 &amp; 4 &amp; 2 &amp; 2 &amp; 2\\2 &amp; 2 &amp; 2 &amp; 4 &amp; 4 &amp; 4 &amp; 2 &amp; 2 &amp; 2\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>We plot this oddball kernel in 3D, in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Super weird!</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">almost_gaussian_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/49dc21561ea021beead6dc130565c4c43a1473b821b7adb887014187e99d47bf.png" src="_images/49dc21561ea021beead6dc130565c4c43a1473b821b7adb887014187e99d47bf.png" />
</div>
</div>
<p>It looks like take on a Gaussian with late 90s games console graphics! When we
filter the <code class="docutils literal notranslate"><span class="pre">camera</span></code> image using this kernel, we get some strange results.
First, we show the original <code class="docutils literal notranslate"><span class="pre">camera</span></code> image, as a starting point:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the original `camera` image.</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: uint8
Shape: (512, 512)
Max Pixel Value: 255
Min Pixel Value: 0
</pre></div>
</div>
<img alt="_images/35f9dfe13bfb22923a0ffb4e30a0a71877c6b8ffb9cf0556ebe377899835cbf3.png" src="_images/35f9dfe13bfb22923a0ffb4e30a0a71877c6b8ffb9cf0556ebe377899835cbf3.png" />
</div>
</div>
<p>Now, we filter with the weird kernel:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter with the oddball kernel. (Probably) not the result we want...</span>
<span class="n">almost_gaussian_filtered_camera</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span>
                                                <span class="n">weights</span><span class="o">=</span><span class="n">almost_gaussian_kernel</span><span class="p">)</span>
<span class="c1"># Show the attributes and plot the result.</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">almost_gaussian_filtered_camera</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">almost_gaussian_filtered_camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: uint8
Shape: (512, 512)
Max Pixel Value: 255
Min Pixel Value: 0
</pre></div>
</div>
<img alt="_images/8aeabc931bee2d1349f1f520348abcb7d957ea00786fb5876b12f1a92576d5ef.png" src="_images/8aeabc931bee2d1349f1f520348abcb7d957ea00786fb5876b12f1a92576d5ef.png" />
</div>
</div>
<p>This may be a pretty cool effect, but, because the kernel we used looks like
the weird cousin of a Gaussian, we would maybe expect this kernel to do
something closer to Gaussian smoothing than to totally psych out the image, as
it has done here.</p>
<p>With a small modification to the <code class="docutils literal notranslate"><span class="pre">dtype</span></code>, however, we can get the following
Gaussian-like smoothing on <code class="docutils literal notranslate"><span class="pre">camera</span></code>, using the oddball
<code class="docutils literal notranslate"><span class="pre">almost_gaussian_kernel</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert to `float64` dtype.</span>
<span class="n">camera_as_float</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">img_as_float64</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>

<span class="c1"># Filter with the oddball kernel, successfully.</span>
<span class="n">almost_gaussian_filtered_camera</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">camera_as_float</span><span class="p">,</span>
                                                <span class="n">weights</span><span class="o">=</span><span class="n">almost_gaussian_kernel</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">almost_gaussian_filtered_camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ddb3225c5b9669de82405b9a38e280d42ae1d0bf578f0487da5ebd7a49e54f55.png" src="_images/ddb3225c5b9669de82405b9a38e280d42ae1d0bf578f0487da5ebd7a49e54f55.png" />
</div>
</div>
<p>Why did this happen? Take a moment to think about possible explanations. After
your pause for thought, your task is to <em>make adjustments to the kernel
<strong>only</strong> to prevent the original psychedelic effect from happening</em>. You
should be able to obtain the same smoothed image from the cell above, if you
modify the kernel correctly. The target image is just above.  To save you scrolling, here is the psychedelic image that you should avoid:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">almost_gaussian_filtered_camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ddb3225c5b9669de82405b9a38e280d42ae1d0bf578f0487da5ebd7a49e54f55.png" src="_images/ddb3225c5b9669de82405b9a38e280d42ae1d0bf578f0487da5ebd7a49e54f55.png" />
</div>
</div>
<p>When you modify the kernel <strong>DO NOT</strong> recreate the kernel array and “manually”
modify the original numbers by editing them directly. Use <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code> or
<code class="docutils literal notranslate"><span class="pre">skimage</span></code> functions to alter the kernel to do what you need.</p>
<p><em>Hint</em>: run the <code class="docutils literal notranslate"><span class="pre">hints.krazy_kernel_1()</span></code> function for a hint about how you
could modify the kernel…</p>
<p><em>Hint 2</em>: run the <code class="docutils literal notranslate"><span class="pre">hint.krazy_kernel_2()</span></code> function for some additional help
regarding the source of the original error…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="n">my_new_kernel</span> <span class="o">=</span> <span class="n">almost_gaussian_kernel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="6_gaussian_sharpening_edge-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#krazy-kernel"> Exercise 23</a></p>
<section id="solution-content">
<p>You will have discovered that the problem here is <em>integer overflow</em>.
Filtering <code class="docutils literal notranslate"><span class="pre">camera</span></code> with the <code class="docutils literal notranslate"><span class="pre">almost_gaussian_kernel</span></code> results in numbers that
are too big for the original <code class="docutils literal notranslate"><span class="pre">uint8</span></code> <code class="docutils literal notranslate"><span class="pre">dtype</span></code> to handle. Let’s remind ourselves
of the kernel values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the kernel.</span>
<span class="n">almost_gaussian_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [2, 2, 2, 4, 4, 4, 2, 2, 2],
       [2, 2, 2, 4, 4, 4, 2, 2, 2],
       [2, 2, 2, 4, 4, 4, 2, 2, 2],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1],
       [1, 1, 1, 2, 2, 2, 1, 1, 1]])
</pre></div>
</div>
</div>
</div>
<p>Now, when the maximum value of the kernel gets multiplied by the maximum value
in <code class="docutils literal notranslate"><span class="pre">camera</span></code>, we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">almost_gaussian_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(1020)
</pre></div>
</div>
</div>
</div>
<p>This multiplication will surely happen, when the kernel is centered on the
maximum valued pixel (remember that, in filtering, the kernel gets centered on
every pixel in the image).</p>
<p>This value is too large for the <code class="docutils literal notranslate"><span class="pre">uint8</span></code> <code class="docutils literal notranslate"><span class="pre">dtype</span></code> of the original camera image,
which can only range from <a class="reference external" href="https://scikit-image.org/docs/0.25.x/user_guide/data_types.html">0 to
255</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">camera</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dtype(&#39;uint8&#39;)
</pre></div>
</div>
</div>
</div>
<p>Remember that, instead of giving an error, values which overflow the maximum
for the dtype wrap around to start again at 0:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.uint8(1)
</pre></div>
</div>
</div>
</div>
<p>This effect explains the strange result we saw above.</p>
<p>One solution to this is to scale the kernel to sum to 1.  In that case, taking
a weighted sum of the kernel values cannot give a value larger than the
maximum under the kernel.  In fact, this is <a class="reference external" href="https://dsp.stackexchange.com/questions/25130/why-should-the-sum-of-masks-kernel-filter-in-image-processing-be-one">common
practice</a>
with image filtering kernels because it ensures that they do not alter the
average intensity values of the images to which they are applied. In this
case, however, scaling the kernel so that it sums to 1 will also prevent
integer overflow…</p>
<p>To ensure the kernel sums to 1, we just multiply the kernel by the reciprocal
of the sum of the elements in the kernel, which in this case sum to 144:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sy</span>

<span class="n">sy</span><span class="o">.</span><span class="n">MatMul</span><span class="p">(</span><span class="n">sy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">144</span><span class="p">),</span>
          <span class="n">sy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="n">almost_gaussian_kernel</span><span class="p">),</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left(\frac{1}{144}\right) \left[\begin{matrix}1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\2 &amp; 2 &amp; 2 &amp; 4 &amp; 4 &amp; 4 &amp; 2 &amp; 2 &amp; 2\\2 &amp; 2 &amp; 2 &amp; 4 &amp; 4 &amp; 4 &amp; 2 &amp; 2 &amp; 2\\2 &amp; 2 &amp; 2 &amp; 4 &amp; 4 &amp; 4 &amp; 2 &amp; 2 &amp; 2\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\\1 &amp; 1 &amp; 1 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the sum of the `almost_gaussian_kernel`.</span>
<span class="n">k_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">almost_gaussian_kernel</span><span class="p">)</span>
<span class="n">k_sum</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(144)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fixed, scaled kernel.</span>
<span class="n">almost_gaussian_solution_1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">k_sum</span> <span class="o">*</span> <span class="n">almost_gaussian_kernel</span>
<span class="n">almost_gaussian_solution_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.03, 0.03, 0.03, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.03, 0.03, 0.03, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.03, 0.03, 0.03, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],
       [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01]])
</pre></div>
</div>
</div>
</div>
<p>The kernel values now sum to 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">almost_gaussian_solution_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(1.0)
</pre></div>
</div>
</div>
</div>
<p>But the kernel still has its original, idiosyncratic shape:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the fixed, scaled kernel.</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">almost_gaussian_solution_1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1c7b3773eda9b7e602c016e0245d4d00bdcdb181dfcc89e6c042b24b9917ba51.png" src="_images/1c7b3773eda9b7e602c016e0245d4d00bdcdb181dfcc89e6c042b24b9917ba51.png" />
</div>
</div>
<p>Now, when we use this adjusted kernel to filter <code class="docutils literal notranslate"><span class="pre">camera</span></code>, we get the target
image, which is the product of a filtering process much closer to Gaussian
smoothing than the original attempt above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bingo!</span>
<span class="n">almost_gaussian_filtered_camera</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span>
    <span class="n">camera</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">almost_gaussian_solution_1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">almost_gaussian_filtered_camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/51c96489764d2f2858ef5ad6612cc53b80a88b49a60bed52b50e1c10090260d8.png" src="_images/51c96489764d2f2858ef5ad6612cc53b80a88b49a60bed52b50e1c10090260d8.png" />
</div>
</div>
</section>
</div>
<!---
Nov 19 14.48
-->
<div class="exercise dropdown admonition" id="DIY-gaussian">

<p class="admonition-title"><span class="caption-number">Exercise 24 </span></p>
<section id="exercise-content">
<p>Below is another way of writing the formula for generating a 2D Gaussian
distribution, and therefore for generating a 2D Gaussian kernel.</p>
<p><span class="math notranslate nohighlight">\( \Large \text{Gaussian}(x, y) = \frac{1}{\sqrt{2 \pi \sigma^2}} e^{- \frac{x^2 + y^2}{2\sigma^2}} \)</span></p>
<p>In contrast the formula we saw above for the same distribution, <em>this formula
assumes that both <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> have an equal spread</em> (standard deviation).
Generally we will want this equality of spread, for a Gaussian kernel.</p>
<p>Your task is to define a function in the cell below (called <code class="docutils literal notranslate"><span class="pre">DIY_gauss</span></code>) which
implements this revised Gaussian formula. Your function should take two 2D
arrays (<span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>), and a <code class="docutils literal notranslate"><span class="pre">sigma</span></code> (<span class="math notranslate nohighlight">\(\sigma\)</span>, standard deviation) value, as
arguments. Figure out what needs to be in each input argument to produce the
following <code class="docutils literal notranslate"><span class="pre">target_kernel</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the target kernel.</span>
<span class="n">target_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.</span>  <span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.</span>  <span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.</span>  <span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.</span>  <span class="p">]])</span>

<span class="c1"># Plot and show the target kernel.</span>
<span class="n">kernel_plot</span><span class="p">(</span><span class="n">target_kernel</span><span class="p">);</span>

<span class="n">target_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  ],
       [0.  , 0.  , 0.01, 0.02, 0.01, 0.  , 0.  ],
       [0.  , 0.01, 0.06, 0.1 , 0.06, 0.01, 0.  ],
       [0.  , 0.02, 0.1 , 0.16, 0.1 , 0.02, 0.  ],
       [0.  , 0.01, 0.06, 0.1 , 0.06, 0.01, 0.  ],
       [0.  , 0.  , 0.01, 0.02, 0.01, 0.  , 0.  ],
       [0.  , 0.  , 0.  , 0.  , 0.  , 0.  , 0.  ]])
</pre></div>
</div>
<img alt="_images/cb485d870eab162348d76bc0c38b4231e0d94c537183e7ce205b3caa3f4b0496.png" src="_images/cb485d870eab162348d76bc0c38b4231e0d94c537183e7ce205b3caa3f4b0496.png" />
</div>
</div>
<p>Once you have successfully generated the <code class="docutils literal notranslate"><span class="pre">target_kernel</span></code> using your function,
use it to blur the following image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in and show the image which you should blur with your new kernel.</span>
<span class="n">xenomorph</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;images/xenomorph.jpg&quot;</span><span class="p">,</span> <span class="n">as_gray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">xenomorph</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/167750b39b7c1d924885211f9c739c33c490c6b0ccea1ab6a5b7d7804023b8a4.png" src="_images/167750b39b7c1d924885211f9c739c33c490c6b0ccea1ab6a5b7d7804023b8a4.png" />
</div>
</div>
<p>You should find the <code class="docutils literal notranslate"><span class="pre">sigma</span></code> value that you need in order to produce the
following target image:</p>
<p><img alt="" src="_images/xeno_blur.png" /></p>
<p>To help narrow things down, we have put some scaffolding code in the cell
below, which shows how to generate the 2D <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> arrays with
<code class="docutils literal notranslate"><span class="pre">np.meshgrid()</span></code>. The code is currently commented out, you will need to
uncomment it, and modify it so it can be used to produce the <code class="docutils literal notranslate"><span class="pre">target_kernel</span></code>.</p>
<p><em>Hint</em>: the values you need, for your <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> arrays, and your <code class="docutils literal notranslate"><span class="pre">sigma</span></code> value, are all positive or negative integers smaller than 5.</p>
<p><em>Hint 2</em>: you should also think about the sum of all the values in the <code class="docutils literal notranslate"><span class="pre">target_kernel</span></code>.</p>
<p><em>Note</em>: there is a cell two cells below which can “mark” your work - it will test whether your function produces a kernel identical to the <code class="docutils literal notranslate"><span class="pre">target_kernel</span></code>. Once you have written your function, uncomment the marking code and run it. If you have done everything correctly, it will run with no error. If not, you will get a nasty-looking error (but keep going!).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>

<span class="c1"># The input vectors for your function.</span>
<span class="c1">#x_lin = np.arange(...)</span>
<span class="c1">#y_lin = x_lin.copy()</span>
<span class="c1">#x, y = np.meshgrid(x_lin, y_lin)</span>

<span class="c1"># Your function.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">DIY_gauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MARK YOUR ANSWER HERE</span>
<span class="c1"># If the code below runs with no error, you have written the function correctly...</span>
<span class="c1"># You will need to un-comment the code first (obvivously!).</span>

<span class="c1"># UNCOMMENT THE LINES BELOW AND RUN THE CODE</span>
<span class="c1"># assert np.all(np.round(DIY_gauss_solution(x, y, sigma=hints.secret_val()), 2)</span>
<span class="c1">#               == np.round(target_kernel, 2))</span>
</pre></div>
</div>
</div>
</div>
<p>Do not forget to use your kernel to blur the <code class="docutils literal notranslate"><span class="pre">xenomorph</span></code> image in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply your kernel with the xenomorph image...</span>
<span class="n">xenomorph_gauss_blurred</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="6_gaussian_sharpening_edge-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#DIY-gaussian"> Exercise 24</a></p>
<section id="solution-content">
<p>The function you need, with the correct input arguments, is below. You need to
use <code class="docutils literal notranslate"><span class="pre">np.arange(-3,</span> <span class="pre">4)</span></code> for the inputs to <code class="docutils literal notranslate"><span class="pre">np.meshgrid()</span></code> - the resulting 2D
<code class="docutils literal notranslate"><span class="pre">x_solution</span></code> and <code class="docutils literal notranslate"><span class="pre">y_solution</span></code> arrays are printed out under the cell. A <code class="docutils literal notranslate"><span class="pre">sigma</span></code>
of 1 will generate the target kernel.</p>
<p>An important step here is <code class="docutils literal notranslate"><span class="pre">gauss</span> <span class="pre">=</span> <span class="pre">1/gauss.sum()</span> <span class="pre">*</span> <span class="pre">gauss</span></code> which ensures that the kernel elements sum to 1. As we noted in the solution to the last exercise, this step makes sure that the average pixel intensity of an image stays the same as the original image, when we filter the image with this kernel (this is called <em>normalising the kernel</em>).</p>
<p>If we skip the normalisation step, we may well create problems with
not-standard (too large!) pixel intensity values, or otherwise will be
changing the intensities in a way that is not part of the typical Gaussian
blur procedure e.g. we will be altering the average pixel intensity of the
whole image, rather than just blurring the pixels…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">DIY_gauss_solution</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>

    <span class="c1"># Implement the function.</span>
    <span class="n">gauss</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Scale the kernel so it sums to 1.</span>
    <span class="n">gauss</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">gauss</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">gauss</span>
    <span class="k">return</span> <span class="n">gauss</span>

<span class="c1"># Generate the input arrays.</span>
<span class="n">x_lin_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y_lin_solution</span> <span class="o">=</span> <span class="n">x_lin_solution</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">x_solution</span><span class="p">,</span> <span class="n">y_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_lin_solution</span><span class="p">,</span>
                                     <span class="n">y_lin_solution</span><span class="p">)</span>

<span class="c1"># Print out some reports/results.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x =</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">x_solution</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">y =</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">y_solution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Gaussian kernel (same as `target_kernel`) =</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">DIY_gauss_solution</span><span class="p">(</span><span class="n">x_solution</span><span class="p">,</span><span class="w"> </span><span class="n">y_solution</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Is it all the same as the `target_kernel`?</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Same as the target? This array should contain on `True`s if so...:&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">DIY_gauss_solution</span><span class="p">(</span><span class="n">x_solution</span><span class="p">,</span> <span class="n">y_solution</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">target_kernel</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x =
 [[-3 -2 -1  0  1  2  3]
 [-3 -2 -1  0  1  2  3]
 [-3 -2 -1  0  1  2  3]
 [-3 -2 -1  0  1  2  3]
 [-3 -2 -1  0  1  2  3]
 [-3 -2 -1  0  1  2  3]
 [-3 -2 -1  0  1  2  3]] 
 
y =
 [[-3 -3 -3 -3 -3 -3 -3]
 [-2 -2 -2 -2 -2 -2 -2]
 [-1 -1 -1 -1 -1 -1 -1]
 [ 0  0  0  0  0  0  0]
 [ 1  1  1  1  1  1  1]
 [ 2  2  2  2  2  2  2]
 [ 3  3  3  3  3  3  3]]

Gaussian kernel (same as `target_kernel`) =
 [[0.   0.   0.   0.   0.   0.   0.  ]
 [0.   0.   0.01 0.02 0.01 0.   0.  ]
 [0.   0.01 0.06 0.1  0.06 0.01 0.  ]
 [0.   0.02 0.1  0.16 0.1  0.02 0.  ]
 [0.   0.01 0.06 0.1  0.06 0.01 0.  ]
 [0.   0.   0.01 0.02 0.01 0.   0.  ]
 [0.   0.   0.   0.   0.   0.   0.  ]]

Same as the target? This array should contain on `True`s if so...:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ True,  True,  True,  True,  True,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True]])
</pre></div>
</div>
</div>
</div>
<p>To use the <code class="docutils literal notranslate"><span class="pre">target_kernel</span></code> to recreate the target image, you need to hefty sigma value of 10:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Blur the `xenomorph` image, and show beside the original.</span>
<span class="n">target_image_solution</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">xenomorph</span><span class="p">,</span>
                                      <span class="n">weights</span><span class="o">=</span><span class="n">DIY_gauss_solution</span><span class="p">(</span><span class="n">x_solution</span><span class="p">,</span> <span class="n">y_solution</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">))</span>

<span class="c1"># Show the original image and the blurred image.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">xenomorph</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">target_image_solution</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian Blur with `target_kernel`&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00a578c74e7e19e1da4733b494083fac14c8b0dd78e091d0c957b08a51b07b96.png" src="_images/00a578c74e7e19e1da4733b494083fac14c8b0dd78e091d0c957b08a51b07b96.png" />
</div>
</div>
</section>
</div>
</section>
<section id="image-sharpening">
<h2>Image sharpening<a class="headerlink" href="#image-sharpening" title="Link to this heading">#</a></h2>
<p>Gaussian filtering is a nice visual effect by itself, but filters like the
Gaussian filter which blur an image can also, somewhat paradoxically, be used
to <em>sharpen</em> an image. <em>Sharpening</em> is the opposite of blurring, it makes
images clearer, with the features and edges more defined.</p>
<p>How can we sharpen an image with a Gaussian <em>blur</em> filter, we hear you ask? We will demonstrate below. Sharpening is easiest to appreciate if we start with a slightly blurry image. In the cell below, we create a <code class="docutils literal notranslate"><span class="pre">blurry_cat</span></code> image by applying a Gaussian filter, we use a low <code class="docutils literal notranslate"><span class="pre">sigma</span></code> value, to keep the blur only slight:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a little blur.</span>
<span class="n">blurry_cat</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cat</span><span class="p">(),</span>
                                  <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/588cd83d5ea17078ac1fb66fedd561e118cacc5cc8a305ca4bd4dddd8078b61f.png" src="_images/588cd83d5ea17078ac1fb66fedd561e118cacc5cc8a305ca4bd4dddd8078b61f.png" />
</div>
</div>
<p>A simple way to sharpen the image is via the <a class="reference external" href="https://blog.demofox.org/2022/02/26/image-sharpening-convolution-kernels">following
procedure</a>:</p>
<div class="math notranslate nohighlight">
\[
\text{sharpened_image} = \text{original_image} + (\text{original_image} – \text{blurred_image})
\]</div>
<p>Theoretically speaking, <span class="math notranslate nohighlight">\(\text{(original_image – blurred_image)}\)</span> contains
<em>sharpened details</em> of the image, because it results from subtracting out
a version of the image which is blurrier than the original, giving us the
<em>difference</em> between the original image and the blurry image. This effect is
easiest to appreciate visually:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform the sharpening, on each color channel separately, to avoid altering the color of the image.</span>
<span class="n">gaussian_filtered_cats</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sharpened</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">blurry_cat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">gaussian_filtered_cats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">sharpened</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">blurry_cat</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">gaussian_filtered_cats</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

<span class="c1"># Stack back to 3D.</span>
<span class="n">sharpened</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">sharpened</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gaussian_filter_cat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">gaussian_filtered_cats</span><span class="p">,</span>
                               <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Rescale to legal pixel ranges.</span>
<span class="n">sharpened</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">rescale_intensity</span><span class="p">(</span><span class="n">sharpened</span><span class="p">,</span> <span class="n">out_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Blurred&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gaussian_filter_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sharpened&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sharpened</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f95dc7da557dea94d49f0a9110c664a6d287efd4cd07a12a4d4570385df009d5.png" src="_images/f95dc7da557dea94d49f0a9110c664a6d287efd4cd07a12a4d4570385df009d5.png" />
</div>
</div>
<p>You can see that the sharpened image, as intended, has better clarity than the
original. We can also use a specialised <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels/#3-sharpening-kernel">sharpening
kernel</a>
to achieve the same effect:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sharpening_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                              <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s a nicer mathematical display of the kernel:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_mat</span><span class="p">(</span><span class="n">sharpening_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}0 &amp; -1 &amp; 0\\-1 &amp; 5 &amp; -1\\0 &amp; -1 &amp; 0\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>We show this kernel in 3D below (it does look pretty sharp!):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kernel_plot</span><span class="p">(</span><span class="n">sharpening_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7eca6529fb91982116d77bb15505429b3c47ed674a6604544ba73b34974735d6.png" src="_images/7eca6529fb91982116d77bb15505429b3c47ed674a6604544ba73b34974735d6.png" />
</div>
</div>
<p>The kernel works by <a class="reference external" href="https://setosa.io/ev/image-kernels/#:~:text=The%20sharpen%20kernel%20emphasizes%20differences,differences%20in%20adjacent%20pixel%20values.">emphasising differences between adjacent
pixels</a>.
Essentially, the more different a pixel is from its surrounding pixels, the
bigger value it will get in the sharpened image.</p>
<p>To see this in detail, let’s take just the middle row of the <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Slice out the middle row of the `sharpening_kernel`.</span>
<span class="n">middle_row_sharp</span> <span class="o">=</span> <span class="n">sharpening_kernel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">middle_row_sharp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-1,  5, -1])
</pre></div>
</div>
</div>
</div>
<p>We can filter this middle row with a 1-D array of numbers, using the same
machinery as for larger image arrays:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An array of numbers.</span>
<span class="n">my_nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">my_nums</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  0,   1,   2, 100])
</pre></div>
</div>
</div>
</div>
<p>We perform the filtering in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">my_nums</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">middle_row_sharp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ -1,   3, -91, 398])
</pre></div>
</div>
</div>
</div>
<p>You can see that bigger differences between adjacent values result in larger
absolute numbers in the output array, emphasising the differences. We show
this principle again below, using 2D arrays the full <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code>.
First, we create a 2D array where there are no differences between the
adjacent pixels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A boring array.</span>
<span class="n">no_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">no_diff</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.]])
</pre></div>
</div>
</div>
</div>
<p>Applying this array with the <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code> will yield the same array, as
there are no differences in the input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">no_diff</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">sharpening_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1.]])
</pre></div>
</div>
</div>
</div>
<p>Conversely, the array below contains a repeating pattern of 2’s and 3’s in the first three rows, so the differences between pixel neighborhoods in the early rows are fairly consistent.</p>
<p>In the last three rows, the same pattern is repeated, only now the 3’s are negative, increasing the difference between the pixels in each neighborhood:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]])</span>
<span class="n">diffs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 2,  3,  2,  3,  2,  3],
       [ 3,  2,  3,  2,  3,  2],
       [ 2,  3,  2,  3,  2,  3],
       [ 2, -3,  2, -3,  2, -3],
       [-3,  2, -3,  2, -3,  2],
       [ 2, -3,  2, -3,  2, -3]])
</pre></div>
</div>
</div>
</div>
<p>Applying the <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code> results in a larger number of larger absolute
values in the bottom three rows, amplifying the differences between the pixels,
such that larger differences become even larger thanks to the sharpening
operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Larger differences in later rows, where there is greater variance in the pixel intensities.</span>
<span class="n">sharp_diffs</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">sharpening_kernel</span><span class="p">)</span>
<span class="n">sharp_diffs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  0,   6,  -1,   6,  -1,   5],
       [  6,  -2,   7,  -2,   7,  -1],
       [  0,  12,  -1,  12,  -1,  11],
       [ 12, -24,  17, -24,  17, -19],
       [-18,  22, -23,  22, -23,  17],
       [ 12, -18,  17, -18,  17, -13]])
</pre></div>
</div>
</div>
</div>
<p>Let’s apply the <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code> to the <code class="docutils literal notranslate"><span class="pre">blurry_cat</span></code> image array. As this
array is a 2D <em>color</em> image (meaning, a 3D array), we apply the kernel to each
color channel separately:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separately sharpen each color channel of the `blurry_cat` image.</span>
<span class="n">sharpened_cat</span> <span class="o">=</span> <span class="n">blurry_cat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">sharpened_cat</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">],</span>
                                          <span class="n">weights</span><span class="o">=</span><span class="n">sharpening_kernel</span><span class="p">)</span>

<span class="c1"># Rescale to avoid non-standard pixel range.</span>
<span class="n">sharpened_cat</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">rescale_intensity</span><span class="p">(</span><span class="n">sharpened_cat</span><span class="p">,</span> <span class="n">out_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sharpened&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sharpened_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ab8d3ee35afd3ff58ea9078b2623077e2d74790468400d376cdd3e038594dee3.png" src="_images/ab8d3ee35afd3ff58ea9078b2623077e2d74790468400d376cdd3e038594dee3.png" />
</div>
</div>
<p>Scikit-image (unsurprisingly) also has filters to sharpen images. The <code class="docutils literal notranslate"><span class="pre">ski.filters.unsharp_mask()</span></code> filter is one such filter,  and it uses a similar approach to the one we used above,  when we sharpened an image using a Gaussian filter. <code class="docutils literal notranslate"><span class="pre">ski.filters.unsharp_mask()</span></code> uses the following approach:</p>
<p><span class="math notranslate nohighlight">\( \text{sharpened_img = original_img + scaling_amount * (original_img - blurred_img)} \)</span></p>
<p>…where “scaling_amount” is a single value which amplifies the sharpened
details. Here is the result on <code class="docutils literal notranslate"><span class="pre">blurry_cat</span></code>, using the default parameters,
aside from <code class="docutils literal notranslate"><span class="pre">channel_axis</span></code>. We set this to 2 to tell the function that this is
a color image, with the color channels in the third dimension (<code class="docutils literal notranslate"><span class="pre">axis=2</span></code>). This
prevents the sharpening filter from applying the sharpening filter across the
color axis, and therefore affecting the color of the image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sharpen `blurry_cat`.</span>
<span class="n">sharpen_cat</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">unsharp_mask</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">,</span>
                                       <span class="n">channel_axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sharpened </span><span class="se">\n</span><span class="s1">(with `ski.filters.unsharp_mask()`)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sharpen_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/db6313b878f71bef6cee4880b5701135808b83fac56a1af11b7e5f2da8356331.png" src="_images/db6313b878f71bef6cee4880b5701135808b83fac56a1af11b7e5f2da8356331.png" />
</div>
</div>
<p>Changing the <code class="docutils literal notranslate"><span class="pre">amount</span></code> parameter will intensify the sharpening effect:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sharpen `blurry_cat`.</span>
<span class="n">sharpen_cat</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">unsharp_mask</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">,</span>
                                       <span class="n">amount</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                       <span class="n">channel_axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sharpened </span><span class="se">\n</span><span class="s1">(with `ski.filters.unsharp_mask(amount=3)`)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sharpen_cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5d79ba9e6edb3adbd4fd175f733be8c883218dc3064995bfb66be16be480da82.png" src="_images/5d79ba9e6edb3adbd4fd175f733be8c883218dc3064995bfb66be16be480da82.png" />
</div>
</div>
<div class="exercise dropdown admonition" id="stay-sharp">

<p class="admonition-title"><span class="caption-number">Exercise 25 </span></p>
<section id="exercise-content">
<p>In keeping with the “sharp” topic, below we load in a picture of a very
regal-looking eagle, from <code class="docutils literal notranslate"><span class="pre">ski.data</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in and show an image.</span>
<span class="n">eagle</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">eagle</span><span class="p">()</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">eagle</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eagle</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading file &#39;data/eagle.png&#39; from &#39;https://gitlab.com/scikit-image/data/-/raw/1e4f62ac31ba4553d176d4473a5967ad1b076d62/eagle.png&#39; to &#39;/home/runner/.cache/scikit-image/0.26.0&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: uint8
Shape: (2019, 1826)
Max Pixel Value: 255
Min Pixel Value: 1
</pre></div>
</div>
<img alt="_images/4fcf5ab08e6df6ca123c4543bfd329bafc4c27c5c6c951ae754693be02e55738.png" src="_images/4fcf5ab08e6df6ca123c4543bfd329bafc4c27c5c6c951ae754693be02e55738.png" />
</div>
</div>
<p>We’re feeling vandalistic, and so have ruined this image by adding a boatload
of Gaussian blur, in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Blur the `eagle` image.</span>
<span class="n">blurry_eagle</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">eagle</span><span class="p">,</span>
                                    <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_eagle</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5805a2f6f33c8e713af53da45bf604a9bcda65f8da0eac1c947401688326d694.png" src="_images/5805a2f6f33c8e713af53da45bf604a9bcda65f8da0eac1c947401688326d694.png" />
</div>
</div>
<p>You mission is the following: make a custom sharpening kernel to sharpen <code class="docutils literal notranslate"><span class="pre">blurry_eagle</span></code>. You need to modify the kernel, because if we use the original <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code> on <code class="docutils literal notranslate"><span class="pre">blurry_eagle</span></code>, it does not perform well. The image below shows the result of sharpening with the original <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code>:</p>
<p><img alt="" src="_images/not_great_sharp.png" /></p>
<p>When making your modifications to the kernel pay attention to the original values in <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code> to decide what values you can use to achieve a similar but stronger effect. Here is the original <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code>, to act as your spiritual guide:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_mat</span><span class="p">(</span><span class="n">sharpening_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}0 &amp; -1 &amp; 0\\-1 &amp; 5 &amp; -1\\0 &amp; -1 &amp; 0\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>…think carefully about what you can change to improve the sharpening performance.</p>
<p>As a final step use <code class="docutils literal notranslate"><span class="pre">ski.filters.unsharp_mask()</span></code> as an alternate method
sharpen the <code class="docutils literal notranslate"><span class="pre">blurry_eagle</span></code> image. Use whatever argument settings you need.
Compare the result to your custom kernel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="n">my_sharpening_kernel</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">sharp_eagle</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="6_gaussian_sharpening_edge-solution-5">

<p class="admonition-title">Solution to<a class="reference internal" href="#stay-sharp"> Exercise 25</a></p>
<section id="solution-content">
<p>We got some pretty good performance from the following kernel:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">another_sharpening_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                                      <span class="p">[</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                                      <span class="p">[</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>An important feature to be aware of here, is that the sharpening kernel should
sum to 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The sum of the original `sharpening_kernel`.</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sharpening_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The sum of the newer, stronger `another_sharpening_kernel`.</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">another_sharpening_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(1)
</pre></div>
</div>
</div>
</div>
<p>As with Gaussian kernels, this is to ensure that the sharpening filter does
not alter the average intensities of the original image.</p>
<p>The reason our new <code class="docutils literal notranslate"><span class="pre">another_sharpening_kernel</span></code> performs better than the
original <code class="docutils literal notranslate"><span class="pre">sharpening_kernel</span></code> is because the central value is higher. To ensure
the kernel sums to 1, we therefore must increase the absolute value of the
negative kernel elements. These two factors (bigger central value, bigger
negative off-center values) increase the strength of the sharpening effect.</p>
<p>We use the new kernel to sharpen <code class="docutils literal notranslate"><span class="pre">blurry_eagle</span></code> in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform the filtering, to sharpen the image.</span>
<span class="n">sharpened_eagle_solution</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">blurry_eagle</span><span class="p">,</span>
                               <span class="n">weights</span><span class="o">=</span><span class="n">another_sharpening_kernel</span><span class="p">)</span>

<span class="c1"># Rescale to avoid illegal an pixel range.</span>
<span class="n">sharpened_eagle_solution</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">rescale_intensity</span><span class="p">(</span><span class="n">sharpened_eagle_solution</span><span class="p">,</span> <span class="n">out_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Blurry&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_eagle</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sharpened&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sharpened_eagle_solution</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/70bcc417fc0f4d7b21c1e8fc30ac925c7b0ed6ca3a7b07595d97f75a88c244d3.png" src="_images/70bcc417fc0f4d7b21c1e8fc30ac925c7b0ed6ca3a7b07595d97f75a88c244d3.png" />
</div>
</div>
<p>We also got pretty good results from <code class="docutils literal notranslate"><span class="pre">ski.filters.unsharp_mask()</span></code>, setting the
<code class="docutils literal notranslate"><span class="pre">amount</span></code> argument to 3 (for a strong sharpening effect):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sharpen, via `skimage`.</span>
<span class="n">sharpened_eagle_solution_from_ski</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">unsharp_mask</span><span class="p">(</span><span class="n">blurry_eagle</span><span class="p">,</span> 
                                                             <span class="n">amount</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Blurry&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurry_eagle</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sharpened (with `skimage`)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sharpened_eagle_solution_from_ski</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df43fc67c1bad0c4c120f77135d23f6394187a4abbb16f84c33ac31a69e25395.png" src="_images/df43fc67c1bad0c4c120f77135d23f6394187a4abbb16f84c33ac31a69e25395.png" />
</div>
</div>
</section>
</div>
</section>
<section id="edge-detection-filtering">
<h2>Edge detection filtering<a class="headerlink" href="#edge-detection-filtering" title="Link to this heading">#</a></h2>
<p>We saw a simple <a class="reference internal" href="3_skimage_processing_from_numpy_and_scipy.html"><span class="doc std std-doc">edge detection
filter</span></a> in one of the exercises on
an earlier page. In image processing and computer vision, an edge is a rapid
change in intensity between pixels - in other words there is a high <em>gradient</em>
of change between the pixel values. We can construct
a <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels">kernel</a>
which will detect such intensity changes in the vertical (<span class="math notranslate nohighlight">\(y\)</span>) direction, and
thus will detect horizontal edges. That may sound paradoxical, but
<em>horizontal</em> edges have <em>vertical</em> gradients:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A horizontal edge detection kernel.</span>
<span class="n">horizontal_edge_detection_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
                                             <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]])</span>

<span class="n">horizontal_edge_detection_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-1, -1, -1],
       [ 0,  0,  0],
       [ 1,  1,  1]])
</pre></div>
</div>
</div>
</div>
<p>To show how this kernel works, we will make an image array with very clear edges - one horizontal edge is at the top of the white square, another is at the bottom of the white square. One vertical edge is on the left side of the square, and another vertical edge is on the right side of the square:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An image array containing clear edges.</span>
<span class="n">edgy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1d845dc8a9f5531fce5c9bd9d5af31d3e70d70cf76481dc7910a64ce00195b14.png" src="_images/1d845dc8a9f5531fce5c9bd9d5af31d3e70d70cf76481dc7910a64ce00195b14.png" />
</div>
</div>
<p>Applying our horizontal edge detection kernel finds the horizontal edges. Note again that the change in pixel intensities is in the <em>vertical</em> direction, but the edge itself runs in the <em>horizontal</em> direction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the horizontal edge detection filter.</span>
<span class="n">edgy_horizontal</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">edgy</span><span class="p">,</span>
                                <span class="n">horizontal_edge_detection_kernel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_horizontal</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d63c3d4a7ef87062abca7a2c0d30d8cb20c07e650cfa7532dfc9bce8c6429ea2.png" src="_images/d63c3d4a7ef87062abca7a2c0d30d8cb20c07e650cfa7532dfc9bce8c6429ea2.png" />
</div>
</div>
<p>Let’s think about what has happened here at the level of the individual pixels. Three kernel locations from the top of the array are represented below (once again, you can right click on these images and open them in a new tab/window, for easier viewing):</p>
<p><img alt="" src="_images/horizontal_edge_detection_1.png" /></p>
<p>You can see that, for a binary image, the horizontal kernel essentially
“counts” the number of 0-to-1 vertical changes in the kernel location, which
lets it detect horizontal edges.</p>
<p>Conversely, when the kernel hits the 1-to-0 vertical changes at the bottom of the array, we get a similar count of the 1-to-0 changes, but indicated by a negative value, telling us that the gradient is in the other direction:</p>
<p><img alt="" src="_images/horizontal_edge_detection_2.png" /></p>
<p>The original <code class="docutils literal notranslate"><span class="pre">edgy</span></code> array, and the array resulting from application of the
<code class="docutils literal notranslate"><span class="pre">horizontal_edge_detection_kernel</span></code> are both shown in “raw” NumPy output below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the horizontal edge-filtered array.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original `edgy` array:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">edgy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Horizontally edge filtered:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">edgy_horizontal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original `edgy` array:
 [[0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [0 0 1 1 1 1 1 1 0 0]
 [0 0 1 1 1 1 1 1 0 0]
 [0 0 1 1 1 1 1 1 0 0]
 [0 0 1 1 1 1 1 1 0 0]
 [0 0 1 1 1 1 1 1 0 0]
 [0 0 1 1 1 1 1 1 0 0]
 [0 0 1 1 1 1 1 1 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]]

Horizontally edge filtered:
 [[ 0  0  0  0  0  0  0  0  0  0]
 [ 0  1  2  3  3  3  3  2  1  0]
 [ 0  1  2  3  3  3  3  2  1  0]
 [ 0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0]
 [ 0 -1 -2 -3 -3 -3 -3 -2 -1  0]
 [ 0 -1 -2 -3 -3 -3 -3 -2 -1  0]
 [ 0  0  0  0  0  0  0  0  0  0]]
</pre></div>
</div>
</div>
</div>
<p>You can also view these arrays, in prettier form, below:</p>
<p><img alt="" src="_images/horizontal_edge_matrices.png" /></p>
<p>We can “flip” our edge detection <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels">kernel</a> to look for big changes in gradient in the <em>horizontal</em> (<span class="math notranslate nohighlight">\(x\)</span>) direction, which will find <em>vertical</em> edges:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A vertical edge detection kernel.</span>
<span class="n">vertical_edge_detection_kernel</span> <span class="o">=</span> <span class="n">horizontal_edge_detection_kernel</span><span class="o">.</span><span class="n">T</span>
<span class="n">vertical_edge_detection_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-1,  0,  1],
       [-1,  0,  1],
       [-1,  0,  1]])
</pre></div>
</div>
</div>
</div>
<p>It should be easy to appreciate why this edge detection kernel operates to
detect gradients and edges in a different direction! Now, when applied to our
<code class="docutils literal notranslate"><span class="pre">edgy</span></code> image array, the vertical edge detection kernel, true to its name,
detects vertical edges, and it does so by looking for large pixel intensity
changes in the horizontal direction (those at the left/right side edges of the
square):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The original square.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1d845dc8a9f5531fce5c9bd9d5af31d3e70d70cf76481dc7910a64ce00195b14.png" src="_images/1d845dc8a9f5531fce5c9bd9d5af31d3e70d70cf76481dc7910a64ce00195b14.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Detect edges in the vertical direction.</span>
<span class="n">edgy_vertical</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">edgy</span><span class="p">,</span>
                              <span class="n">vertical_edge_detection_kernel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_vertical</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ef7ef96d3d1a844a41acfecd610285b6e8a4092a027d7ad31bc067f3cbca3fb6.png" src="_images/ef7ef96d3d1a844a41acfecd610285b6e8a4092a027d7ad31bc067f3cbca3fb6.png" />
</div>
</div>
<p>Again, in the resultant image, changes from black to white (0-to-1) end up as
white pixels (with value 1). Conversely, changes from white to black (1-to-0)
end up as black pixels (with value -1). No change ends up as gray (0):</p>
<p><img alt="" src="_images/vertical_edge_matrices.png" /></p>
<p>Applied to more complex images, this edge detection can have some pretty cool
effects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in an image, convert to grayscale.</span>
<span class="n">coffee_gray</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">rgb2gray</span><span class="p">(</span><span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">coffee</span><span class="p">())</span>

<span class="c1"># Plot the original image.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_gray</span><span class="p">)</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">coffee_gray</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: float64
Shape: (400, 600)
Max Pixel Value: 1.0
Min Pixel Value: 0.0
</pre></div>
</div>
<img alt="_images/d82d52811692c04712ff3dd4c3535ca3c131a987f9aaed636b100e92840c3bfd.png" src="_images/d82d52811692c04712ff3dd4c3535ca3c131a987f9aaed636b100e92840c3bfd.png" />
</div>
</div>
<p>First, we detect edges in the horizontal direction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter using the horizontal edge detection kernel.</span>
<span class="n">gradient_horizontal_coffee_gray</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span>
    <span class="n">coffee_gray</span><span class="p">,</span>
    <span class="n">horizontal_edge_detection_kernel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gradient_horizontal_coffee_gray</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7d58d6ec2478f03dcc44030b051f2eb36049d312dc328b7518329c252dfb0c89.png" src="_images/7d58d6ec2478f03dcc44030b051f2eb36049d312dc328b7518329c252dfb0c89.png" />
</div>
</div>
<p>Then, in the vertical direction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter using the vertical edge detection kernel.</span>
<span class="n">gradient_vertical_coffee_gray</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span>
    <span class="n">coffee_gray</span><span class="p">,</span>
    <span class="n">vertical_edge_detection_kernel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gradient_vertical_coffee_gray</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2a3220ce4f4f91e52f384e372e2b42793eece82e21cade6c7d62bb4aea0f194e.png" src="_images/2a3220ce4f4f91e52f384e372e2b42793eece82e21cade6c7d62bb4aea0f194e.png" />
</div>
</div>
<p>We can combine these two edge detection filters together to search for edges
in both directions. First, lets refresh our memory of what <code class="docutils literal notranslate"><span class="pre">edgy</span></code> looked like,
filtered in both directions separately:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the image which has been filtered with the horizontal edge detection kernel.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_horizontal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Horizontal Edges&#39;</span><span class="p">)</span>
<span class="c1"># Show the image which has been filtered with the vertical edge detection kernel.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_vertical</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Vertical Edges&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0c4d3e9dcbbdb167c627a3df65868ad370637c1ba010bf545312b07ad19271dd.png" src="_images/0c4d3e9dcbbdb167c627a3df65868ad370637c1ba010bf545312b07ad19271dd.png" />
</div>
</div>
<p>A simple way to combine these filters is to:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">np.stack()</span></code> them into 3D…</p></li>
<li><p>…then convert pixel values to absolute numbers (e.g. remove the signs)…</p></li>
<li><p>…and then take to the maximum value across the third dimension (e.g. using
<code class="docutils literal notranslate"><span class="pre">np.max(arr,</span> <span class="pre">axis</span> <span class="pre">=</span> <span class="pre">2)</span></code>). This will resize the array down to 2D and…</p></li>
</ul>
<p>…at the end of this process, only pixels for which an edge was detected in
either direction will remain in the resulting image array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine the filters.</span>
<span class="c1"># Stack to 3D, `shape` = (11, 10, 2).</span>
<span class="n">edgy_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">edgy_vertical</span><span class="p">,</span>
                                           <span class="n">edgy_horizontal</span><span class="p">],</span>
                                          <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Remove the signs, from all elements in the 3D array.</span>
<span class="n">edgy_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">edgy_vertical_horizontal_stack</span><span class="p">)</span>
<span class="c1"># Reshape to 2D, leaving only the largest value from either slice in the</span>
<span class="c1"># resulting array.</span>
<span class="n">edgy_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">edgy_vertical_horizontal_stack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_vertical_horizontal_stack</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/eb2f8ffd386e4083d500599d1f0801dba61439a11f72fabc0eb3d9c9c2c69c9d.png" src="_images/eb2f8ffd386e4083d500599d1f0801dba61439a11f72fabc0eb3d9c9c2c69c9d.png" />
</div>
</div>
<p>Pretty cool, here are all the steps, visualised together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot all the `edgy` images together.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Horizontal Edges&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_horizontal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Vertical Edges&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_vertical</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Both Combined&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_vertical_horizontal_stack</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/30fdc8bcc5fd81b1a9e01ff753f8691ea128feb31be04a20cf882e1618f30a62.png" src="_images/30fdc8bcc5fd81b1a9e01ff753f8691ea128feb31be04a20cf882e1618f30a62.png" />
</div>
</div>
<p>The pixel values throughout this edge detection process, on the <code class="docutils literal notranslate"><span class="pre">edgy</span></code> array,
are shown on the image below:</p>
<p><img alt="" src="_images/edge_detection_process.png" /></p>
<p>Let’s do this again, for the images that resulted from filtering <code class="docutils literal notranslate"><span class="pre">coffee_gray</span></code>
with our horizontal and vertical edge detection kernels, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search for both types of edge (with `coffee_gray`).</span>
<span class="c1"># Stack to 3D, `shape` = (400, 600, 2).</span>
<span class="n">coffee_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">gradient_vertical_coffee_gray</span><span class="p">,</span>
                                             <span class="n">gradient_horizontal_coffee_gray</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Remove the signs, from all elements in the 3D array.</span>
<span class="n">coffee_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coffee_vertical_horizontal_stack</span><span class="p">)</span>
<span class="c1"># Reshape to 2D, leaving only the largest value from # from either slice in</span>
<span class="c1"># the resulting 2D array.</span>
<span class="n">coffee_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coffee_vertical_horizontal_stack</span><span class="p">,</span>
                                          <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_vertical_horizontal_stack</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7c708d49bbe0c9ffbdba2d6eb2b6360d1ccebebe08948aeb1ff4c5e457946b0d.png" src="_images/7c708d49bbe0c9ffbdba2d6eb2b6360d1ccebebe08948aeb1ff4c5e457946b0d.png" />
</div>
</div>
<p>Edgy indeed…</p>
<p>We can view all of these steps together, on the plot below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot all the `coffee_gray` images together.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_gray</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Horizontal Edges&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gradient_horizontal_coffee_gray</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Vertical Edges&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gradient_vertical_coffee_gray</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Both Combined&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_vertical_horizontal_stack</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/931945ee376d97e32802d5e460a3ccc634cf91e73f9e55172051d38802c181f0.png" src="_images/931945ee376d97e32802d5e460a3ccc634cf91e73f9e55172051d38802c181f0.png" />
</div>
</div>
</section>
<section id="sobel-edge-detection-filtering">
<h2>Sobel edge detection filtering<a class="headerlink" href="#sobel-edge-detection-filtering" title="Link to this heading">#</a></h2>
<p>The Sobel filter is a similar edge detection filter, which uses the <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels/">following</a> <a class="reference external" href="https://nrsyed.com/2018/02/18/edge-detection-in-images-how-to-derive-the-sobel-operator">kernels</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sobel horizontal edge detection kernel.</span>
<span class="n">sobel_horizontal</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sobel horizontal edge detection kernel:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sobel_horizontal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sobel horizontal edge detection kernel:
 [[-1 -2 -1]
 [ 0  0  0]
 [ 1  2  1]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sobel vertical edge detection kernel.</span>
<span class="n">sobel_vertical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                           <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sobel vertical edge detection kernel:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sobel_vertical</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sobel vertical edge detection kernel:
 [[-1  0  1]
 [-2  0  2]
 [-1  0  1]]
</pre></div>
</div>
</div>
</div>
<p>Let’s try these out with <code class="docutils literal notranslate"><span class="pre">edgy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the Sobel horizontal edge detection filter.</span>
<span class="n">sobel_edgy_horizontal</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">edgy</span><span class="p">,</span>
                                      <span class="n">sobel_horizontal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel_edgy_horizontal</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/17b469bd8fde746a3805ee80491d8f1a775b21d6fa4f161a312f3e2b3cb525f9.png" src="_images/17b469bd8fde746a3805ee80491d8f1a775b21d6fa4f161a312f3e2b3cb525f9.png" />
</div>
</div>
<p>The effect on the individual pixel values is shown below:</p>
<p><img alt="" src="_images/horizontal_edge_matrices_sobel.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the Sobel vertical edge detection filter.</span>
<span class="n">sobel_edgy_vertical</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">edgy</span><span class="p">,</span>
                                    <span class="n">sobel_vertical</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel_edgy_vertical</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0445e196df363678e0060a1a2d0ee6e4bed5feb91ae5542d1280bade9d5bdd24.png" src="_images/0445e196df363678e0060a1a2d0ee6e4bed5feb91ae5542d1280bade9d5bdd24.png" />
</div>
</div>
<p>Again, you can inspect the effect on the individual pixel values below:</p>
<p><img alt="" src="_images/vertical_edge_matrices_sobel.png" /></p>
<p>We can combine each edge-filtered image using the method we saw above, taking
the absolute maximum values after stacking:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine the filters.</span>
<span class="c1"># Stack to 3D, `shape` = (11, 10, 2).</span>
<span class="n">sobel_edgy_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">sobel_edgy_vertical</span><span class="p">,</span>
                                                 <span class="n">sobel_edgy_horizontal</span><span class="p">],</span>
                                                <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Remove the signs, from all elements in the 3D array.</span>
<span class="n">sobel_edgy_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
    <span class="n">sobel_edgy_vertical_horizontal_stack</span><span class="p">)</span>
<span class="c1"># Reshape to 2D, leaving only the largest value from either slice in the</span>
<span class="c1"># resulting array.</span>
<span class="n">sobel_edgy_vertical_horizontal_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
    <span class="n">sobel_edgy_vertical_horizontal_stack</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel_edgy_vertical_horizontal_stack</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6d5dabe3702d6ea0b4ca8a6f0de1e498805f5efa8a370fc1f2f9681c378b8296.png" src="_images/6d5dabe3702d6ea0b4ca8a6f0de1e498805f5efa8a370fc1f2f9681c378b8296.png" />
</div>
</div>
<p>The more formal method is to use the following
<a class="reference external" href="https://nrsyed.com/2018/02/18/edge-detection-in-images-how-to-derive-the-sobel-operator">formula</a>,
where the filtered image containing the <em>vertical edges</em> (e.g. the
<em>horizontal</em> gradients) is <span class="math notranslate nohighlight">\(G_x\)</span>, and the filtered image containing the
<em>horizontal edges</em> (e.g. the <em>vertical</em> gradients) is <span class="math notranslate nohighlight">\(G_y\)</span>:</p>
<p><span class="math notranslate nohighlight">\( \large G_{\text{overall}} = \sqrt{ G_x^2 + G_y^2 } \)</span></p>
<p>You may recognise this as the <a class="reference external" href="https://en.wikipedia.org/wiki/Euclidean_distance">Euclidean distance</a> formula. It will give us the edges in both directions, pretty nifty!:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the numbers...</span>
<span class="n">sobel_overall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sobel_edgy_vertical</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sobel_edgy_horizontal</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel_overall</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ff27be9f9ca02de209410981e2d788d12564b32fd156516a6e5e6cb891c7b53b.png" src="_images/ff27be9f9ca02de209410981e2d788d12564b32fd156516a6e5e6cb891c7b53b.png" />
</div>
</div>
<p>Below we show the pixel values in this Sobel-filtered image, with edges in both directions - the numbers in the final array have been rounded to keep it uncluttered:</p>
<p><img alt="" src="_images/sobel_both.png" /></p>
</section>
<section id="edge-detection-filters-in-skimage">
<h2>Edge detection filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code><a class="headerlink" href="#edge-detection-filters-in-skimage" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">skimage</span></code> contains a variety of edge detection filters, and makes it a breeze
to implement them. You know the drill now, just pass <code class="docutils literal notranslate"><span class="pre">skimage</span></code> your NumPy
image array and pray the <code class="docutils literal notranslate"><span class="pre">dtype</span></code>s are all in order (we kid, but also not…).</p>
<p>Remember the first edge detection kernels that we used above?:</p>
<p><img alt="" src="_images/edge_dector_kernels.png" /></p>
<p><a class="reference external" href="https://scikit-image.org/docs/0.25.x/api/skimage.filters.html#skimage.filters.prewitt_h">Similar</a> <a class="reference external" href="https://scikit-image.org/docs/0.25.x/api/skimage.filters.html#skimage.filters.prewitt_v">kernels</a> <a class="reference external" href="https://en.wikipedia.org/wiki/Prewitt_operator">are are used by</a> <code class="docutils literal notranslate"><span class="pre">ski.filters.prewitt()</span></code> edge detection filter, which we implement in the cell below, on the <code class="docutils literal notranslate"><span class="pre">edgy</span></code> array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prewitt filtering.</span>
<span class="n">edgy_prewitt_ski</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">prewitt</span><span class="p">(</span><span class="n">edgy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_prewitt_ski</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/95e70816fa9868db969bd822e3ad1128f3625b24651412c1d4a0bfec5cde0f88.png" src="_images/95e70816fa9868db969bd822e3ad1128f3625b24651412c1d4a0bfec5cde0f88.png" />
</div>
</div>
<p>Here we implement the Sobel filter using <code class="docutils literal notranslate"><span class="pre">skimage</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The same Sobel result, via `skimage`.`</span>
<span class="n">edgy_sobel_ski</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">edgy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_sobel_ski</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ff27be9f9ca02de209410981e2d788d12564b32fd156516a6e5e6cb891c7b53b.png" src="_images/ff27be9f9ca02de209410981e2d788d12564b32fd156516a6e5e6cb891c7b53b.png" />
</div>
</div>
<p>The plot below shows the effect of the two filters, side by side:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Altogether...</span>
<span class="n">coins</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">coins</span><span class="p">()</span>
<span class="n">prewitt_coins</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">prewitt</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span>
<span class="n">sobel_coins</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span>
<span class="n">prewitt_coffee</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">prewitt</span><span class="p">(</span><span class="n">coffee_gray</span><span class="p">)</span>
<span class="n">sobel_coffee</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">coffee_gray</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                       <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
                       <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_prewitt_ski</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Prewitt Edge Filter&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_sobel_ski</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sobel Edge Filter&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prewitt_coins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Prewitt Edge Filter&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel_coins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sobel Edge Filter&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_gray</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prewitt_coffee</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Prewitt Edge Filter&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel_coffee</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sobel Edge Filter&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b533f61783efafeed82478eabbfe690856de39300f8de9dc83f54dbee5ecc21c.png" src="_images/b533f61783efafeed82478eabbfe690856de39300f8de9dc83f54dbee5ecc21c.png" />
</div>
</div>
<div class="exercise dropdown admonition" id="edgelord">

<p class="admonition-title"><span class="caption-number">Exercise 26 </span></p>
<section id="exercise-content">
<p>Think about all of the edge detection filter types we have seen above. You may
have noticed that, for all of the final output images from each filter, the
edges detected are two pixels wide. For instance the image below results from
filtering <code class="docutils literal notranslate"><span class="pre">edgy</span></code> with the Sobel filter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Edgy, filtered with `ski.filters.sobel()`.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_sobel_ski</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ff27be9f9ca02de209410981e2d788d12564b32fd156516a6e5e6cb891c7b53b.png" src="_images/ff27be9f9ca02de209410981e2d788d12564b32fd156516a6e5e6cb891c7b53b.png" />
</div>
</div>
<p>You can see that both the horizontal edges and the vertical edges are two
pixels wide.</p>
<p>Can you think of the modifications you could make to the edge detection
kernels, such that after applying the kernels to <code class="docutils literal notranslate"><span class="pre">edgy</span></code>, and combining the
results into one image, that the edges in the combined image are <em>only one
pixel wide</em>?</p>
<p>Think about what you need to do, and try to recreate this target image:</p>
<p><img alt="" src="_images/one_edge.png" /></p>
<p>Here are the original edge detection kernels we used, for comparison, to help
you think about what modifications you need to recreate the target image:</p>
<p><img alt="" src="_images/edge_dector_kernels.png" /></p>
<p>Please note that you will “pass” this exercise if you make kernels which detect one-pixel wide edges, even if your final image does not exactly match the one above. You could modify the Sobel kernels as well, or investigate other edge detection kernel types…</p>
<p><em>Hint:</em> run the function <code class="docutils literal notranslate"><span class="pre">hints.edgy()</span></code> for some help if you get stuck.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="6_gaussian_sharpening_edge-solution-7">

<p class="admonition-title">Solution to<a class="reference internal" href="#edgelord"> Exercise 26</a></p>
<section id="solution-content">
<p>The solution here is to use smaller kernels, so they are searching for pixel
intensity gradients in smaller pixel neighborhoods. We used the following
kernels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Detect horizontal edges.</span>
<span class="n">horizontal_2by2_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">horizontal_2by2_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1,  1],
       [-1, -1]])
</pre></div>
</div>
</div>
</div>
<p>…filtering <code class="docutils literal notranslate"><span class="pre">edgy</span></code> with this kernel yields single-pixel wide horizontal edges:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter `edgy` with our kernel to find the horizontal edges.</span>
<span class="n">edgy_horizontal_from_2by2</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">edgy</span><span class="p">,</span>
                                          <span class="n">weights</span><span class="o">=</span><span class="n">horizontal_2by2_kernel</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_horizontal_from_2by2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/70fbd55994cde933cd7fc7dd510a97784a252b6f5c7b2918fab2c7e4ec6c5a46.png" src="_images/70fbd55994cde933cd7fc7dd510a97784a252b6f5c7b2918fab2c7e4ec6c5a46.png" />
</div>
</div>
<p>Then we used this kernel to find the vertical edges:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vertical_2by2_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                 <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">vertical_2by2_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-1,  1],
       [-1,  1]])
</pre></div>
</div>
</div>
</div>
<p>…applying to <code class="docutils literal notranslate"><span class="pre">edgy</span></code> gives us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filtering `edgy` with our kernel to find the vertical edges.</span>
<span class="n">edgy_vertical_from_2by2</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">edgy</span><span class="p">,</span>
                                        <span class="n">weights</span><span class="o">=</span><span class="n">vertical_2by2_kernel</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_vertical_from_2by2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e959d1274eb241523c76bdb1d27ee2cf59b05fbb2cfa5c376fddcae2c6455d08.png" src="_images/e959d1274eb241523c76bdb1d27ee2cf59b05fbb2cfa5c376fddcae2c6455d08.png" />
</div>
</div>
<p>We then applied the Euclidean distance formula to get the horizontal and vertical edges in one image:</p>
<p><span class="math notranslate nohighlight">\( \large G_{\text{overall}} = \sqrt{ G_x^2 + G_y^2 } \)</span></p>
<p>As if by magic, we get our one-pixel wide edges, in the final image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Both types of edge together, with thanks to Euclid.</span>
<span class="n">edgy_both_from_2by2_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">edgy_vertical_from_2by2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">edgy_horizontal_from_2by2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">edgy_both_from_2by2_kernel</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f5dec8a75e492398f69e8646efbde7fd47685e175fd114f0df8def1bd495a31c.png" src="_images/f5dec8a75e492398f69e8646efbde7fd47685e175fd114f0df8def1bd495a31c.png" />
</div>
</div>
</section>
</div>
</section>
<section id="kernels-correlation-and-convolution">
<span id="on-convolution"></span><h2>Kernels, correlation and convolution<a class="headerlink" href="#kernels-correlation-and-convolution" title="Link to this heading">#</a></h2>
<p>We have used and explained the <code class="docutils literal notranslate"><span class="pre">ndi.correlate</span></code> function to apply the kernel
filter.</p>
<p>We should say here that we could also have used <code class="docutils literal notranslate"><span class="pre">ndi.convolve</span></code> to achieve the
same effect.
<a class="reference external" href="https://betterexplained.com/articles/intuitive-convolution">Convolution</a> is
another way of thinking of the same fundamental operation, of applying
a kernel at each pixel.</p>
<p>Here we will show that this is the same underling operation.  For reasons that
will soon become clear, this time we’re going to use a kernel that is not
left-right or up-down symmetric.  Please bear with us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">odd_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                       <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">],</span>
                       <span class="p">[</span> <span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll make a floating point image to apply our kernel to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Floating point version of camera image.</span>
<span class="n">f_camera</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">f_camera</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[200., 200., 200., ..., 189., 190., 190.],
       [200., 199., 199., ..., 190., 190., 190.],
       [199., 199., 199., ..., 190., 190., 190.],
       ...,
       [ 25.,  25.,  27., ..., 139., 122., 147.],
       [ 25.,  25.,  26., ..., 158., 141., 168.],
       [ 25.,  25.,  27., ..., 151., 152., 149.]], shape=(512, 512))
</pre></div>
</div>
</div>
</div>
<p>Now we’ll use our usual <code class="docutils literal notranslate"><span class="pre">ndi.correlate</span></code> operation to apply the kernel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">odd_image</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">f_camera</span><span class="p">,</span> <span class="n">odd_kernel</span><span class="p">)</span>
<span class="n">odd_image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[   2.,    5.,    1., ...,   -4.,    1.,    0.],
       [   5.,    3.,   -1., ...,   -2.,    1.,    0.],
       [  -1.,   -2.,    1., ...,    0.,    0.,    0.],
       ...,
       [   1.,   -2.,    6., ...,   -8.,  -34.,  -47.],
       [   0.,   -4.,    3., ...,  -72., -132.,   25.],
       [   0.,   -7.,    0., ...,    5.,  -13.,   90.]], shape=(512, 512))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">odd_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fda20fda850&gt;
</pre></div>
</div>
<img alt="_images/49e2f49040c4adf9f1ac2ca7a7fd69c67280f496ed46d471790479d1a8df7eec.png" src="_images/49e2f49040c4adf9f1ac2ca7a7fd69c67280f496ed46d471790479d1a8df7eec.png" />
</div>
</div>
<p>Now — <code class="docutils literal notranslate"><span class="pre">ndi.convolve</span></code> does <em>not</em> give use the same output when applying the same kernel.   You’ll soon see why.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Application of convolution using the same kernel.</span>
<span class="n">conv_img</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">f_camera</span><span class="p">,</span> <span class="n">odd_kernel</span><span class="p">)</span>
<span class="n">conv_img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[   1.,   -2.,   -4., ...,    5.,    4.,    0.],
       [  -3.,   -5.,   -4., ...,    5.,    2.,    0.],
       [  -2.,    2.,    3., ...,    0.,    0.,    0.],
       ...,
       [   2.,   -2.,    1., ..., -107.,  -44.,   64.],
       [   0.,    2.,    0., ...,  -42.,   74.,  113.],
       [   0.,    0.,    5., ...,  -11.,   57.,   -6.]], shape=(512, 512))
</pre></div>
</div>
</div>
</div>
<p>Notice from the display above that the numbers in this image differ from those in <code class="docutils literal notranslate"><span class="pre">odd_image</span></code> — the result of applying <code class="docutils literal notranslate"><span class="pre">ndi.correlate</span></code> with this kernel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Applying ndi.convolve with same kernel gives different result.</span>
<span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">conv_img</span> <span class="o">==</span> <span class="n">odd_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.False_
</pre></div>
</div>
</div>
</div>
<p>However, <code class="docutils literal notranslate"><span class="pre">ndi.convolve</span></code> is <em>applying</em> the kernel in a different way.  Specifically, it is applying the same calculations as <code class="docutils literal notranslate"><span class="pre">ndi.correlate</span></code> with a kernel that has been flipped on both left-right and up-down axes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flipped_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">odd_kernel</span><span class="p">))</span>
<span class="n">flipped_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-2., -3.,  2.],
       [-2.,  2.,  0.],
       [ 1.,  3., -1.]])
</pre></div>
</div>
</div>
</div>
<p>If we use this flipped kernel with <code class="docutils literal notranslate"><span class="pre">ndi.convolve</span></code>, we get the same result when
we applied the original kernel with <code class="docutils literal notranslate"><span class="pre">ndi.correlate</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reconv_img</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">f_camera</span><span class="p">,</span> <span class="n">flipped_kernel</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">reconv_img</span> <span class="o">==</span> <span class="n">odd_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.True_
</pre></div>
</div>
</div>
</div>
<p>The difference in <code class="docutils literal notranslate"><span class="pre">ndi.correlate</span></code> and <code class="docutils literal notranslate"><span class="pre">ndi.convolve</span></code> are just differences in
the interpretation of the kernel.  The <em>flipped</em> interpretation of convolution
comes from its roots in signal (1D) processing; in convolution, we often think
of the kernel as a response to an impulse, in which case applying the
kernel in an efficient way does require us to flip the kernel from left to
right.  See this <a class="reference external" href="https://betterexplained.com/articles/intuitive-convolution">intuitive explanation of
convolution</a> for more on this idea.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>This page has showed how to use various kernels to filter images, using
<code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">skimage</span></code>. We have seen how changing the kernel can alter
the filtering process to achieve different aims, like blurring/smoothing and
edge detection. On the <a class="reference internal" href="7_median_nonlocal_filters.html"><span class="doc std std-doc">next page</span></a> we will explore
different types of filters, which do not use kernel methods to implement their
filtering effects.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<p>Adapted from:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://lectures.scientific-python.org/advanced/image_processing">Scientific Python Lecture Notes - image
processing</a></p></li>
<li><p><a class="reference external" href="https://lectures.scientific-python.org/packages/scikit-image/index.html">Scientific Python Lecture Notes: scikit-image</a></p></li>
</ul>
<p>with further inspiration from:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jni.github.io/i2k-skimage-napari/lectures/1_image_filters.html">Napari tutorial</a>;</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-image/skimage-tutorials"><code class="docutils literal notranslate"><span class="pre">skimage</span></code> tutorial</a>;</p></li>
<li><p><a class="reference external" href="https://scipy-2024-image-analysis.github.io/tutorial/01_images_are_arrays.html">Scipy 2024 image analysis
tutorial</a>.</p></li>
</ul>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="crimson-peak" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>We made up the term “crimson-peak” for the peak our red
displays of Gaussian kernels, but, by coincidence, it is also <a class="reference external" href="https://en.wikipedia.org/wiki/Crimson_Peak">the title of
one of Guillermo del Toro’s less successful
films</a>.</p>
</aside>
<aside class="footnote brackets" id="independence" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Throughout, we will also assume that the inputs to our
multivariate (2D, 3D, 4D) Gaussians are <em>independent</em>.  We won’t attempt to
explain that here, but see <a class="reference external" href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution">Multivariate normal
distributions</a>.</p>
</aside>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="5_mean_filter.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Filtering with kernels - the mean filter</p>
      </div>
    </a>
    <a class="right-next"
       href="7_median_nonlocal_filters.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">More filters: the median filter and non-local filters</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-filtering">Gaussian filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-filters-in-skimage">Gaussian filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#image-sharpening">Image sharpening</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-detection-filtering">Edge detection filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sobel-edge-detection-filtering">Sobel edge detection filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-detection-filters-in-skimage">Edge detection filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernels-correlation-and-convolution">Kernels, correlation and convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Peter Rush, Matthew Brett
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>