
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Image filtering I &#8212; Scikit-image via NumPy and SciPy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css?v=982b99e0" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4_filters';</script>
    <link rel="canonical" href="https://pxr687.github.io/skimage-tutorials-temp/4_filters.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Image filtering II" href="5_filters_2.html" />
    <link rel="prev" title="(Sci-kit) Image processing, via NumPy and SciPy" href="3_skimage_processing_from_numpy_and_scipy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/colourwheel.png" class="logo__image only-light" alt="Scikit-image via NumPy and SciPy - Home"/>
    <script>document.write(`<img src="_static/colourwheel.png" class="logo__image only-dark" alt="Scikit-image via NumPy and SciPy - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Scikit-image via NumPy and SciPy</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_images_as_numpy_arrays.html">What is an image? - Images as NumPy arrays</a></li>







<li class="toctree-l1"><a class="reference internal" href="1_colour_images_as_numpy_arrays.html">What about colour?</a></li>





<li class="toctree-l1"><a class="reference internal" href="2_skimage_intro.html">Introducing Scikit-image</a></li>










<li class="toctree-l1"><a class="reference internal" href="3_skimage_processing_from_numpy_and_scipy.html">(Sci-kit) Image processing, via NumPy and SciPy</a></li>













<li class="toctree-l1 current active"><a class="current reference internal" href="#">Image filtering I</a></li>










<li class="toctree-l1"><a class="reference internal" href="5_filters_2.html">Image filtering II</a></li>








<li class="toctree-l1"><a class="reference internal" href="7_morphology.html">Morphology</a></li>







</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp/edit/main/4_filters.Rmd" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pxr687/skimage-tutorials-temp/issues/new?title=Issue%20on%20page%20%2F4_filters.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4_filters.Rmd" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.Rmd</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Image filtering I</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Image filtering I</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-signal-what-is-noise">What is signal? What is noise?</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold-filtering">Threshold Filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-segmentation-via-threshold-filtering">Image segmentation via threshold filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold-filters-in-skimage">Threshold filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#kernels-and-pixel-neighbourhoods">Kernels and pixel neighbourhoods</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-filtering-with-skimage">Mean filtering with <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-3d-images">Filtering 3D images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="image-filtering-i">
<h1>Image filtering I<a class="headerlink" href="#image-filtering-i" title="Link to this heading">#</a></h1>
<p>A common operation we will want to perform on images is <em>filtering</em>. This is where we modify all of the pixels in an image according to a certain rule or algorithm, often based on other pixel values within the “local neighbourhood” of a given pixel. Filtering techniques can be used to remove noise from an image, or to achieve specific visual effects, amongst other purposes.</p>
<p>Here we will look at some important filtering techniques: threshold filtering and mean filtering. We will show how they work at the pixel-level, using <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy</span></code>, and then we will show how to implement them in <code class="docutils literal notranslate"><span class="pre">skimage</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Library imports.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ndi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ski</span>

<span class="c1"># Set &#39;gray&#39; as the default colormap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>

<span class="c1"># Set NumPy precision to 2 decimal places</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#  Custom functions for illustrations, hints, and to quickly report image attributes.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">noise_illustration</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_image</span><span class="p">,</span> <span class="n">original_image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">show_attributes</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_attributes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hints</span><span class="w"> </span><span class="kn">import</span> <span class="n">hint_strange_coffee</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="what-is-signal-what-is-noise">
<h1>What is signal? What is noise?<a class="headerlink" href="#what-is-signal-what-is-noise" title="Link to this heading">#</a></h1>
<p>Imagine that I want to send you a picture message. Let’s use “the signal” as the name for the message before I send it to you. Before transmission, the signal has a clear meaning which I am confident you will be able to interpret. However, imagine that I am sending you the message via an unreliable medium; a messaging system that is prone to corrupting messages when transmitting them.</p>
<p>When I send you the message, there is a decent chance that unwanted randomness will be added to the image file, because of technical problems with the transmission medium. This might result in an image which contains so much randomness that it is hard to discern the original signal.</p>
<p>Imagine that the cell below attempts to send my picture message - can you see what the signal is?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a noisy image array.</span>
<span class="n">noisy</span> <span class="o">=</span> <span class="n">generate_image</span><span class="p">()</span>  
<span class="n">show_attributes</span><span class="p">(</span><span class="n">noisy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: float64
Shape: (7, 7)
Max Pixel Value: 1.0
Min Pixel Value: -0.95
</pre></div>
</div>
<img alt="_images/94117ae07f12ab142ff9d3b341c60a7d760349f3f5cf956527683cfe33ae6afb.png" src="_images/94117ae07f12ab142ff9d3b341c60a7d760349f3f5cf956527683cfe33ae6afb.png" />
</div>
</div>
<p>Any idea what it is? Maybe you can determine what signal is in there. We trust that it is at least somewhat ambiguous, to most readers.</p>
<p>We saw simple threshold filtering on an <a class="reference internal" href="3_skimage_processing_from_numpy_and_scipy.html"><span class="doc std std-doc">earlier page</span></a>. This is where we select a threshold value, and binarize the image using that value. So a given pixel becomes <code class="docutils literal notranslate"><span class="pre">True</span></code> if a pixel is more intense than the threshold, and <code class="docutils literal notranslate"><span class="pre">False</span></code> if it is lower (or vice versa, depending on the comparison operator).</p>
<p>The aim here is typically to split the pixels into distinct classes, based on their intensity values. We can use the <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code> method to view a historgram of the pixel intensities, in order to find a threshold that might be useful to use in a filter. The <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code> method “flattens” the image array to 1-D, so that it can be displayed as a histogram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The `shape` of the original `noisy` image.</span>
<span class="n">noisy</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7, 7)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flatten to 1-D with the `.ravel()` method.</span>
<span class="n">noisy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(49,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show a histogram of the pixel intensity values, from the &quot;flattened&quot; `noisy` array.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">noisy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cb1363c9a7cbad7c5ef34960df4a7aa821c5d8c26e80f2effb8dea6491fa86af.png" src="_images/cb1363c9a7cbad7c5ef34960df4a7aa821c5d8c26e80f2effb8dea6491fa86af.png" />
</div>
</div>
<p>Ok, so it looks like the distribution is trimodal. The message is in the <code class="docutils literal notranslate"><span class="pre">float64</span></code> <code class="docutils literal notranslate"><span class="pre">dtype</span></code>, using intensities ranging from -1 to 1. Let’s set a threshold filter for each dip, in between the three peaks, so we’ll try once with a threshold of -0.50, and once with a threshold of 0.25. These threshold values are shown as vertical lines on the plot below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show a histogram of the pixel intensity values, with some thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">noisy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Threshold 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Threshold 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/912854e8085db29c5cb0334eab4af955d1cb0dabaeaabf745f2923ee21f1afe3.png" src="_images/912854e8085db29c5cb0334eab4af955d1cb0dabaeaabf745f2923ee21f1afe3.png" />
</div>
</div>
<p>The filters are created, using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> comparison operator, in the next two cells:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The first simple, Boolean threshold filter.</span>
<span class="n">simple_threshold_filter_1</span> <span class="o">=</span> <span class="n">noisy</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.50</span>
<span class="n">simple_threshold_filter_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ True, False,  True,  True,  True, False,  True],
       [False,  True, False,  True, False,  True,  True],
       [ True,  True,  True,  True,  True,  True,  True],
       [False,  True,  True,  True,  True,  True, False],
       [ True,  True,  True,  True, False,  True,  True],
       [False,  True,  True,  True,  True,  True,  True],
       [False,  True, False,  True,  True,  True,  True]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second simple, Boolean threshold filter.</span>
<span class="n">simple_threshold_filter_2</span> <span class="o">=</span> <span class="n">noisy</span> <span class="o">&gt;</span> <span class="mf">0.25</span>
<span class="n">simple_threshold_filter_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[False, False, False, False, False, False, False],
       [False,  True, False,  True, False,  True, False],
       [False,  True, False,  True, False, False, False],
       [False,  True, False,  True, False,  True, False],
       [False,  True, False,  True, False,  True, False],
       [False,  True, False,  True, False,  True, False],
       [False, False, False, False, False, False, False]])
</pre></div>
</div>
</div>
</div>
<p>Each threshold filter is just a Boolean array, with the same <code class="docutils literal notranslate"><span class="pre">.shape</span></code> as the image. When we render these arrays with Matplotlib, we will see a binary image, where <code class="docutils literal notranslate"><span class="pre">True</span></code> values are mapped to white and <code class="docutils literal notranslate"><span class="pre">False</span></code> values are mapped to 0.</p>
<p>Because we used the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> comparison operator, only pixels larger than the threshold values will be <code class="docutils literal notranslate"><span class="pre">True</span></code>. Let’s see if this clears up any of the noise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Threshold filters.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Threshold = -0.5&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simple_threshold_filter_1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Threshold = 0.25&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simple_threshold_filter_2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a38024ecb7e0fa6c7166dc012c15fcbfc1457e36880692725d5613f52182910a.png" src="_images/a38024ecb7e0fa6c7166dc012c15fcbfc1457e36880692725d5613f52182910a.png" />
</div>
</div>
<p>Ok, so the first image still looks very noisy still, but the second looks like we might be getting somewhere. Maybe you can already guess what the original signal was…</p>
<p>Let’s loop through some other threshold values, between just below 0 to just larger than 0.25, to see if the clarity of the signal improves:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through some different threshold values, and plot the results.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">n_plots</span><span class="o">=</span><span class="mi">6</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> 
                                    <span class="n">stop</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> 
                                    <span class="n">num</span><span class="o">=</span><span class="n">n_plots</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_plots</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Threshold =</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy</span> <span class="o">&gt;</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7cf0845ce5da37a0703d81aed8d5a64db8ba6ac8d001f8a9139cad2b11c5e5b1.png" src="_images/7cf0845ce5da37a0703d81aed8d5a64db8ba6ac8d001f8a9139cad2b11c5e5b1.png" />
</div>
</div>
<p>We hope you feel suitably greeted! The threshold of 0.18 seems to reveal what signal was originally in this image, before the unwanted random noise was added, by the faulty transmission system.</p>
<p>Here we have recovered a signal from a noisy image, and made the features in the image easier to discern. You’ll notice that we had to try numerous threshold values to find the “sweet spot” with the best results. Other values “overshoot” and “undershoot” the optimum value.</p>
<p>Here was the original image, before the noise was added:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">original_image</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c3bdc4fe3f57a35ca0b41dc98ec0729ffe1ae1cf3eae4e5f2e8da778a4358e0a.png" src="_images/c3bdc4fe3f57a35ca0b41dc98ec0729ffe1ae1cf3eae4e5f2e8da778a4358e0a.png" />
</div>
</div>
<p>Reducing noise and enhancing image features are both common aims in image filtering. Both processes often require some trial and error with different values for optional arguments that go into the filtering operation, as it did here. We will now turn to some other common methods for threshold filtering, using a variety of other images.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="threshold-filtering">
<h1>Threshold Filtering<a class="headerlink" href="#threshold-filtering" title="Link to this heading">#</a></h1>
<p>As we have seen, threshold filtering invovles modifying pixel values based on a threshold value. Let’s investigate other thresholding methods using a greyscale image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a greyscale image array.</span>
<span class="n">random_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">random_i</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0 0 0 0 0 0 0 0]
 [0 0 0 4 8 0 0 0]
 [0 0 0 3 8 0 0 0]
 [0 0 0 0 0 0 0 0]
 [0 0 0 4 5 0 0 0]
 [0 0 0 3 4 0 0 0]
 [0 0 0 3 5 0 0 0]
 [0 0 0 3 9 0 0 0]
 [0 0 0 7 6 0 0 0]
 [0 0 0 0 0 0 0 0]]
</pre></div>
</div>
<img alt="_images/1152ca9ff91544f0e95d3a57714c45c188bc7a30e93201c9188eb5d12e49343e.png" src="_images/1152ca9ff91544f0e95d3a57714c45c188bc7a30e93201c9188eb5d12e49343e.png" />
</div>
</div>
<p>As we saw above, it is simple to create a Boolean filter, using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> comparison operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a Boolean array using a comparison operator.</span>
<span class="n">random_i_thresholded</span> <span class="o">=</span> <span class="n">random_i</span> <span class="o">&gt;</span> <span class="mi">5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_i_thresholded</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">random_i_thresholded</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[False False False False False False False False]
 [False False False False  True False False False]
 [False False False False  True False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False  True False False False]
 [False False False  True  True False False False]
 [False False False False False False False False]]
</pre></div>
</div>
<img alt="_images/b42b2e6772ed014a2096fe13aae7b9053b350d44ed68430d912219e276a230b6.png" src="_images/b42b2e6772ed014a2096fe13aae7b9053b350d44ed68430d912219e276a230b6.png" />
</div>
</div>
<p>This filters <em>out</em> pixels <em>below</em> the threshold value (5), by setting them to 0/<code class="docutils literal notranslate"><span class="pre">False</span></code>. Different threshold values will allow more or less pixels to “survive” the filtering operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A sole survivor!</span>
<span class="n">random_i_filtered_9</span> <span class="o">=</span> <span class="n">random_i</span> <span class="o">&gt;=</span> <span class="mi">9</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_i_filtered_9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">random_i_filtered_9</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False False False False False]
 [False False False False  True False False False]
 [False False False False False False False False]
 [False False False False False False False False]]
</pre></div>
</div>
<img alt="_images/eb6f6a50eb12333909ba5459a97a3b60683a73d7027b7972a0ed80448e903ea5.png" src="_images/eb6f6a50eb12333909ba5459a97a3b60683a73d7027b7972a0ed80448e903ea5.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="image-segmentation-via-threshold-filtering">
<h1>Image segmentation via threshold filtering<a class="headerlink" href="#image-segmentation-via-threshold-filtering" title="Link to this heading">#</a></h1>
<p>This threshold filtering technique can be useful for segregating the foreground from the background of real images, like <code class="docutils literal notranslate"><span class="pre">camera</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the `camera` image from `ski.data`.</span>
<span class="n">camera</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span>
<span class="c1"># Show the &quot;raw&quot; `camera` array.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="c1"># Show `camera` graphically.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[200 200 200 ... 189 190 190]
 [200 199 199 ... 190 190 190]
 [199 199 199 ... 190 190 190]
 ...
 [ 25  25  27 ... 139 122 147]
 [ 25  25  26 ... 158 141 168]
 [ 25  25  27 ... 151 152 149]]
</pre></div>
</div>
<img alt="_images/e53f3a3c5fc0ef4d094fb066bd80afdff2b0805a193caae078567661d17d0c3d.png" src="_images/e53f3a3c5fc0ef4d094fb066bd80afdff2b0805a193caae078567661d17d0c3d.png" />
</div>
</div>
<p>We can again use the NumPy <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">camera</span></code> array to allow us to view a histogram of the pixel intensities. We set the number of bins (<span class="math notranslate nohighlight">\(x\)</span>-axis intervals) for the histogram to be 128, to keep the plot looking smooth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot a histogram of the `camera` pixel intensities, with 128 bins.</span>
<span class="n">n_bins</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a4ac39ae9ac022a15e82a08d868278a23a6f5379180d69bec0c2acfa9a097a83.png" src="_images/a4ac39ae9ac022a15e82a08d868278a23a6f5379180d69bec0c2acfa9a097a83.png" />
</div>
</div>
<p>The “bins” are the intervals along the <span class="math notranslate nohighlight">\(x\)</span>-axis in which pixel intensity values are counted to determine the height of the blue “hills” in the histogram above, within a given interval. It is important, when thresholding, to choose a sensible number of bins. Too few or too many and we will miss important information, because we are cramming way too many or too few pixels into each interval, respectively.</p>
<p>The plot below shows the <code class="docutils literal notranslate"><span class="pre">camera</span></code> pixel intensities, with too few and too many bins. The bin intervals starts and ends are indicated with vertical red lines. The height on the histogram, for a given bin, is determined by the <code class="docutils literal notranslate"><span class="pre">Pixel</span> <span class="pre">Count</span></code> falling with the range of intensities for that bin:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some plot formatting parameters (to show the bins).</span>
<span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
<span class="n">markersize</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># Too few bins...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">n_bins_few</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins_few</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_bins_few</span><span class="si">}</span><span class="s2"> bins. Too few!&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">colours</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
            <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Too many bins...</span>
<span class="n">n_bins_many</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_bins_many</span><span class="si">}</span><span class="s2"> bins. Too many!&quot;</span><span class="p">)</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins_many</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/af99a57f3aeb547f6e2d9efba408455017829e0c57f848de60fcbd859d962d26.png" src="_images/af99a57f3aeb547f6e2d9efba408455017829e0c57f848de60fcbd859d962d26.png" />
</div>
</div>
<p>128 bins gives us a good middle ground, where we can see patterns in the distribution easily, without losing information or overemphasising unrepresentative values. Using the sensible number of bins, the distribution is clearly tri-modal, with a clear dip/separation around between 50 and 100-ish, and another just before 200-ish. This locations are indicated on the plot with vertical lines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show some &quot;by eye&quot; thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/901ac070e617a78fee681a2f5d14c8511086f9e62c5d176eb675fec453253e45.png" src="_images/901ac070e617a78fee681a2f5d14c8511086f9e62c5d176eb675fec453253e45.png" />
</div>
</div>
<p>Let’s use these “by eye” crude threshold values and apply a threshold filter using them. Remember, we are trying to separate the pixels into distinct classes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a threshold, &quot;by eye&quot;.</span>
<span class="n">crude_threshold</span> <span class="o">=</span> <span class="mi">80</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the filter.</span>
<span class="n">camera_threshold_filtered</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">camera_threshold_filtered</span> <span class="o">=</span> <span class="n">camera_threshold_filtered</span> <span class="o">&lt;</span> <span class="n">crude_threshold</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_threshold_filtered</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b835ff6c75a5548764d8b7f8c8f87d4ae96c7b9f7d84a89de061773978ca3fc3.png" src="_images/b835ff6c75a5548764d8b7f8c8f87d4ae96c7b9f7d84a89de061773978ca3fc3.png" />
</div>
</div>
<p>That has worked fairly well, as far as it goes, for segmenting the foreground (the cameraman) away from the background (the field and buildings behind the cameraman).</p>
<p>We can show the “opposite” binary image, by reversing the comparison operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using the &quot;opposite&quot; comparison operator.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span> <span class="o">&gt;</span> <span class="n">crude_threshold</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3129b852b6217c30661f5c58874cb8672c9824e40f7a6614330c83e7d3977703.png" src="_images/3129b852b6217c30661f5c58874cb8672c9824e40f7a6614330c83e7d3977703.png" />
</div>
</div>
<p>Stylish! Someone should put that on a t-shirt…</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="threshold-filters-in-skimage">
<h1>Threshold filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code><a class="headerlink" href="#threshold-filters-in-skimage" title="Link to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">skimage</span></code> contains many threshold filters, the cell below uses the <code class="docutils literal notranslate"><span class="pre">dir()</span></code> function to show the available selection:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the `skimage` threshold filters.</span>
<span class="p">[</span><span class="n">fil</span> <span class="k">for</span> <span class="n">fil</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span> <span class="k">if</span> <span class="n">fil</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;threshold_isodata&#39;,
 &#39;threshold_li&#39;,
 &#39;threshold_local&#39;,
 &#39;threshold_mean&#39;,
 &#39;threshold_minimum&#39;,
 &#39;threshold_multiotsu&#39;,
 &#39;threshold_niblack&#39;,
 &#39;threshold_otsu&#39;,
 &#39;threshold_sauvola&#39;,
 &#39;threshold_triangle&#39;,
 &#39;threshold_yen&#39;]
</pre></div>
</div>
</div>
</div>
<p>These filters typically, when passed an image array, find a threshold value automatically - e.g. at value at which to binarize the image to split the pixels into distinct classes. These distinct pixel classes often correspond to distinct <em>features</em> or <em>regions</em> in the image (cameraman vs field, foreground vs background etc.). The threshold value search performed by the <code class="docutils literal notranslate"><span class="pre">ski.filter.threshold*</span></code> functions aims to maximize the separation between pixel classes, and the different available functions use different algorithms to identify the “best” threshold value(s).</p>
<p>One simple method, similar to the “look at the histogram” method we just used above, is the <a class="reference external" href="https://en.wikipedia.org/wiki/Otsu%27s_method">Otsu method</a>. This aims to divide pixels into two distinct classes, by mathematically analysing a histogram of the pixel intensities. Below we use the <code class="docutils literal notranslate"><span class="pre">ski.filters.threshold_otsu()</span></code> function to recommend a threshold value, to segment our image into two pixel classes.</p>
<p>By specifying the <code class="docutils literal notranslate"><span class="pre">nbins</span></code> argument, we We get <code class="docutils literal notranslate"><span class="pre">.threshold_otsu()</span></code> to analyse a histogram which has the same number of bins as the one we were using above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pass our `camera` array to the `threshold_otsu()` function.</span>
<span class="n">otsu_thresh</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">threshold_otsu</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> 
                                         <span class="n">nbins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>

<span class="c1"># Show the Otsu threshold</span>
<span class="n">otsu_thresh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(102)
</pre></div>
</div>
</div>
</div>
<p>We show the <code class="docutils literal notranslate"><span class="pre">otsu_thesh</span></code>old as a vertical line on the histogram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the pixel intensities, and the Otsu threshold.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_thresh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Otsu Threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1fd47f0e97f5dee4a6a23dd5439b30742ea79b981fee44b8f3e8b41cc5080afa.png" src="_images/1fd47f0e97f5dee4a6a23dd5439b30742ea79b981fee44b8f3e8b41cc5080afa.png" />
</div>
</div>
<p>You can see that the method finds a threshold is pretty close to the one we chose “by eye” earlier on the page. Let’s apply the Otsu filter, simply by using <code class="docutils literal notranslate"><span class="pre">camera</span> <span class="pre">&lt;</span> <span class="pre">otsu_thresh</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter in the image using the Otsu threshold.</span>
<span class="n">camera_otsu_filtered</span> <span class="o">=</span> <span class="n">camera</span> <span class="o">&lt;</span> <span class="n">otsu_thresh</span>

<span class="c1"># Show a plot of the whole Otsu filtering process.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_thresh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Otsu threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_otsu_filtered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Otsu filtered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/837a5b2ff1bb4f02d397f7bfdf9079eb04b0e6d0f6f63f27100c82dedb31ac08.png" src="_images/837a5b2ff1bb4f02d397f7bfdf9079eb04b0e6d0f6f63f27100c82dedb31ac08.png" />
</div>
</div>
<p>If you look at the filtered image (on the right hand side of the plot), it seems to have achieved pretty good foreground/background segmentation…</p>
<p>How does the Otsu threshold filter work? Conceptually, the Otsu method involves splitting the histogram into two parts, lots of times, and comparing different splits for how well they separate pixels into two classes, based on a specific numeric metric. The histogram, for each split, is split at the center one of the bin intervals. The aim is to find which bin interval center gives a split which yields two classes of pixels which are maximally different from one another, by the aforementioned numeric metric. Sometimes, hopefully, this corresponds to pixels forming the background of the image vs pixels forming the forground of the image.</p>
<p>Since the Otsu method relies on some the “mechanics” of histograms, so let’s “deconstruct” the histogram in the center of the plot above, to see how the method proceeds. To do this, we can use the <code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code> function. We give it a flattened 1-D image array (e.g. flattened with <code class="docutils literal notranslate"><span class="pre">.ravel()</span></code>), and we tell it a number of bins to use. Again, we will use the sensible value of 128 bins. (<em>Note</em>: you could also use <code class="docutils literal notranslate"><span class="pre">ski.exposure.histogram()</span></code> here, for similar results).</p>
<p><code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code> will return two arrays. The first is the pixel count within each bin, so in this case we will get 128 individual numbers, because there are 128 bins. We will call this array <code class="docutils literal notranslate"><span class="pre">counts</span></code>. These <code class="docutils literal notranslate"><span class="pre">counts</span></code> determine the height of the histogram over each bin. The first <code class="docutils literal notranslate"><span class="pre">count</span></code> is for the first bin, the second <code class="docutils literal notranslate"><span class="pre">count</span></code> is for the second bin, and so on, as we move along the <span class="math notranslate nohighlight">\(x\)</span>-axis from left to right.</p>
<p>The second array returned by <code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code> contains the start point of each bin (e.g. each <span class="math notranslate nohighlight">\(x\)</span>-axis interval within which we get the <code class="docutils literal notranslate"><span class="pre">Pixel</span> <span class="pre">Count</span></code>). We will call this array <code class="docutils literal notranslate"><span class="pre">edges</span></code>.</p>
<p>The size of each array will vary, based on the number of bins we ask NumPy to use to make the histogram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get `counts` and `edges`.</span>
<span class="n">counts</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> 
                             <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show counts.</span>
<span class="n">counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   2,  628, 5624, 3516, 1844, 1479, 1427, 1464, 1605, 2272, 3101,
       4955, 7451, 9584, 9191, 6119, 3754, 2452, 1677, 1288,  988,  885,
        901,  837,  796,  640,  602,  566,  582,  480,  456,  404,  382,
        398,  352,  316,  343,  350,  314,  312,  289,  324,  308,  314,
        296,  320,  304,  315,  343,  399,  410,  424,  414,  412,  484,
        495,  573,  632,  777,  861,  940, 1033, 1213, 1368, 1492, 1783,
       1951, 2164, 2392, 2610, 3001, 3338, 3911, 4233, 4340, 4759, 5196,
       5341, 5398, 5428, 5104, 4808, 4051, 3360, 2588, 2067, 1582, 1352,
       1186,  997,  860,  773,  706,  566,  569, 1877, 2709, 3980, 6792,
       6318, 7477, 6217, 5413, 8153, 7025, 6540, 5459, 3523, 1825, 1074,
       1713,  710,  316,  330,  472,  412,  324,  275,  157,  135,  201,
         66,   73,   95,  102,  128,  198,  564])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show `edges`.</span>
<span class="n">edges</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  0.  ,   1.99,   3.98,   5.98,   7.97,   9.96,  11.95,  13.95,
        15.94,  17.93,  19.92,  21.91,  23.91,  25.9 ,  27.89,  29.88,
        31.88,  33.87,  35.86,  37.85,  39.84,  41.84,  43.83,  45.82,
        47.81,  49.8 ,  51.8 ,  53.79,  55.78,  57.77,  59.77,  61.76,
        63.75,  65.74,  67.73,  69.73,  71.72,  73.71,  75.7 ,  77.7 ,
        79.69,  81.68,  83.67,  85.66,  87.66,  89.65,  91.64,  93.63,
        95.62,  97.62,  99.61, 101.6 , 103.59, 105.59, 107.58, 109.57,
       111.56, 113.55, 115.55, 117.54, 119.53, 121.52, 123.52, 125.51,
       127.5 , 129.49, 131.48, 133.48, 135.47, 137.46, 139.45, 141.45,
       143.44, 145.43, 147.42, 149.41, 151.41, 153.4 , 155.39, 157.38,
       159.38, 161.37, 163.36, 165.35, 167.34, 169.34, 171.33, 173.32,
       175.31, 177.3 , 179.3 , 181.29, 183.28, 185.27, 187.27, 189.26,
       191.25, 193.24, 195.23, 197.23, 199.22, 201.21, 203.2 , 205.2 ,
       207.19, 209.18, 211.17, 213.16, 215.16, 217.15, 219.14, 221.13,
       223.12, 225.12, 227.11, 229.1 , 231.09, 233.09, 235.08, 237.07,
       239.06, 241.05, 243.05, 245.04, 247.03, 249.02, 251.02, 253.01,
       255.  ])
</pre></div>
</div>
</div>
</div>
<p>Look at the first two values in the <code class="docutils literal notranslate"><span class="pre">edges</span></code> array, they form the interval for the first bin. So the first bin interval runs between 0 and 1.99, the second interval runs between the next two values of 1.99 and 3.98 and so on.</p>
<p>Each value in <code class="docutils literal notranslate"><span class="pre">counts</span></code> is the count of pixel intensity values in <code class="docutils literal notranslate"><span class="pre">camera</span></code> which fall within the corresponding interval. Let’s check this is correct by Boolean indexing <code class="docutils literal notranslate"><span class="pre">camera</span></code> to see how many pixels fall within the first interval (0 to 1.99):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For the first bin interval.</span>
<span class="n">camera</span><span class="p">[(</span><span class="n">camera</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera</span> <span class="o">&lt;=</span> <span class="mf">1.99</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>Sure enough there are two pixels in the interval, which corresponds to the first value in the <code class="docutils literal notranslate"><span class="pre">counts</span></code> array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The first value in the `counts` array.</span>
<span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(2)
</pre></div>
</div>
</div>
</div>
<p>The second interval (e.g. the next two <code class="docutils literal notranslate"><span class="pre">edges</span></code> values) runs between 1.99 and 3.98. The second value of the <code class="docutils literal notranslate"><span class="pre">counts</span></code> array is 628, so there should be 628 pixels within this interval:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second value in `counts`.</span>
<span class="n">counts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(628)
</pre></div>
</div>
</div>
</div>
<p>Let’s manually get the pixels in <code class="docutils literal notranslate"><span class="pre">camera</span></code> which fall in this second bin interval:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For the second bin interval.</span>
<span class="n">camera</span><span class="p">[(</span><span class="n">camera</span> <span class="o">&gt;</span> <span class="mf">1.99</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera</span> <span class="o">&lt;=</span> <span class="mf">3.98</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 2, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 2,
       2, 3, 2, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
       3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>It certainly looks like there could be 600+ values in there! We don’t feel like counting, so let’s verify how many pixels there are in this bin interval using <code class="docutils literal notranslate"><span class="pre">len()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count the pixels in the second bin interval.</span>
<span class="nb">len</span><span class="p">(</span><span class="n">camera</span><span class="p">[(</span><span class="n">camera</span> <span class="o">&gt;</span> <span class="mf">1.99</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera</span> <span class="o">&lt;=</span> <span class="mf">3.98</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>628
</pre></div>
</div>
</div>
</div>
<p>So, each adjacent pair of numbers in <code class="docutils literal notranslate"><span class="pre">edges</span></code> tells us the range of each bin interval, and the corresponding value in <code class="docutils literal notranslate"><span class="pre">counts</span></code> tells us the height on the histogram within that interval. The image below shows the first, second, third and final (128th) interval in the <code class="docutils literal notranslate"><span class="pre">edges</span></code> array:</p>
<p><img alt="" src="_images/hist_bins.png" /></p>
<p>Ok, so we now have our deconstructed histogram. To implement the Otsu method, we next need to find the center of each bin interval (e.g. the middle point between the lower and higher number in each pair). Once we have the bin centers, we can use those to start splitting the histogram in two, to find the split that gives us the most distinct two groupings of pixels, on either side of the split. This is a simple calculation, we can get the first value of each bin interval with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The first value of each bin interval.</span>
<span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  0.  ,   1.99,   3.98,   5.98,   7.97,   9.96,  11.95,  13.95,
        15.94,  17.93,  19.92,  21.91,  23.91,  25.9 ,  27.89,  29.88,
        31.88,  33.87,  35.86,  37.85,  39.84,  41.84,  43.83,  45.82,
        47.81,  49.8 ,  51.8 ,  53.79,  55.78,  57.77,  59.77,  61.76,
        63.75,  65.74,  67.73,  69.73,  71.72,  73.71,  75.7 ,  77.7 ,
        79.69,  81.68,  83.67,  85.66,  87.66,  89.65,  91.64,  93.63,
        95.62,  97.62,  99.61, 101.6 , 103.59, 105.59, 107.58, 109.57,
       111.56, 113.55, 115.55, 117.54, 119.53, 121.52, 123.52, 125.51,
       127.5 , 129.49, 131.48, 133.48, 135.47, 137.46, 139.45, 141.45,
       143.44, 145.43, 147.42, 149.41, 151.41, 153.4 , 155.39, 157.38,
       159.38, 161.37, 163.36, 165.35, 167.34, 169.34, 171.33, 173.32,
       175.31, 177.3 , 179.3 , 181.29, 183.28, 185.27, 187.27, 189.26,
       191.25, 193.24, 195.23, 197.23, 199.22, 201.21, 203.2 , 205.2 ,
       207.19, 209.18, 211.17, 213.16, 215.16, 217.15, 219.14, 221.13,
       223.12, 225.12, 227.11, 229.1 , 231.09, 233.09, 235.08, 237.07,
       239.06, 241.05, 243.05, 245.04, 247.03, 249.02, 251.02, 253.01])
</pre></div>
</div>
</div>
</div>
<p>…and we can get the second value of each bin interval with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second value of each interval.</span>
<span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  1.99,   3.98,   5.98,   7.97,   9.96,  11.95,  13.95,  15.94,
        17.93,  19.92,  21.91,  23.91,  25.9 ,  27.89,  29.88,  31.88,
        33.87,  35.86,  37.85,  39.84,  41.84,  43.83,  45.82,  47.81,
        49.8 ,  51.8 ,  53.79,  55.78,  57.77,  59.77,  61.76,  63.75,
        65.74,  67.73,  69.73,  71.72,  73.71,  75.7 ,  77.7 ,  79.69,
        81.68,  83.67,  85.66,  87.66,  89.65,  91.64,  93.63,  95.62,
        97.62,  99.61, 101.6 , 103.59, 105.59, 107.58, 109.57, 111.56,
       113.55, 115.55, 117.54, 119.53, 121.52, 123.52, 125.51, 127.5 ,
       129.49, 131.48, 133.48, 135.47, 137.46, 139.45, 141.45, 143.44,
       145.43, 147.42, 149.41, 151.41, 153.4 , 155.39, 157.38, 159.38,
       161.37, 163.36, 165.35, 167.34, 169.34, 171.33, 173.32, 175.31,
       177.3 , 179.3 , 181.29, 183.28, 185.27, 187.27, 189.26, 191.25,
       193.24, 195.23, 197.23, 199.22, 201.21, 203.2 , 205.2 , 207.19,
       209.18, 211.17, 213.16, 215.16, 217.15, 219.14, 221.13, 223.12,
       225.12, 227.11, 229.1 , 231.09, 233.09, 235.08, 237.07, 239.06,
       241.05, 243.05, 245.04, 247.03, 249.02, 251.02, 253.01, 255.  ])
</pre></div>
</div>
</div>
</div>
<p>Check the numbers in these two arrays against the image above (of the bin intervals) to verify they are correct. To get the bin center points, we just take the average of each pair:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the center of each bin.</span>
<span class="n">bin_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">bin_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  1.  ,   2.99,   4.98,   6.97,   8.96,  10.96,  12.95,  14.94,
        16.93,  18.93,  20.92,  22.91,  24.9 ,  26.89,  28.89,  30.88,
        32.87,  34.86,  36.86,  38.85,  40.84,  42.83,  44.82,  46.82,
        48.81,  50.8 ,  52.79,  54.79,  56.78,  58.77,  60.76,  62.75,
        64.75,  66.74,  68.73,  70.72,  72.71,  74.71,  76.7 ,  78.69,
        80.68,  82.68,  84.67,  86.66,  88.65,  90.64,  92.64,  94.63,
        96.62,  98.61, 100.61, 102.6 , 104.59, 106.58, 108.57, 110.57,
       112.56, 114.55, 116.54, 118.54, 120.53, 122.52, 124.51, 126.5 ,
       128.5 , 130.49, 132.48, 134.47, 136.46, 138.46, 140.45, 142.44,
       144.43, 146.43, 148.42, 150.41, 152.4 , 154.39, 156.39, 158.38,
       160.37, 162.36, 164.36, 166.35, 168.34, 170.33, 172.32, 174.32,
       176.31, 178.3 , 180.29, 182.29, 184.28, 186.27, 188.26, 190.25,
       192.25, 194.24, 196.23, 198.22, 200.21, 202.21, 204.2 , 206.19,
       208.18, 210.18, 212.17, 214.16, 216.15, 218.14, 220.14, 222.13,
       224.12, 226.11, 228.11, 230.1 , 232.09, 234.08, 236.07, 238.07,
       240.06, 242.05, 244.04, 246.04, 248.03, 250.02, 252.01, 254.  ])
</pre></div>
</div>
</div>
</div>
<p>You’ll see that if we plot our bin centers (<span class="math notranslate nohighlight">\(x\)</span>-axis) and our counts (<span class="math notranslate nohighlight">\(y\)</span>-axis) we get something very much resembling the <code class="docutils literal notranslate"><span class="pre">camera</span></code> histogram, with 128 bins. Below the original <code class="docutils literal notranslate"><span class="pre">camera</span></code> histogram is shown on the left, and the plot of the <code class="docutils literal notranslate"><span class="pre">bin_centers</span></code> and <code class="docutils literal notranslate"><span class="pre">counts</span></code> arrays is shown on the right:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original `camera` histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bin Centers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Bin centers vs pixel counts&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/722783152dc9ef887b1aa7c68f82cc6cc4fe1b31bdce7f09d83c5db84be6d2a3.png" src="_images/722783152dc9ef887b1aa7c68f82cc6cc4fe1b31bdce7f09d83c5db84be6d2a3.png" />
</div>
</div>
<p>To implement the Otsu filter, we “split” the histogram into two sides, at a given bin center. We can think of this as creating two separate histograms. Here is a visualisation of splitting at the 50th bin center (which is centered on the pixel intensity value of 98.6):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The 50th bin center value.</span>
<span class="n">bin_centers</span><span class="p">[</span><span class="mi">49</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(98.61328125)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A function to visualise different threshold values.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_bins_with_threshold</span><span class="p">(</span><span class="n">threshold_bin_number</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">[:</span><span class="n">threshold_bin_number</span><span class="p">],</span> <span class="n">counts</span><span class="p">[:</span><span class="n">threshold_bin_number</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Left Side Histogram&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">:],</span> <span class="n">counts</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Right Side Histogram&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Threshold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bin Centers&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Threshold Pixel Intensity = </span><span class="si">{</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_number</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([]);</span>

<span class="c1"># Generate the plot.</span>
<span class="n">plot_bins_with_threshold</span><span class="p">(</span><span class="mi">49</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3829b3cdd9288415fb93e86bb18a7ef15378442f4d199673240617c1bf15b3ad.png" src="_images/3829b3cdd9288415fb93e86bb18a7ef15378442f4d199673240617c1bf15b3ad.png" />
</div>
</div>
<p>We now effectively have two histograms, the red one (below the 50th bin center; below a pixel intensity value of 98.6), and the green one (above the 50th bin center; above a pixel intensity value of 98.6).</p>
<p>We can choose any bin center for the threshold, in fact, the Otsu filtering process will compare all possible thresholds/splits, comparing all of the bin centers. Multiple different splits are visualised below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise multiple thresholds.</span>
<span class="n">n_threshold_plots</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold_bin_num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_threshold_plots</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plot_bins_with_threshold</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2aef6c7844de8a974cc5bc191f34c04f8accc1e597c2badf70b40c40c0295d99.png" src="_images/2aef6c7844de8a974cc5bc191f34c04f8accc1e597c2badf70b40c40c0295d99.png" />
</div>
</div>
<p>Once we have “split” the histogram, we calculate the mean of the pixel intensity values in the left-hand histogram, and the mean of the pixel intensity values in the right-hand histogram (e.g. either side of the split).</p>
<p>Then we calculate the sum of squared deviations (<code class="docutils literal notranslate"><span class="pre">ssd</span></code>) for each side of the histogram, each around its respective mean. This gives a metric of how “spread out” the values in each histogram are, around each mean.</p>
<p><em>It is this <code class="docutils literal notranslate"><span class="pre">ssd</span></code> metric which can allow us to select the “best” threshold; for giving distinct pixel classes…</em></p>
<p>The cell below defines a function which calculates the sum of the squared deviations, for a given histogram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">centers</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Sum of squared deviations from mean &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">centers</span> <span class="o">*</span> <span class="n">counts</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">ssd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts</span> <span class="o">*</span> <span class="p">((</span><span class="n">centers</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">ssd</span><span class="p">,</span> <span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use this function to calculate the mean and <code class="docutils literal notranslate"><span class="pre">ssd</span></code> of each histogram, when using the 50th bin center as the threshold:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The mean and SSD for the left hand histogram.</span>
<span class="n">mean_below_50th_bin</span><span class="p">,</span> <span class="n">ssd_below_50th_bin</span><span class="p">,</span> <span class="n">n_below_50th_bin</span>  <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[:</span><span class="mi">49</span><span class="p">],</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="mi">49</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of histogram below the 50th bin:&quot;</span><span class="p">,</span> <span class="n">mean_below_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SSD of histogram  below the 50th bin:&quot;</span><span class="p">,</span> <span class="n">ssd_below_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean of histogram below the 50th bin: 29.44
SSD of histogram  below the 50th bin: 27737445.29
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The mean and SSD for the right hand histogram.</span>
<span class="n">mean_above_50th_bin</span><span class="p">,</span> <span class="n">ssd_above_50th_bin</span><span class="p">,</span> <span class="n">n_above_50th_bin</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="mi">49</span><span class="p">:],</span> <span class="n">bin_centers</span><span class="p">[</span><span class="mi">49</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of histogram above the 50th bin:&quot;</span><span class="p">,</span> <span class="n">mean_above_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SSD of histogram above the 50th bin:&quot;</span><span class="p">,</span> <span class="n">ssd_above_50th_bin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean of histogram above the 50th bin: 175.33
SSD of histogram above the 50th bin: 174551091.73
</pre></div>
</div>
</div>
</div>
<p>The cell below defines a convenience plotting function, the mean of each histogram is shown on the plot, as a vertical line. A horizontal line around each mean indicates the spread around that mean (FYI this spread has been converted back to the original scale of the plot, rather than the squared value of the <code class="docutils literal notranslate"><span class="pre">ssd</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A convenience plotting function.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">plot_bins_with_threshold</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">)</span>
    
    <span class="c1"># Histogram 1</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span>
    <span class="n">mean_1</span><span class="p">,</span> <span class="n">ssd_1</span><span class="p">,</span> <span class="n">n_1</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[:</span><span class="n">threshold_bin_num</span><span class="p">],</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="n">threshold_bin_num</span><span class="p">])</span>
    <span class="n">std_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ssd_1</span><span class="o">/</span><span class="n">n_1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean and Spread (Left Histogram)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">mean_1</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std_1</span><span class="p">,</span> <span class="n">mean_1</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">)</span>
    
    <span class="c1"># Histogram 2</span>
    <span class="n">hist_number</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span>
    <span class="n">mean_2</span><span class="p">,</span> <span class="n">ssd_2</span><span class="p">,</span> <span class="n">n_2</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">threshold_bin_num</span><span class="p">:],</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_num</span><span class="p">:])</span>
    <span class="n">std_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ssd_2</span><span class="o">/</span><span class="n">n_2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean and Spread (Right Histogram)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">mean_2</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std_2</span><span class="p">,</span> <span class="n">mean_2</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="o">+</span><span class="n">color</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_total_SSD</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">total_SSD</span> <span class="o">=</span> <span class="n">ssd_1</span> <span class="o">+</span> <span class="n">ssd_2</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Threshold Pixel Intensity = </span><span class="si">{</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">threshold_bin_num</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">Total SSD: </span><span class="si">{</span><span class="n">total_SSD</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="c1"># Add both means to the plot.</span>
<span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="mi">49</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a61443511dc522eee83cc9c74797df36379f17e7d44d65a2853fefcfe759ea43.png" src="_images/a61443511dc522eee83cc9c74797df36379f17e7d44d65a2853fefcfe759ea43.png" />
</div>
</div>
<p>Different threshold values change the mean, as well as the spread (<code class="docutils literal notranslate"><span class="pre">ssd</span></code>) of each histogram. For each different split visualised below, pay attention to the width of the spread around each mean (e.g. the horizontal lines coming off the vertical line for each mean). This will let you see how the different splits influence the mean and the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> of each histogram, when we compare the left histogram vs right histogram, for a given split:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise multiple thresholds.</span>
<span class="n">n_threshold_plots</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold_bin_num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_threshold_plots</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Add both means to the plot.</span>
    <span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">threshold_bin_num</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">2</span> != 0:
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e93eea1369873c08f9e86dd5dc38b2c9139ef95658ef89bea5f357174909c96c.png" src="_images/e93eea1369873c08f9e86dd5dc38b2c9139ef95658ef89bea5f357174909c96c.png" />
</div>
</div>
<p>In Otsu’s method, we want to find the threshold value which gives the <em>minimum total <code class="docutils literal notranslate"><span class="pre">ssd</span></code></em> e.g. the smallest value of the combined spread when we add together the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> values for each histogram. This value corresponds to the <em>maximum between pixel class variance</em>, when comparing each side of the histogram.</p>
<p>In other words, the threshold value which gives the lowest combined <code class="docutils literal notranslate"><span class="pre">ssd</span></code> identifies two classes of pixels that are most different from each other, compared to other classes/splits we could choose, according the metrics that the Otsu method cares about.</p>
<p>You can think of it as finding a threshold which groups pixels such that the means of the groups are very different, and also that the pixel values in each side of the “split” are clustered closely around their respective mean, giving them a big separation from pixels in the other class.</p>
<p>The cell below will find the threshold which gives the minimum combined <code class="docutils literal notranslate"><span class="pre">ssd</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An empty list to store all the `ssd` values, for all bin centers.</span>
<span class="n">total_ssds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through the bin centers, compute the `ssd` of both</span>
<span class="c1"># histograms, for each threshold.</span>
<span class="k">for</span> <span class="n">bin_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">):</span>
    <span class="n">left_mean</span><span class="p">,</span> <span class="n">left_ssd</span><span class="p">,</span> <span class="n">left_n</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[:</span><span class="n">bin_no</span><span class="p">],</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="n">bin_no</span><span class="p">])</span>
    <span class="n">right_mean</span><span class="p">,</span> <span class="n">right_ssd</span><span class="p">,</span> <span class="n">right_n</span> <span class="o">=</span> <span class="n">ssd</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">bin_no</span><span class="p">:],</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">bin_no</span><span class="p">:])</span>
    
    <span class="c1"># Calculate and store the total `ssd`, for the current threshold.</span>
    <span class="n">total_ssds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_ssd</span> <span class="o">+</span> <span class="n">right_ssd</span><span class="p">)</span>
    
<span class="c1"># Find the threshold which gives the smallest `ssd`. This is the Otsu threshold.</span>
<span class="n">otsu_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">total_ssds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Otsu bin :&#39;</span><span class="p">,</span> <span class="n">otsu_bin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Otsu threshold:&#39;</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">otsu_bin</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Otsu bin : 51
Otsu threshold: 102.59765625
</pre></div>
</div>
</div>
</div>
<p>We can see that this is the same Otsu threshold we get from <code class="docutils literal notranslate"><span class="pre">ski.filters.threshold_otsu()</span></code>, when we use the same number of bins (128).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the number of bins.</span>
<span class="n">n_bins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>128
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the Otsu threshold from `skimage`.</span>
<span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">threshold_otsu</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span>
                           <span class="n">nbins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(102)
</pre></div>
</div>
</div>
</div>
<p>Here is the graph showing the Otsu threshold, the total <code class="docutils literal notranslate"><span class="pre">ssd</span></code> is shown, in scientific notation, in the title of the plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">otsu_bin</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3745e22181aed9627d24517a334f2ea5614120a41affd093dbfb9b66c0033cc5.png" src="_images/3745e22181aed9627d24517a334f2ea5614120a41affd093dbfb9b66c0033cc5.png" />
</div>
</div>
<p>This is an order of magnitude smaller than for some possible other threshold values, e.g. we show a different threshold below, which has a much larger total <code class="docutils literal notranslate"><span class="pre">ssd</span></code>, again, the total <code class="docutils literal notranslate"><span class="pre">ssd</span></code> is shown in the title of the plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A much worse split.</span>
<span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b7495be4e8c2af1bbe5f100a39f1de7eb34a690df87a497b674a1d560168206e.png" src="_images/b7495be4e8c2af1bbe5f100a39f1de7eb34a690df87a497b674a1d560168206e.png" />
</div>
</div>
<p>Compare the spreads on each plot by looking at the horizontal lines around the mean of each histogram. You can see that the spreads are much smaller for the Otsu threshold, than for the other (much worse!) threshold. The other threshold, because it has much worse between pixel-class variance than the Otsu threshold, gives much worse image segmentation, in terms of separating foreground from background:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A bad segmentation, from the worse threshold value...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span> <span class="o">&lt;</span> <span class="n">bin_centers</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b73516cee0c7fcafe338bb45e2efa0f670277fde40e6eb029cb089b79a940310.png" src="_images/b73516cee0c7fcafe338bb45e2efa0f670277fde40e6eb029cb089b79a940310.png" />
</div>
</div>
<p>Admittedly that is quite a cool visual effect, but it is poor segmentation performance.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ssd</span></code>s for multiple different thresholds are shown in the title of each plot below; the <code class="docutils literal notranslate"><span class="pre">camera</span></code> image filtered to the same threshold is shown to the right of each histogram plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise multiple thresholds, as well as filtering `camera` using those thresholds.</span>
<span class="n">n_threshold_plots</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_threshold_plots</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span> <span class="o">&lt;</span> <span class="n">bin_centers</span><span class="p">[</span><span class="n">thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Threshold Pixel Intensity: </span><span class="si">{</span><span class="n">bin_centers</span><span class="p">[</span><span class="n">thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/25d1ce9724e1b5b26a5b3ba3d1ea21d0b700305d85ce43dbe8eb8293f0164ab0.png" src="_images/25d1ce9724e1b5b26a5b3ba3d1ea21d0b700305d85ce43dbe8eb8293f0164ab0.png" />
</div>
</div>
<p>Remember: Otsu’s method finds the threshold which gives us the smallest <em>sum of the <code class="docutils literal notranslate"><span class="pre">ssd</span></code> values</em>, with one value from each histogram. This corresponds to the <em>maximum variance between the two histograms</em> e.g. it finds the most distinct two classes of pixels that we can divide the image into, based on this metric.</p>
<p>Compare the segmentation of the “best” Otsu threshold (shown below) to the poorer-performing thresholds shown on the right of the plot above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show a plot of the whole Otsu filtering process.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_thresh_mean_and_spread</span><span class="p">(</span><span class="n">otsu_bin</span><span class="p">,</span> <span class="n">show_total_SSD</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_otsu_filtered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Otsu filtered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0ab2a5b32d88dc388915a0d529e5eb5813f3c9f38859c5ba53fce278fefb727d.png" src="_images/0ab2a5b32d88dc388915a0d529e5eb5813f3c9f38859c5ba53fce278fefb727d.png" />
</div>
</div>
<p>To recap, <a class="reference external" href="http://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=4310076">Otsu’s method</a> proceeds like this:</p>
<ul>
<li><p>create the 1D histogram of image values, where the histogram has <span class="math notranslate nohighlight">\(L\)</span> bins.
The histogram is <span class="math notranslate nohighlight">\(L\)</span> bin counts <span class="math notranslate nohighlight">\(\vec{c} = [c_1, c_2, ... c_L]\)</span>, where <span class="math notranslate nohighlight">\(c_i\)</span>
is the number of values falling in bin <span class="math notranslate nohighlight">\(i\)</span>.  The histogram has bin centers
<span class="math notranslate nohighlight">\(\vec{v} = [v_1, v_2, ..., v_L]\)</span>, where <span class="math notranslate nohighlight">\(v_i\)</span> is the image value
corresponding to the center of bin <span class="math notranslate nohighlight">\(i\)</span>;</p></li>
<li><p>for every bin number <span class="math notranslate nohighlight">\(k \in [1, 2, 3, ..., L-1]\)</span>, divide the histogram at
that bin to form a <em>left histogram</em> and a <em>right histogram</em>, where the left
histogram has counts, centers <span class="math notranslate nohighlight">\([c_1, ... c_k], [v_1, ... v_k]\)</span>, and the
right histogram has counts, centers <span class="math notranslate nohighlight">\([c_{k+1} ... c_L], [v_{k+1} .. v_L]\)</span>;</p></li>
<li><p>calculate the mean corresponding to the values in the left and right
histogram:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  n_k^{left} = \sum_{i=1}^{k} c_i \\
  \mu_k^{left} = \frac{1}{n_k^{left}} \sum_{i=1}^{k} c_i v_i \\
  n_k^{right} = \sum_{i={k+1}}^{L} c_i \\
  \mu_k^{right} = \frac{1}{n_k^{right}} \sum_{i={k+1}}^{L} c_i v_i
  \end{split}\]</div>
</li>
<li><p>calculate the sum of squared deviations from the left and right means:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \mathrm{SSD}_k^{left} = \sum_{i=1}^{k} c_i (v_i - \mu_k^{left}) \\
  \mathrm{SSD}_k^{right} = \sum_{i={k+1}}^{L} c_i (v_i - \mu_k^{right}) \\
  \mathrm{SSD}_k^{total} = SSD_k^{left} + SSD_k^{right}
  \end{split}\]</div>
</li>
<li><p>find the bin number <span class="math notranslate nohighlight">\(k\)</span> that minimizes <span class="math notranslate nohighlight">\(\mathrm{SSD}_k^{total}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  z = \mathrm{argmin}_k \mathrm{SSD}_k^{total}
  \]</div>
</li>
<li><p>the binarizing threshold for the image is the value corresponding to this
bin <span class="math notranslate nohighlight">\(z\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  t = v_z
  \]</div>
</li>
</ul>
<div class="exercise dropdown admonition" id="triple-cam">

<p class="admonition-title"><span class="caption-number">Exercise 19 </span></p>
<section id="exercise-content">
<p>Your task now is to split <code class="docutils literal notranslate"><span class="pre">camera</span></code> into <em>three distinct pixel classes</em>, using threshold filtering. Here is your target image:</p>
<p><img alt="" src="_images/camera_3_regions.png" /></p>
<p>Roughly, in the target image, the sky has white pixels, the ground has grey pixels and the cameraman’s body has black pixels. Your final image should contain only the following <code class="docutils literal notranslate"><span class="pre">np.unique()</span></code> values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>You can use a “by eye” method to decide your thresholds, from inspecting a histogram of <code class="docutils literal notranslate"><span class="pre">camera</span></code>. Or you can investigate using the <code class="docutils literal notranslate"><span class="pre">skimage</span></code> Otsu filter to get thresholds for more than two pixel classes…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="4_filters-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#triple-cam"> Exercise 19</a></p>
<section id="solution-content">
<p>Inspecting the histogram by eye can get you quite far here. First, we plot the histogram of <code class="docutils literal notranslate"><span class="pre">camera</span></code>. We roughly indentify low frequency regions which separate the modes of the distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram, and estimate, by eye thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;By eye threshold 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;By eye threshold 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0bf83535ec64b1fd0ec9c3ee7da4ebc4fa8f2b6143f3ccfb0c04fdf998bcaf42.png" src="_images/0bf83535ec64b1fd0ec9c3ee7da4ebc4fa8f2b6143f3ccfb0c04fdf998bcaf42.png" />
</div>
</div>
<p>We chose 80 and 190, but you could get similar results with other nearby values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save our estimated thresholds as separate variables.</span>
<span class="n">by_eye_1</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">by_eye_2</span> <span class="o">=</span> <span class="mi">190</span>
</pre></div>
</div>
</div>
</div>
<p>We then use some Boolean indexing to:</p>
<ul class="simple">
<li><p>Set values to the left of the lower threshold to 0.</p></li>
<li><p>Set values in between the thresholds to 1.</p></li>
<li><p>Set values to the right of the higher threshold to 2.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy to avoid overwriting.</span>
<span class="n">camera_region_solution</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Set values to the left of the lower threshold to 0.</span>
<span class="n">camera_region_solution</span><span class="p">[</span><span class="n">camera_region_solution</span> <span class="o">&lt;</span> <span class="n">by_eye_1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Set values in between the thresholds to 1.</span>
<span class="n">camera_region_solution</span><span class="p">[(</span><span class="n">camera_region_solution</span> <span class="o">&gt;=</span> <span class="n">by_eye_1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera_region_solution</span> <span class="o">&lt;=</span> <span class="n">by_eye_2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Set values to the right of the higher threshold to 2.</span>
<span class="n">camera_region_solution</span><span class="p">[</span><span class="n">camera_region_solution</span> <span class="o">&gt;</span> <span class="n">by_eye_2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_region_solution</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3e11416f062c86f48efa6ac02b3e109d4a1d1d19c4bcb9a31addfae1793b0bd7.png" src="_images/3e11416f062c86f48efa6ac02b3e109d4a1d1d19c4bcb9a31addfae1793b0bd7.png" />
</div>
</div>
<p>That gets us pretty close to the target image!</p>
<p>A less “back of the envelope” method is to use <code class="docutils literal notranslate"><span class="pre">ski.filters.threshold_multiotsu()</span></code> which is an adjustment of the Otsu method which, you guessed it, allows us to “split” a histogram into more than two parts.</p>
<p>The syntax is very straightforward, and the function returns a list of the threshold values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multi-Otsu filter.</span>
<span class="n">otsu_cam3_solution</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">threshold_multiotsu</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> 
                                                     <span class="n">classes</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># How many pixel classes?</span>
<span class="c1"># Show the thresholds.</span>
<span class="n">otsu_cam3_solution</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 87, 176])
</pre></div>
</div>
</div>
</div>
<p>We plot the thresholds below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram, and the Multi-Otsu thresholds.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multi-Otsu Threshold 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multi-Otsu Threshold 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel Intensity Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1c06309ee2feebff082d7df4b35298eb985525731aaf74cc5978dc6dca2c0924.png" src="_images/1c06309ee2feebff082d7df4b35298eb985525731aaf74cc5978dc6dca2c0924.png" />
</div>
</div>
<p>We can use Boolean indexing (as above) to set the pixel values according to the thresholds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy to avoid overwriting.</span>
<span class="n">camera_region_solution_multiotsu</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Set values to the left of the lower threshold to 0.</span>
<span class="n">camera_region_solution_multiotsu</span><span class="p">[</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&lt;</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Set values in between the thresholds to 1.</span>
<span class="n">camera_region_solution_multiotsu</span><span class="p">[(</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&gt;=</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&lt;=</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Set values to the right of the higher threshold to 2.</span>
<span class="n">camera_region_solution_multiotsu</span><span class="p">[</span><span class="n">camera_region_solution_multiotsu</span> <span class="o">&gt;</span> <span class="n">otsu_cam3_solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera_region_solution_multiotsu</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/50448f50c25f65a94d5f38e8be050b3fdbdc4d7bf39eb6281f3bbd3e7ba084bf.png" src="_images/50448f50c25f65a94d5f38e8be050b3fdbdc4d7bf39eb6281f3bbd3e7ba084bf.png" />
</div>
</div>
<p>A more elegant, slightly hacky way, suggested in the <code class="docutils literal notranslate"><span class="pre">skimage</span></code> documentation is to use <code class="docutils literal notranslate"><span class="pre">np.digitize()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cam3_regions_hack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> 
                           <span class="n">bins</span><span class="o">=</span><span class="n">otsu_cam3_solution</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cam3_regions_hack</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5d0a0bfd285198bd6b9d3c5498b00ce10597f89b056f857d2b3b23d1f0512365.png" src="_images/5d0a0bfd285198bd6b9d3c5498b00ce10597f89b056f857d2b3b23d1f0512365.png" />
</div>
</div>
</section>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="kernels-and-pixel-neighbourhoods">
<h1>Kernels and pixel neighbourhoods<a class="headerlink" href="#kernels-and-pixel-neighbourhoods" title="Link to this heading">#</a></h1>
<p>In the section above we have filtered images based on a single value (e.g. a threshold). Other filters work differently. They work by adjusting a given pixel’s value <em>based on the value of other pixels in the array</em>, such that each pixel can be subject to a different change in its value, depending of the value of other pixels. The mean filter is one such filter that works this way.</p>
<p>The mean filter is a <em>local filter</em>. This entails that it alters a given pixels value based on the values of other pixels in the surrounding “neighborhood”. The <code class="docutils literal notranslate"><span class="pre">size</span></code> and <code class="docutils literal notranslate"><span class="pre">shape</span></code> of the “neighborhood” are up to the user. We can refer to the neighborhood as a “kernel”, “footprint” or “structuring element”. As we will see later, Sci-kit image favours the term “footprint”. For now, we will use the terms “kernel” and “neighborhood” interchangably to refer to some set of pixels that surround a given pixel.</p>
<p>The mean filter, as the name suggests, <em>averages</em> the pixel values within a kernel/neighbourhood. To see this in action, let’s build a simple mean filter to filter our <code class="docutils literal notranslate"><span class="pre">random_i</span></code> image array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the `random_i` array.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">random_i</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0 0 0 0 0 0 0 0]
 [0 0 0 4 8 0 0 0]
 [0 0 0 3 8 0 0 0]
 [0 0 0 0 0 0 0 0]
 [0 0 0 4 5 0 0 0]
 [0 0 0 3 4 0 0 0]
 [0 0 0 3 5 0 0 0]
 [0 0 0 3 9 0 0 0]
 [0 0 0 7 6 0 0 0]
 [0 0 0 0 0 0 0 0]]
</pre></div>
</div>
<img alt="_images/1152ca9ff91544f0e95d3a57714c45c188bc7a30e93201c9188eb5d12e49343e.png" src="_images/1152ca9ff91544f0e95d3a57714c45c188bc7a30e93201c9188eb5d12e49343e.png" />
</div>
</div>
<p>Let’s use some indexing to go for a walk through the neighbourhoods (kernels) in this array. We will treat each <code class="docutils literal notranslate"><span class="pre">(3,3)</span></code> set of pixels as a separate neighbourhood. For now, we only walk through the neighborhoods at the “top” of the array. We will start our “walk” in the top left corner of the array, so that each 3-by-3 slice is centered on a pixel in the second row of the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The first neighbourhood.</span>
<span class="n">i_row_start</span><span class="p">,</span> <span class="n">i_col_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_end</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">random_i</span><span class="p">[</span><span class="n">i_row_start</span><span class="p">:</span><span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_start</span><span class="p">:</span><span class="n">i_col_end</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 0, 0],
       [0, 0, 0],
       [0, 0, 0]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second neighbourhood.</span>
<span class="n">i_row_start</span><span class="p">,</span> <span class="n">i_col_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_end</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">random_i</span><span class="p">[</span><span class="n">i_row_start</span><span class="p">:</span><span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_start</span><span class="p">:</span><span class="n">i_col_end</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 0, 0],
       [0, 0, 4],
       [0, 0, 3]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The third neighbourhood.</span>
<span class="n">i_row_start</span><span class="p">,</span> <span class="n">i_col_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_end</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span>
<span class="n">random_i</span><span class="p">[</span><span class="n">i_row_start</span><span class="p">:</span><span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_start</span><span class="p">:</span><span class="n">i_col_end</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 0, 0],
       [4, 8, 0],
       [3, 8, 0]])
</pre></div>
</div>
</div>
</div>
<p>Obviously, this “walk” is more efficient in a for loop:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">i_row_start</span><span class="p">,</span> <span class="n">i_col_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span>
    <span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_end</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">3</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">random_i[</span><span class="si">{</span><span class="n">i_row_start</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">i_row_end</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">i_col_start</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">i_col_end</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">random_i</span><span class="p">[</span><span class="n">i_row_start</span><span class="p">:</span><span class="n">i_row_end</span><span class="p">,</span> <span class="n">i_col_start</span><span class="p">:</span><span class="n">i_col_end</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>random_i[0:3, 0:3]

[[0 0 0]
 [0 0 0]
 [0 0 0]]

random_i[0:3, 1:4]

[[0 0 0]
 [0 0 4]
 [0 0 3]]

random_i[0:3, 2:5]

[[0 0 0]
 [0 4 8]
 [0 3 8]]

random_i[0:3, 3:6]

[[0 0 0]
 [4 8 0]
 [3 8 0]]

random_i[0:3, 4:7]

[[0 0 0]
 [8 0 0]
 [8 0 0]]

random_i[0:3, 5:8]

[[0 0 0]
 [0 0 0]
 [0 0 0]]
</pre></div>
</div>
</div>
</div>
<p>We can visualise the “walk” we have just taken, with prettier graphics::</p>
<p><img alt="" src="_images/kernel_1.png" /></p>
<p>Now, imagine we take mean within each neighbourhood (kernel) - the mean of each kernel is shown below the image of each indexing operation:</p>
<p><img alt="" src="_images/kernel_2_mean.png" /></p>
<p>…and now further imagine that we replace <em>central pixel value of the 3-by-3 kernel with the mean of all the values in the kernel</em>. The image below shows the central value being replaced with the mean of each kernel:</p>
<p><img alt="" src="_images/kernel_3_replace_central_pixel.png" /></p>
<p>This is how the mean filter operates:</p>
<ul class="simple">
<li><p>We define our kernel (e.g. our pixel neighborhood size and shape).</p></li>
<li><p>We center our kernel on a pixel.</p></li>
<li><p>We then replace the value of the central pixel with the mean of the pixels in the neighborhood.</p></li>
</ul>
<p>The illustrations above only show the kernel proceeding through the pixels at the “top” of the array. In reality, filtering operations are applied every pixel in the image. You can think of this as the kernel “walking” through the entire array, being centered on one pixel at a time.</p>
<p>Astute readers might ask “what happens near the edges of the array? If we center our kernel on a pixel in the last column or row, won’t part of the kernel ‘fall off’ the edge of the array?’”:</p>
<p><img alt="" src="_images/kernel_hit_the_edge.png" /></p>
<p>Indeed, we need a strategy for this. There are actually many options for how a kernel should behave at the edges of an image array - we could “pad” the kernel elements that fall outside of the image with 0 values, for instance. Or we could duplicate values from the pixels at the edge of the array, to fill in kernel elements that fall outside of the array.</p>
<p><strong>For now we will not worry about the edges, we just use the kernel only where it “fits” within the array.</strong> In effect, this just ignores pixels near the edges of the image. Presently, most of these pixels at the edges of the image are 0, and there is some distance between the “i” and the image edges, so ignoring the pixels near the edge will not affect the “i” shape too much itself. The image below illustrates this concept, for a generic array:</p>
<p><img alt="" src="_images/kernel_general.png" /></p>
<p>The cell below defines a function that will apply this mean kernel, step-by-step in a for loop to the whole image array, only for pixel neighbourhoods where the kernel “fits” over the central pixel, without extending outside of the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A function to apply our crude mean kernel.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">three_by_three_mean_kernel</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    
    <span class="c1"># Convert to float `dtype`.</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 
                     <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="c1"># Get the image shape.</span>
    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Create an empty image array (for the result of the</span>
    <span class="c1"># filtering operation)</span>
    <span class="n">filtered_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="c1"># Loop through the pixels and get the mean of each kernel.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">row_start</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">col_start</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">row_end</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span>
            <span class="n">col_end</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">2</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">row_start</span><span class="p">:</span><span class="n">row_end</span><span class="p">,</span> <span class="n">col_start</span><span class="p">:</span><span class="n">col_end</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">filtered_image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>           
    <span class="k">return</span> <span class="n">filtered_image</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s apply our crude mean filter to the image array, and compare it to the original image array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply our mean filtering function.</span>
<span class="n">mean_filtered_i</span> <span class="o">=</span> <span class="n">three_by_three_mean_kernel</span><span class="p">(</span><span class="n">random_i</span><span class="p">)</span>

<span class="c1"># Show the original array and the filtered array, from the </span>
<span class="c1"># &quot;raw&quot; NumPy perspective.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">random_i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Crude Mean filter:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">mean_filtered_i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Plot both arrays/</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">random_i</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean_filtered_i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Crude Mean Filter&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original:

 [[0 0 0 0 0 0 0 0]
 [0 0 0 4 8 0 0 0]
 [0 0 0 3 8 0 0 0]
 [0 0 0 0 0 0 0 0]
 [0 0 0 4 5 0 0 0]
 [0 0 0 3 4 0 0 0]
 [0 0 0 3 5 0 0 0]
 [0 0 0 3 9 0 0 0]
 [0 0 0 7 6 0 0 0]
 [0 0 0 0 0 0 0 0]]

Crude Mean filter:

 [[0.   0.   0.   0.   0.   0.   0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.22 2.22 1.44 0.   0.  ]
 [0.   0.   0.78 1.78 1.78 1.   0.   0.  ]
 [0.   0.   1.11 2.67 2.67 1.56 0.   0.  ]
 [0.   0.   1.   3.   3.   2.   0.   0.  ]
 [0.   0.   1.44 3.67 3.67 2.22 0.   0.  ]
 [0.   0.   1.11 2.78 2.78 1.67 0.   0.  ]
 [0.   0.   0.   0.   0.   0.   0.   0.  ]]
</pre></div>
</div>
<img alt="_images/50026590c5deea7fee1ddb540d9c6e0369535698b6cb1da3b4a30414381bda4d.png" src="_images/50026590c5deea7fee1ddb540d9c6e0369535698b6cb1da3b4a30414381bda4d.png" />
</div>
</div>
<p>Ok, so we can see that some of the non-black (non-zero) pixel intensity values have been “spread around” to neighbouring pixels, which is unsurprising, given what we know about how this operation works. We have literally, for each given pixel, “averaged out” between the pixels in the 3-by-3 neighbourhood around the pixel. This is a very crude mean filter, intended to show the foundational principles of how filtering via a kernel works. There is a better, less crude way to implement a mean filter, however, to which we will turn in the next section.</p>
<div class="exercise dropdown admonition" id="dont-be-mean">

<p class="admonition-title"><span class="caption-number">Exercise 20 </span></p>
<section id="exercise-content">
<p>For this exercise, you should build a function which filters an image using a 3-by-3 kernel, like we did above. Your function should “walk” the 3-by-3 kernel through an image array, but it can ignore edge pixels, as we did above. E.g. you can just alter central pixels where the kernel “fits”, as in the image below:</p>
<p><img alt="" src="_images/kernel_general_resize.png" /></p>
<p>However, your kernel should do something different to the mean kernel we implemented earlier. Your function will do something dark, something illegal (at least by the standards of <code class="docutils literal notranslate"><span class="pre">skimage</span></code> <code class="docutils literal notranslate"><span class="pre">dtype</span></code> conventions)…</p>
<p>It should replace the central pixel value the <em>negative sum</em> of the values under the kernel (e.g. add the values under the kernel up, and then make the sum negative). You should apply this to the <code class="docutils literal notranslate"><span class="pre">coins</span></code> image from <code class="docutils literal notranslate"><span class="pre">ski.data</span></code>. Here is the original image:</p>
<p><img alt="" src="_images/coins.png" /></p>
<p>Here is how your image should look, after applying the negative sum filter, with a 3-by-3 kernel:</p>
<p><img alt="" src="_images/neg_sum_coins.png" /></p>
<p>This operation will create some illegal pixel values. You should <code class="docutils literal notranslate"><span class="pre">rescale_intensity()</span></code> to ensure your image has the follow (legal!) attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: float64
Shape: (303, 384)
Max Pixel Value: 1.0
Min Pixel Value: -1.0
</pre></div>
</div>
<p><strong>DO NOT ADJUST ANY OF THE FUNCTIONS USED ABOVE WHEN MAKING YOUR FUNCTION</strong>. Try to do this from scratch, clearly thinking about what you need to do.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="k">def</span><span class="w"> </span><span class="nf">three_by_three_negative_sum_kernel</span><span class="p">():</span>
    <span class="o">...</span>

<span class="c1"># Load in the `coins` image.</span>
<span class="n">coins</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">coins</span><span class="p">()</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coins</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: uint8
Shape: (303, 384)
Max Pixel Value: 252
Min Pixel Value: 1
</pre></div>
</div>
<img alt="_images/1ef7d12bf838d39be8c34c734089186eff5a3b2f564d0aeabf3d4552970011e6.png" src="_images/1ef7d12bf838d39be8c34c734089186eff5a3b2f564d0aeabf3d4552970011e6.png" />
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="4_filters-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#dont-be-mean"> Exercise 20</a></p>
<section id="solution-content">
<p>Whilst we told you not to adjust the function from above, obviously you function needs to do something similar to the function from above. So that was a rule for you, not for us ;)</p>
<p>Here we have adjusted the function to take the negative sum of the kernel elements, rather than the mean. We also <code class="docutils literal notranslate"><span class="pre">rescale_intensity()</span></code> in the final line, to ensure pixel values fall in a legal range, for the <code class="docutils literal notranslate"><span class="pre">float64</span></code> <code class="docutils literal notranslate"><span class="pre">dtype</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">three_by_three_negative_sum_kernel_solution</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    
    <span class="c1"># Convert to float `dtype`.</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 
                     <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="c1"># Get the image shape.</span>
    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Create an empty image array (for the result of the</span>
    <span class="c1"># filtering operation)</span>
    <span class="n">filtered_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="c1"># Loop through the pixels and get the mean of each kernel.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">row_start</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">col_start</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">row_end</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span>
            <span class="n">col_end</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">2</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">row_start</span><span class="p">:</span><span class="n">row_end</span><span class="p">,</span> <span class="n">col_start</span><span class="p">:</span><span class="n">col_end</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">filtered_image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>                          <span class="c1"># LOOK HERE! We take the negative sum.</span>
    <span class="k">return</span> <span class="n">ski</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">rescale_intensity</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">,</span> <span class="n">out_range</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span> <span class="c1"># Rescale to ensure legal pixel values.</span>
</pre></div>
</div>
</div>
</div>
<p>Here we load in the <code class="docutils literal notranslate"><span class="pre">coins</span></code> image, to which to apply our new filter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in and show the `coins` image.</span>
<span class="n">coins_solution</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">coins</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coins_solution</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1ef7d12bf838d39be8c34c734089186eff5a3b2f564d0aeabf3d4552970011e6.png" src="_images/1ef7d12bf838d39be8c34c734089186eff5a3b2f564d0aeabf3d4552970011e6.png" />
</div>
</div>
<p>We then apply our filter, replacing the value of the central pixel in each kernel with negative sum of the value of all the pixels under the kernel:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter and show...</span>
<span class="n">neg_sum_filter_coins</span> <span class="o">=</span> <span class="n">three_by_three_negative_sum_kernel_solution</span><span class="p">(</span><span class="n">coins_solution</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">neg_sum_filter_coins</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/32c7345206f45fdddcd31c39a60d52cb5ba99e17f2559ac2f586004d32d9c6e9.png" src="_images/32c7345206f45fdddcd31c39a60d52cb5ba99e17f2559ac2f586004d32d9c6e9.png" />
</div>
</div>
<p>Here are the attributes of the somewhat ghostly, filtered image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_attributes</span><span class="p">(</span><span class="n">neg_sum_filter_coins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: float64
Shape: (303, 384)
Max Pixel Value: 1.0
Min Pixel Value: -1.0
</pre></div>
</div>
</div>
</div>
</section>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="convolution">
<h1>Convolution<a class="headerlink" href="#convolution" title="Link to this heading">#</a></h1>
<p>In normal practice, filtering operations which use kernels rely on <a class="reference external" href="https://en.wikipedia.org/wiki/Convolution">convolution</a>. In fact, one name for the kernel is “convolution kernel”. In image processing, convolution is similar to the process we saw with our crude mean filter - we “walk” a kernal across our whole image, centering it on every pixel, and perform a computation which modifies the central pixel based on the other values in the kernal/neightbourhood.</p>
<p>Let’s implement a true mean filter, using convolution. Obviously, we start with our kernel. First, we define its shape:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define our kernel shape.</span>
<span class="n">kernel_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can take the product of the elements in the shape tuple, to get the number of elements inside the kernel (in this case 3 * 3 = 9, so 9 elements in the 3-by-3 kernel):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get our kernel size, e.g. the number of elements in the kernel.</span>
<span class="n">kernel_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">kernel_shape</span><span class="p">)</span>

<span class="n">kernel_size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(9)
</pre></div>
</div>
</div>
</div>
<p>We can then construct our kernel, using <code class="docutils literal notranslate"><span class="pre">np.full()</span></code> which allows to fill an array with a given value. In this case we will fill it with <span class="math notranslate nohighlight">\(\frac{1}{n}\)</span>, where <span class="math notranslate nohighlight">\(n\)</span> is the number of elements in our kernel (9 kenerl elements - so <span class="math notranslate nohighlight">\(\frac{1}{9}\)</span> = 0.11):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">kernel_shape</span><span class="p">,</span> 
                      <span class="n">fill_value</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">kernel_size</span><span class="p">)</span>

<span class="n">mean_kernel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.11, 0.11, 0.11],
       [0.11, 0.11, 0.11],
       [0.11, 0.11, 0.11]])
</pre></div>
</div>
</div>
</div>
<p>Our purpose of here is to take the mean of the values under the kernel, so how does a 3-by-3 kernel filled with <span class="math notranslate nohighlight">\(\frac{1}{n}\)</span> help us?</p>
<p>Well, this value can be used to find the mean (duh!)…we’ll show this quickly using just four random values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">])</span>
<span class="n">nums</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(19.75)
</pre></div>
</div>
</div>
</div>
<p>If we multiply each value by <span class="math notranslate nohighlight">\(\frac{1}{n}\)</span> and then take the sum of those values, we get…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nums</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(19.75)
</pre></div>
</div>
</div>
</div>
<p>…the mean! And we can do exactly the same thing with the <code class="docutils literal notranslate"><span class="pre">mean_kernel</span></code> we made above. We can use the <code class="docutils literal notranslate"><span class="pre">scipy.ndimage.correlate()</span></code> function to achieve this with maximum efficiency (relative to the crude method we used above). This function involes <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.correlate.html">“moving a […] kernel over [an] image and computing the sum of products at each location”</a>. This means we:</p>
<ul class="simple">
<li><p>Centre the kernel on given array pixel in the original image.</p></li>
<li><p>Multiply the array pixel values covered by the kernel with the elements in the kernel (in this case every kernel element value is <span class="math notranslate nohighlight">\(\frac{1}{9}\)</span>).</p></li>
<li><p>Get the sum of those products (e.g. add them all together to produce a single value).</p></li>
<li><p>Replace the central array pixel value in the original image with the single value we just computed.</p></li>
</ul>
<p>Because we are using a mean kernel, this operation will, shockingly, return the mean of the kernel. This process is illustrated below for three kernel locations:</p>
<p><img alt="" src="_images/kernel_convolution_three_locs.png" /></p>
<p>Now, let’s apply this kernel convolution to every pixel in the image array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A new import.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ndi</span>

<span class="c1"># Perform the convolution.</span>
<span class="n">mean_filtered_random_i_via_sp</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">random_i</span><span class="p">,</span> <span class="c1"># Our input image array.</span>
                                              <span class="n">weights</span><span class="o">=</span><span class="n">mean_kernel</span><span class="p">,</span> <span class="c1"># Our kernel to convolve the image with.</span>
                                              <span class="n">output</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="c1"># Output `dtype`</span>

<span class="c1"># Show the original image array, and the mean filtered image array</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">random_i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean filter:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">mean_filtered_random_i_via_sp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">random_i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Filtered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean_filtered_random_i_via_sp</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original:

 [[0 0 0 0 0 0 0 0]
 [0 0 0 4 8 0 0 0]
 [0 0 0 3 8 0 0 0]
 [0 0 0 0 0 0 0 0]
 [0 0 0 4 5 0 0 0]
 [0 0 0 3 4 0 0 0]
 [0 0 0 3 5 0 0 0]
 [0 0 0 3 9 0 0 0]
 [0 0 0 7 6 0 0 0]
 [0 0 0 0 0 0 0 0]]

Mean filter:

 [[0.   0.   0.44 1.33 1.33 0.89 0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.22 2.22 1.44 0.   0.  ]
 [0.   0.   0.78 1.78 1.78 1.   0.   0.  ]
 [0.   0.   1.11 2.67 2.67 1.56 0.   0.  ]
 [0.   0.   1.   3.   3.   2.   0.   0.  ]
 [0.   0.   1.44 3.67 3.67 2.22 0.   0.  ]
 [0.   0.   1.11 2.78 2.78 1.67 0.   0.  ]
 [0.   0.   0.78 1.44 1.44 0.67 0.   0.  ]]
</pre></div>
</div>
<img alt="_images/c904f30d90b8ed776c737b17eba1db482eb589bd9ea934f088746bba7ef600b0.png" src="_images/c904f30d90b8ed776c737b17eba1db482eb589bd9ea934f088746bba7ef600b0.png" />
</div>
</div>
<p>The result is very similar to that obtained by our crude mean filter, only now it has been applied to <em>every</em> array pixel, where our crude filter simply ignored pixels at the edge of the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the result from our crude mean filter</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Crude mean filter:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">mean_filtered_i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Mean filter via SciPy `correlate`:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">mean_filtered_random_i_via_sp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Crude mean filter:

 [[0.   0.   0.   0.   0.   0.   0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.22 2.22 1.44 0.   0.  ]
 [0.   0.   0.78 1.78 1.78 1.   0.   0.  ]
 [0.   0.   1.11 2.67 2.67 1.56 0.   0.  ]
 [0.   0.   1.   3.   3.   2.   0.   0.  ]
 [0.   0.   1.44 3.67 3.67 2.22 0.   0.  ]
 [0.   0.   1.11 2.78 2.78 1.67 0.   0.  ]
 [0.   0.   0.   0.   0.   0.   0.   0.  ]]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean filter via SciPy `correlate`:

 [[0.   0.   0.44 1.33 1.33 0.89 0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.56 2.56 1.78 0.   0.  ]
 [0.   0.   0.78 2.22 2.22 1.44 0.   0.  ]
 [0.   0.   0.78 1.78 1.78 1.   0.   0.  ]
 [0.   0.   1.11 2.67 2.67 1.56 0.   0.  ]
 [0.   0.   1.   3.   3.   2.   0.   0.  ]
 [0.   0.   1.44 3.67 3.67 2.22 0.   0.  ]
 [0.   0.   1.11 2.78 2.78 1.67 0.   0.  ]
 [0.   0.   0.78 1.44 1.44 0.67 0.   0.  ]]
</pre></div>
</div>
</div>
</div>
<p>These two arrays are shown below side-by-side, and more nicely rendered, for easier comparison:</p>
<p><img alt="" src="_images/two_mean_filters.png" /></p>
<p>You can see that the values differ only near the top and bottom edges of the image. Let’s define a function so that we can apply the mean filter to any image, using the proper <code class="docutils literal notranslate"><span class="pre">scipy.ndimage.correlate()</span></code> machinery, so we no longer ignore edge pixels (poor pixels!):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mean_filter</span><span class="p">(</span><span class="n">image_array</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">):</span>
    <span class="n">kernel_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">kernel_shape</span><span class="p">)</span> <span class="c1"># Get the kernel size (n).</span>
    <span class="n">mean_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">kernel_shape</span><span class="p">,</span> <span class="c1"># Make the mean kernel in the desired shape... </span>
                          <span class="mi">1</span><span class="o">/</span><span class="n">kernel_size</span><span class="p">)</span><span class="c1"># ...each each element in the mean kernel is 1/n.</span>
    <span class="k">return</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">image_array</span><span class="p">,</span> 
                        <span class="n">mean_kernel</span><span class="p">,</span>
                        <span class="n">output</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll apply it to a greyscale <code class="docutils literal notranslate"><span class="pre">coffee</span></code> image, originally a colour image from <code class="docutils literal notranslate"><span class="pre">ski.data</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in an image file.</span>
<span class="n">coffee_grey</span> <span class="o">=</span>  <span class="n">ski</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;images/coffee_grey.png&quot;</span><span class="p">,</span> 
                             <span class="n">as_gray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_grey</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7ddae6566b3fbd8b9fe8a9b6a354930eaf301e110fdd7319f1f37a9809230d76.png" src="_images/7ddae6566b3fbd8b9fe8a9b6a354930eaf301e110fdd7319f1f37a9809230d76.png" />
</div>
</div>
<p>But first, we will use <code class="docutils literal notranslate"><span class="pre">np.random.normal()</span></code> to add some normally distributed (Gaussian) noise to the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add some noise to the pixel values in `coffee`.</span>
<span class="n">noisy_coffee_grey</span> <span class="o">=</span> <span class="n">coffee_grey</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                                   <span class="mi">2</span><span class="p">,</span>
                                                   <span class="n">coffee_grey</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_coffee_grey</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4dbc8bf6c98a80b2db3442028a461142fd7e08d445d242c2b37d1e32128f219c.png" src="_images/4dbc8bf6c98a80b2db3442028a461142fd7e08d445d242c2b37d1e32128f219c.png" />
</div>
</div>
<p>The mean filter can remove some of the noise, restoring the clarity of the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean filter the noisy coffee image, and show the result.</span>
<span class="n">noisy_coffee_grey_mean_filtered</span> <span class="o">=</span> <span class="n">mean_filter</span><span class="p">(</span><span class="n">noisy_coffee_grey</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_grey</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Noisy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_coffee_grey</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Filtered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_coffee_grey_mean_filtered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/50350f236bf46869695a425e8779fc419fd39d896071bf5e45e1dc3c80901699.png" src="_images/50350f236bf46869695a425e8779fc419fd39d896071bf5e45e1dc3c80901699.png" />
</div>
</div>
<p>We can see that the image is clearer, the noise has been reduced and some of the signal has been restored.</p>
<p>Let’s try out some different kernel sizes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean filter, with various kernel sizes.</span>
<span class="n">n_plots</span><span class="o">=</span><span class="mi">6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_plots</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">coffee_grey</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_plots</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Noisy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_coffee_grey</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_plots</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_plots</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">kernel_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mean Filtered</span><span class="se">\n</span><span class="s1">Kernel =(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean_filter</span><span class="p">(</span><span class="n">noisy_coffee_grey</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1996d8a886a2065a80e9a179f8fd9b0458f13fe03c469855157a1ee4714bfdcb.png" src="_images/1996d8a886a2065a80e9a179f8fd9b0458f13fe03c469855157a1ee4714bfdcb.png" />
</div>
</div>
<p>As with many filtering operations, the effect of altering aspects of the filtering process (like a threshold value or kernel size), is very context dependent. It may take many iterations before finding a “sweet spot”, and where the sweet spot is may be somewhat subjective.</p>
<div class="exercise dropdown admonition" id="strange-filter-coffee">

<p class="admonition-title"><span class="caption-number">Exercise 21 </span></p>
<section id="exercise-content">
<p>The nice thing about applying filtering via convolution kernels is that changing the kernel itself lets us implement a wide variety of functions, even strange ones. In this exercise, and you will write a function called <code class="docutils literal notranslate"><span class="pre">strange_filter()</span></code>. You should apply it to <code class="docutils literal notranslate"><span class="pre">coffe_grey</span></code> to produce the following image:</p>
<p><img alt="" src="_images/coffee_strange_kernel.png" /></p>
<p>For a given pixel value, when the value is multiplied by it’s corresponding kernel element, the <em>absolute</em> value of the result should be <em>half as big as the absolute original pixel value</em>.</p>
<p>Write your function so that it can be used with kernels of different <code class="docutils literal notranslate"><span class="pre">shape</span></code>s, so you can work out what kernel <code class="docutils literal notranslate"><span class="pre">shape</span></code> you need to recreate the target image, by trial and error.</p>
<p>Your final image should have the following attributes (again, you may need to <code class="docutils literal notranslate"><span class="pre">rescale_intensity()</span></code> or take other steps to avoid illegal pixel values, for the <code class="docutils literal notranslate"><span class="pre">dtype</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: int8
Shape: (579, 867)
Max Pixel Value: 0
Min Pixel Value: -49
</pre></div>
</div>
<p><strong>DO <em>NOT</em> COPY THE <code class="docutils literal notranslate"><span class="pre">mean_filter()</span></code> FUNCTION FROM ABOVE AND MODIFY IT</strong> - try to write a function from scratch, thinking carefully about what you need to do.</p>
<p><em>Hint:</em> run the <code class="docutils literal notranslate"><span class="pre">hint_strange_coffee()</span></code> function for additional help.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="n">strange_coffee</span> <span class="o">=</span> <span class="n">coffee_grey</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Show `strange_coffee`.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">strange_coffee</span><span class="p">)</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">strange_coffee</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: float64
Shape: (579, 867)
Max Pixel Value: 1.0
Min Pixel Value: 0.0
</pre></div>
</div>
<img alt="_images/7ddae6566b3fbd8b9fe8a9b6a354930eaf301e110fdd7319f1f37a9809230d76.png" src="_images/7ddae6566b3fbd8b9fe8a9b6a354930eaf301e110fdd7319f1f37a9809230d76.png" />
</div>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="4_filters-solution-5">

<p class="admonition-title">Solution to<a class="reference internal" href="#strange-filter-coffee"> Exercise 21</a></p>
<section id="solution-content">
<p>The solution here involves making a kernel where every kernel element has the value of <span class="math notranslate nohighlight">\(-\frac{1}{2}\)</span> (e.g. -0.5). So, for a 3-by-3 kernel:</p>
<p><img alt="" src="_images/strange_kernel.png" /></p>
<p>We define our <code class="docutils literal notranslate"><span class="pre">strange_filter()</span></code> function in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">strange_filter_solution</span><span class="p">(</span><span class="n">image_array</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">):</span>
    <span class="n">kernel_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">kernel_shape</span><span class="p">)</span>
    <span class="n">strange_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">kernel_shape</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">output_img</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">image_array</span><span class="p">,</span> 
                               <span class="n">strange_kernel</span><span class="p">,</span>
                               <span class="n">output</span><span class="o">=</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span> <span class="c1"># Avoid illegal pixel values.</span>
    <span class="k">return</span> <span class="n">output_img</span> 
</pre></div>
</div>
</div>
</div>
<p>To get the exact target image, we use a kernel of <code class="docutils literal notranslate"><span class="pre">shape</span></code> (10, 10):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the filter and show the result.</span>
<span class="n">strange_filter_coffee</span> <span class="o">=</span> <span class="n">strange_filter_solution</span><span class="p">(</span><span class="n">coffee_grey</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">strange_filter_coffee</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">strange_filter_coffee</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: int8
Shape: (579, 867)
Max Pixel Value: 0
Min Pixel Value: -49
</pre></div>
</div>
<img alt="_images/313159b981a444070781c04488af01aaab916498b1b1e01975bb7355fd0fecb8.png" src="_images/313159b981a444070781c04488af01aaab916498b1b1e01975bb7355fd0fecb8.png" />
</div>
</div>
<p>Kernels of other sizes will lead to different (albeit cool!) effects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the filter and show the result.</span>
<span class="n">strange_filter_coffee_other</span> <span class="o">=</span> <span class="n">strange_filter_solution</span><span class="p">(</span><span class="n">coffee_grey</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">strange_filter_coffee_other</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1c7fa1b43c7aa42ef642ae57cebbe2236deccffebb0af3005f5e81ad97a44769.png" src="_images/1c7fa1b43c7aa42ef642ae57cebbe2236deccffebb0af3005f5e81ad97a44769.png" />
</div>
</div>
<p>This is quite a strange kernel to apply! But it shows us how easy it is to achieve some radical filtering effects with some custom kernels…</p>
</section>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="mean-filtering-with-skimage">
<h1>Mean filtering with <code class="docutils literal notranslate"><span class="pre">skimage</span></code><a class="headerlink" href="#mean-filtering-with-skimage" title="Link to this heading">#</a></h1>
<p>We can implement a mean filter using the <code class="docutils literal notranslate"><span class="pre">ski.filters.rank.mean()</span></code> function. <code class="docutils literal notranslate"><span class="pre">skimage</span></code> prefers the term <code class="docutils literal notranslate"><span class="pre">footprint</span></code> to “kernel”, but the meaning is the same. We supply a small matrix with which to “walk” through the image, centring the kernel on every pixel, and modifying that central pixel’s value based on the values of the other pixels in it’s neighbourhood, with the size and shape of the neighbourhood being defined by the kernel (<code class="docutils literal notranslate"><span class="pre">footprint</span></code>).</p>
<p>Inspecting the <code class="docutils literal notranslate"><span class="pre">skimage</span></code> documentation will reveal that the format expected for the <code class="docutils literal notranslate"><span class="pre">footprint</span></code> should be <a class="reference external" href="https://scikit-image.org/docs/0.25.x/api/skimage.filters.rank.html#skimage.filters.rank.mean">“the [pixel] neighborhood expressed as an ndarray of 1’s and 0’s.”</a>. We will uses <code class="docutils literal notranslate"><span class="pre">np.ones()</span></code> to generate an array in this format. We use a <code class="docutils literal notranslate"><span class="pre">(9,9</span></code>) kernel to acheive a stronger visual effect:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A &quot;footprint&quot; (eg. kernel) to pass to `skimage`.</span>
<span class="n">footprint_9_by_9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

<span class="n">footprint_9_by_9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean filter the `camera` image with `skimage`</span>
<span class="n">mean_filtered_camera</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">rank</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span>
                                             <span class="n">footprint</span><span class="o">=</span><span class="n">footprint_9_by_9</span><span class="p">)</span>

<span class="c1"># Plot both image to compare</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean filtered</span><span class="se">\n</span><span class="s1">(9,9) kernel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean_filtered_camera</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ee1dbaf8337344c30df550190ea74b247ef3052b7d676cd183d398be584a4410.png" src="_images/ee1dbaf8337344c30df550190ea74b247ef3052b7d676cd183d398be584a4410.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="filtering-3d-images">
<h1>Filtering 3D images<a class="headerlink" href="#filtering-3d-images" title="Link to this heading">#</a></h1>
<p>We can filter a 3D colour image just by convolving our filtering kernel with each colour channel separately. Let’s load a 3D image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in and show an image.</span>
<span class="n">astronaut</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">()</span>
<span class="n">show_attributes</span><span class="p">(</span><span class="n">astronaut</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">astronaut</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type: &lt;class &#39;numpy.ndarray&#39;&gt;
dtype: uint8
Shape: (512, 512, 3)
Max Pixel Value: 255
Min Pixel Value: 0
</pre></div>
</div>
<img alt="_images/a755c145eece046bbf07270ba6c018131abde162a1e4514514907b84d2d9887a.png" src="_images/a755c145eece046bbf07270ba6c018131abde162a1e4514514907b84d2d9887a.png" />
</div>
</div>
<p>If we try to filter this image with our (3, 3) <code class="docutils literal notranslate"><span class="pre">mean_kernel</span></code> we will get an error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Oh dear.</span>
<span class="n">astronaut_mean_filtered</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">astronaut</span><span class="p">,</span> 
                                        <span class="n">weights</span><span class="o">=</span><span class="n">mean_kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Oh dear.</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">astronaut_mean_filtered</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">astronaut</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">3</span>                                         <span class="n">weights</span><span class="o">=</span><span class="n">mean_kernel</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python313\Lib\site-packages\scipy\ndimage\_filters.py:1373,</span> in <span class="ni">correlate</span><span class="nt">(input, weights, output, mode, cval, origin, axes)</span>
<span class="g g-Whitespace">   </span><span class="mi">1307</span> <span class="nd">@_ni_docstrings</span><span class="o">.</span><span class="n">docfiller</span>
<span class="g g-Whitespace">   </span><span class="mi">1308</span> <span class="k">def</span><span class="w"> </span><span class="nf">correlate</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1309</span>               <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1310</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1311</span><span class="sd">     Multidimensional correlation.</span>
<span class="g g-Whitespace">   </span><span class="mi">1312</span><span class="sd"> </span>
<span class="sd">   (...)   1371 </span>
<span class="g g-Whitespace">   </span><span class="mi">1372</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1373</span>     <span class="k">return</span> <span class="n">_correlate_or_convolve</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1374</span>                                   <span class="n">origin</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python313\Lib\site-packages\scipy\ndimage\_filters.py:1275,</span> in <span class="ni">_correlate_or_convolve</span><span class="nt">(input, weights, output, mode, cval, origin, convolution, axes)</span>
<span class="g g-Whitespace">   </span><span class="mi">1273</span> <span class="n">wshape</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span> <span class="k">if</span> <span class="n">ii</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1274</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wshape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">input</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1275</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weights.ndim (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">wshape</span><span class="p">)</span><span class="si">}</span><span class="s2">) must match &quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1276</span>                        <span class="sa">f</span><span class="s2">&quot;len(axes) (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1277</span> <span class="k">if</span> <span class="n">convolution</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1278</span>     <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">*</span> <span class="n">weights</span><span class="o">.</span><span class="n">ndim</span><span class="p">)]</span>

<span class="ne">RuntimeError</span>: weights.ndim (2) must match len(axes) (3)
</pre></div>
</div>
</div>
</div>
<p>As you can see, the error results from using a 2D kernel to filter a 3D image. A simple solution to this is just to apply the filter to each colour channel separately. This is done in the cell below, using a for loop to filter each channel, storing the channels separately in a dictionary, and then <code class="docutils literal notranslate"><span class="pre">np.stacking()</span></code> the individually filtered channels back into a 3D image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A dictionary to store the individually filtered channels.</span>
<span class="n">filtered_channels</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Loop through and filter each channel individually, store</span>
<span class="c1"># the results in the dictionary.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">astronaut</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">current_filtered_channel</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">astronaut</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">],</span>
                                             <span class="n">weights</span><span class="o">=</span><span class="n">mean_kernel</span><span class="p">)</span>
    <span class="n">filtered_channels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_filtered_channel</span>

<span class="c1"># Stack back to 3D.</span>
<span class="n">astronaut_mean_filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">filtered_channels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">filtered_channels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">filtered_channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> 
                                   <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">astronaut</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Mean Filtered </span><span class="se">\n</span><span class="s2"> (3, 3) kernel&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">astronaut_mean_filtered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>Scikit-image will handle this more efficiently, using a 3D kernel. Below we adjust our <code class="docutils literal notranslate"><span class="pre">footprint_9_by_9</span></code> kernel by <code class="docutils literal notranslate"><span class="pre">np.stack()</span></code>-ing it into 3D:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The original kernel we used for 2D mean filtering, in `skimage`.</span>
<span class="n">footprint_9_by_9</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stack to 3D.</span>
<span class="n">footprint_9_by_9_3D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">footprint_9_by_9</span><span class="p">,</span>
                                <span class="n">footprint_9_by_9</span><span class="p">,</span>
                                <span class="n">footprint_9_by_9</span><span class="p">],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">footprint_9_by_9_3D</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean filter the colour image, with `skimage`.</span>
<span class="n">astronaut_mean_filtered_ski</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">rank</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">astronaut</span><span class="p">,</span>
                                             <span class="n">footprint</span><span class="o">=</span><span class="n">footprint_9_by_9_3D</span><span class="p">)</span>

<span class="c1"># Show the result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">astronaut</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Mean Filtered (via Scikit-image)</span><span class="se">\n</span><span class="s2"> (9, 9) kernel&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">astronaut_mean_filtered_ski</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>We got a blurrier output image via <code class="docutils literal notranslate"><span class="pre">skimage</span></code> here, than in the manural convolution using <code class="docutils literal notranslate"><span class="pre">ndi.correlate()</span></code> because we used a larger kernel for the <code class="docutils literal notranslate"><span class="pre">skimage</span></code> filtering, and so are averaging over larger pixel neighbourhoods.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h1>
<p>This page has showed how to perform threshold filtering and mean filtering, using <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">skimage</span></code>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h1>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h1>
<p>Based on 3.3.5 onward from: <a class="reference external" href="https://lectures.scientific-python.org/packages/scikit-image/index.html">https://lectures.scientific-python.org/packages/scikit-image/index.html</a></p>
<p>Based on: <a class="reference external" href="https://scikit-image.org/skimage-tutorials/lectures/1_image_filters.html">https://scikit-image.org/skimage-tutorials/lectures/1_image_filters.html</a></p>
<p>Reference: <a class="reference external" href="https://www.kdnuggets.com/numpy-for-image-processing">https://www.kdnuggets.com/numpy-for-image-processing</a></p>
<p>Reference: <a class="reference external" href="https://setosa.io/ev/image-kernels">https://setosa.io/ev/image-kernels</a></p>
<p>Reference: <a class="reference external" href="https://wiki.imindlabs.com.au/ds/aml/4_problem_domains/1-image-processing/3_edge_detectors">https://wiki.imindlabs.com.au/ds/aml/4_problem_domains/1-image-processing/3_edge_detectors</a></p>
<p>Reference: <a class="reference external" href="https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels">https://www.geeksforgeeks.org/deep-learning/types-of-convolution-kernels</a></p>
<p>Reference: skimage tutorials (check versions), scipy lecture notes</p>
<p>Reference: <a class="reference external" href="https://jni.github.io/i2k-skimage-napari/lectures/1_image_filters.html">https://jni.github.io/i2k-skimage-napari/lectures/1_image_filters.html</a></p>
<p>Reference: <a class="reference external" href="https://textbook.nipraxis.org/otsu_threshold.html">https://textbook.nipraxis.org/otsu_threshold.html</a></p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3_skimage_processing_from_numpy_and_scipy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">(Sci-kit) Image processing, via NumPy and SciPy</p>
      </div>
    </a>
    <a class="right-next"
       href="5_filters_2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Image filtering II</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Image filtering I</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-signal-what-is-noise">What is signal? What is noise?</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold-filtering">Threshold Filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-segmentation-via-threshold-filtering">Image segmentation via threshold filtering</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold-filters-in-skimage">Threshold filters in <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#kernels-and-pixel-neighbourhoods">Kernels and pixel neighbourhoods</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-filtering-with-skimage">Mean filtering with <code class="docutils literal notranslate"><span class="pre">skimage</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-3d-images">Filtering 3D images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Peter Rush, Matthew Brett
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>